(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    414966,       8453]
NotebookOptionsPosition[    405848,       8283]
NotebookOutlinePosition[    406191,       8298]
CellTagsIndexPosition[    406148,       8295]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Delta Sabia (Last Update: 13/03/21)", "Title",
 CellChangeTimes->{{3.681300194179221*^9, 3.6813002033832407`*^9}, {
   3.681305983976405*^9, 3.6813059853359213`*^9}, {3.6813176225703306`*^9, 
   3.6813176235079107`*^9}, {3.6813177175941257`*^9, 3.68131771915676*^9}, {
   3.708272177122472*^9, 3.708272189394394*^9}, {3.708272239370994*^9, 
   3.708272253185425*^9}, {3.7247626663439655`*^9, 3.724762668594143*^9}, 
   3.724763762181196*^9, {3.725974849294973*^9, 3.725974857279992*^9}, {
   3.7316800228814087`*^9, 3.7316800249126425`*^9}, {3.731761928333893*^9, 
   3.731761928740137*^9}, {3.7377345647344294`*^9, 3.7377345664687967`*^9}, {
   3.737994165253688*^9, 3.7379941653786864`*^9}, {3.7489625392900763`*^9, 
   3.7489625531505637`*^9}, {3.749318816981333*^9, 3.749318817559469*^9}, {
   3.7656382216793394`*^9, 3.7656382261328287`*^9}, {3.7662401432029853`*^9, 
   3.766240154985159*^9}, {3.7663282678653297`*^9, 3.766328270484855*^9}, {
   3.766331146283388*^9, 3.7663311568355923`*^9}, {3.7663982782306576`*^9, 
   3.7663982795028768`*^9}, {3.7664037488989267`*^9, 
   3.7664037535714073`*^9}, {3.76675425955847*^9, 3.766754260902328*^9}, {
   3.767446029232342*^9, 3.7674460297011285`*^9}, {3.7675176217294626`*^9, 
   3.767517621841589*^9}, {3.7685471006341314`*^9, 3.7685471031625986`*^9}, {
   3.782651674525923*^9, 3.7826516762290554`*^9}, {3.7827472341594315`*^9, 
   3.7827472344406757`*^9}, {3.7845390971377993`*^9, 
   3.7845390993098416`*^9}, {3.7846213628789454`*^9, 
   3.7846213635508842`*^9}, {3.784971285415371*^9, 3.784971285852929*^9}, {
   3.80003815573755*^9, 3.8000381597687845`*^9}, {3.8049514458306084`*^9, 
   3.804951448440013*^9}, {3.8062446719465714`*^9, 3.8062446751540537`*^9}, {
   3.811791929593967*^9, 3.8117919321569138`*^9}, {3.8117920042649097`*^9, 
   3.811792032147236*^9}, {3.8118211262516327`*^9, 3.8118211320157013`*^9}, {
   3.811821179647152*^9, 3.8118211867633*^9}, {3.811860188752576*^9, 
   3.811860258482793*^9}, {3.811993829198284*^9, 3.811993830379608*^9}, {
   3.812527211310811*^9, 3.812527222117728*^9}, {3.812606129475505*^9, 
   3.8126061346758695`*^9}, {3.8136661285689297`*^9, 
   3.8136661439784617`*^9}, {3.813666203027869*^9, 3.81366621078681*^9}, {
   3.8140077054911613`*^9, 3.8140077058612165`*^9}, {3.8157444601701145`*^9, 
   3.815744485115374*^9}, {3.8159135249298954`*^9, 3.815913527874877*^9}, {
   3.8160829516889467`*^9, 3.816082959653524*^9}, {3.816084844383486*^9, 
   3.8160848526688385`*^9}, {3.816179919617448*^9, 3.8161799251955256`*^9}, {
   3.816612799941389*^9, 3.816612800341481*^9}, {3.8166999737285557`*^9, 
   3.8166999741588144`*^9}, {3.81687990625593*^9, 3.816879906411935*^9}, {
   3.816960321726223*^9, 3.816960321863825*^9}, {3.817025113182267*^9, 
   3.8170251137290926`*^9}, {3.8187560646339636`*^9, 
   3.8187560694467745`*^9}, {3.818841485762538*^9, 3.818841485932876*^9}, {
   3.8189269859829273`*^9, 3.8189269863734484`*^9}, {3.8190957464842863`*^9, 
   3.819095752583685*^9}, {3.822558156367777*^9, 3.822558158359206*^9}, {
   3.8226499853486586`*^9, 3.8226499854186716`*^9}, {3.8227400188673162`*^9, 
   3.8227400191462226`*^9}, {3.823183662709937*^9, 3.8231836630113554`*^9}, {
   3.823243648285769*^9, 3.8232436485470896`*^9}, {3.823414275619751*^9, 
   3.8234142897060547`*^9}, {3.823473399478349*^9, 3.823473399924156*^9}, {
   3.823589139683626*^9, 3.823589142604809*^9}, {3.823671583144682*^9, 
   3.823671583323205*^9}, {3.8236956697645445`*^9, 3.823695679687985*^9}, {
   3.823764294365416*^9, 3.8237643037223597`*^9}, {3.823784023268053*^9, 
   3.823784036520587*^9}, {3.824209101184407*^9, 3.824209103601926*^9}, {
   3.824209195113169*^9, 3.824209199400666*^9}, {3.824306622605588*^9, 
   3.824306622715295*^9}, {3.824388997704651*^9, 3.8243889985304427`*^9}, {
   3.8244689920610723`*^9, 3.8244689922366047`*^9}, {3.824485041009409*^9, 
   3.8244850416875806`*^9}, {3.8244864083856115`*^9, 
   3.8244864093360634`*^9}, {3.8245457703877244`*^9, 
   3.8245457705333767`*^9}, {3.8246470041851077`*^9, 3.824647004313732*^9}, {
   3.8246668168989325`*^9, 
   3.8246668180019693`*^9}},ExpressionUUID->"6afd2076-4493-4f08-b468-\
fa4711877d85"],

Cell[CellGroupData[{

Cell["Functions", "Chapter",
 CellChangeTimes->{{3.8118211945703535`*^9, 3.811821216548972*^9}, {
  3.8236159480958495`*^9, 3.8236159488677845`*^9}, {3.8236956658729544`*^9, 
  3.8236956662170362`*^9}},ExpressionUUID->"650a07d3-2138-4aeb-96ea-\
ad9e7ef3f02f"],

Cell[CellGroupData[{

Cell["Load Radia", "Section",
 CellChangeTimes->{{3.766397988602113*^9, 3.766398000439457*^9}, {
  3.784905891255539*^9, 
  3.7849058937557244`*^9}},ExpressionUUID->"5df1a130-7549-4d16-a255-\
11ac5a5b4990"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"<<", "Radia`"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"RadPlot3DOptions", "[", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.6818148953014574`*^9, 3.6818148962234063`*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[1]:=",ExpressionUUID->"5208220a-7433-48a7-a5e9-a136badd2cfb"],

Cell[CellGroupData[{

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Radia Version: \"\>", "\[InvisibleSpace]", "4.31`", 
   "\[InvisibleSpace]", "\<\" is loaded\"\>"}],
  SequenceForm["Radia Version: ", 4.31, " is loaded"],
  Editable->False]], "Print",
 CellChangeTimes->{3.824671700255942*^9, 3.824672232345244*^9, 
  3.82467326923532*^9},
 CellLabel->
  "During evaluation of \
In[1]:=",ExpressionUUID->"21943405-ac81-4c33-a7ba-89b40d689e49"],

Cell[BoxData["\<\"Radia is copyright ESRF, France.\"\>"], "Print",
 CellChangeTimes->{3.824671700255942*^9, 3.824672232345244*^9, 
  3.824673269239336*^9},
 CellLabel->
  "During evaluation of \
In[1]:=",ExpressionUUID->"1add56e4-a765-4a3c-9ad3-f45807dc4703"],

Cell[BoxData["\<\"Portions copyright Synchrotron SOLEIL, France.\"\>"], \
"Print",
 CellChangeTimes->{3.824671700255942*^9, 3.824672232345244*^9, 
  3.8246732692423463`*^9},
 CellLabel->
  "During evaluation of \
In[1]:=",ExpressionUUID->"053d51c2-71d0-4720-b9dd-f00490403c99"],

Cell[BoxData["\<\"Portions copyright Wolfram Research, Inc.\"\>"], "Print",
 CellChangeTimes->{3.824671700255942*^9, 3.824672232345244*^9, 
  3.82467326924433*^9},
 CellLabel->
  "During evaluation of \
In[1]:=",ExpressionUUID->"2e068fce-35d0-4e6b-a631-0700dd5fdb47"]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Set Directory", "Section",
 CellChangeTimes->{{3.766397988602113*^9, 3.766398000439457*^9}, {
   3.784905891255539*^9, 3.7849058937557244`*^9}, 
   3.824209081861091*^9},ExpressionUUID->"e61a2a75-5bec-4ae8-859b-\
8f0e399b827a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.7247692641975746`*^9, 3.7247693030912867`*^9}, 
   3.7247693360001373`*^9, 3.7320053568775253`*^9, 3.732349690257825*^9, {
   3.732871709479047*^9, 3.7328717118852863`*^9}, {3.7329567238206897`*^9, 
   3.7329567258363123`*^9}, 3.748957419661892*^9, {3.7489624425948105`*^9, 
   3.7489624446418552`*^9}, {3.7489767421165304`*^9, 
   3.7489767440073037`*^9}, {3.7511001230276623`*^9, 3.75110012579725*^9}, 
   3.7511411057661276`*^9, {3.7571464911653185`*^9, 3.757146493384221*^9}, 
   3.7876561315405025`*^9, 3.7876676883664165`*^9, 3.7982006252779846`*^9, {
   3.7984654527917624`*^9, 3.7984654540105295`*^9}, 3.7984663899212046`*^9, {
   3.798466466390125*^9, 3.7984664684994793`*^9}, 3.800036087694026*^9, {
   3.800038304096528*^9, 3.8000383140652494`*^9}, 3.8003047290105705`*^9, {
   3.813666547262052*^9, 3.8136665743061132`*^9}, 3.815744536042758*^9, 
   3.815913537512823*^9, {3.8160848576375723`*^9, 3.8160848605750694`*^9}, 
   3.8161799411070604`*^9, {3.81618114079352*^9, 3.8161811417935143`*^9}, 
   3.8161895283459244`*^9, {3.8166133583980565`*^9, 3.8166133612356877`*^9}, {
   3.816879918231163*^9, 3.8168799235493755`*^9}, 3.8168878382748904`*^9, {
   3.818756127972987*^9, 3.818756137693627*^9}, 3.822558220612127*^9, 
   3.8236766776844254`*^9, 3.8236956300956984`*^9, 3.8237675398664193`*^9, 
   3.8237848553467436`*^9, 3.82379317058152*^9, 3.823793304483486*^9, 
   3.823793623679003*^9, 3.8242090483297777`*^9},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[3]:=",ExpressionUUID->"dd7a51b2-f11e-4368-8260-6f3568484196"]
}, Closed]],

Cell[CellGroupData[{

Cell["Core", "Section",
 CellChangeTimes->{{3.76639811614032*^9, 3.7663981237176037`*^9}, {
  3.8118571543202114`*^9, 3.8118571550008917`*^9}, {3.8234143239274764`*^9, 
  3.823414324548814*^9}, {3.8234144512018805`*^9, 3.823414460091092*^9}, {
  3.8236165483653417`*^9, 3.823616552637906*^9}, {3.823617420572946*^9, 
  3.823617421055657*^9}, {3.8236768137074184`*^9, 
  3.82367681423901*^9}},ExpressionUUID->"d24c72dd-445c-4525-919e-\
b0dd35af82a1"],

Cell[CellGroupData[{

Cell["idBlocks", "Subsection",
 CellChangeTimes->{{3.766754730782276*^9, 3.7667547560811443`*^9}, {
  3.823414331626872*^9, 3.823414332902458*^9}, {3.8234144621854887`*^9, 
  3.8234144630332193`*^9}, {3.823467003891962*^9, 
  3.8234670068370485`*^9}},ExpressionUUID->"77ec33ff-b18c-4902-a954-\
70832d3afce2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idBlocks", "::", "usage"}], "=", 
    "\"\<idBlocks[blockShape, lengthList, positionList, mrList, \
\\\"blockSubdivision\\\":{}, \\\"rectangularShape\\\":False]: Returns a \
container object with the blocks. \\n\\nArgs: \\nblockShape [mm] is a list of \
{x, y} points defining the block shapes, \\nlengthList [mm] is a list with \
the longitudinal length of the blocks, \\npositionList [mm] is a list of \
longitudinal positions, \\nmrList [T] is a list of magnetization vectors  \
(must have the same length as positionList). \\n\\nOptional args: \
\\nblockSubdivision is the subdivision to be apply to the blocks (must have \
the same length as blockShape), \\nrectangularShape is True if the block \
shapes are rectangular and False otherwise.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idBlocks", "::", "blockLengthErr"}], " ", "=", 
   "\"\<The block length must be >= 0\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idBlocks", "::", "subblocksErr"}], " ", "=", 
   "\"\<Inconsistent length between blockSudivision and blockShape arguments: \
`1` and `2`\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idBlocks", "::", "blocksErr"}], " ", "=", 
   "\"\<Inconsistent length between lengthList, positionList and mrList \
arguments: `1`, `2` and `3`\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idBlocks", "::", "rectangularShapeErr"}], " ", "=", 
    "\"\<Invalid value for rectangularShape argument: `1`\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idBlocks", "[", 
    RowBox[{
    "blockShape_", ",", " ", "lengthList_", ",", "positionList_", ",", " ", 
     "mrList_", ",", " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<blockSubdivision\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"\"\<rectangularShape\>\"", "\[Rule]", " ", "False"}], ","}], 
       " ", "}"}], "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "i", ",", " ", "rectangularShape", ",", " ", "blockSubdivision", ",", 
       " ", "blockShapeList", ",", " ", "nrBlocks", ",", " ", "blockCenter", 
       ",", "blockHeight", ",", " ", "blockWidth", ",", "rotMrList", ",", 
       "  ", "rotBlockSubdivision", ",", " ", "block", ",", " ", "blockList", 
       ",", " ", "blockContainer"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Optional", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"rectangularShape", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<rectangularShape\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"blockSubdivision", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<blockSubdivision\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Check", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Depth", "[", "blockShape", "]"}], "\[NotEqual]", " ", "4"}],
         ",", 
        RowBox[{"blockShapeList", " ", "=", " ", 
         RowBox[{"{", "blockShape", "}"}]}], ",", " ", 
        RowBox[{"blockShapeList", "=", "blockShape"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "blockSubdivision", "]"}], " ", "<", "1"}], 
        ",", " ", 
        RowBox[{"blockSubdivision", " ", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", " ", "1", ",", " ", "1"}], "}"}], ",", 
           RowBox[{"Length", "[", "blockShapeList", "]"}]}], "]"}]}]}], "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Depth", "[", "blockSubdivision", "]"}], "\[NotEqual]", " ", 
         "3"}], ",", 
        RowBox[{"blockSubdivision", " ", "=", " ", 
         RowBox[{"{", "blockSubdivision", "}"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"AnyTrue", "[", 
         RowBox[{"lengthList", ",", " ", 
          RowBox[{
           RowBox[{"#", "<", " ", "0"}], "&"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{"idBlocks", "::", "blockLengthErr"}], " ", "]"}], ";", 
         RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "blockSubdivision", "]"}], " ", "\[NotEqual]",
          " ", 
         RowBox[{"Length", "[", "blockShapeList", "]"}]}], ",", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"idBlocks", "::", "subblocksErr"}], " ", ",", 
           RowBox[{"Length", "[", "blockSubdivision", "]"}], ",", " ", 
           RowBox[{"Length", "[", "blockShapeList", "]"}]}], "]"}], ";", 
         RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", " ", 
         RowBox[{
          RowBox[{"Length", "[", "lengthList", "]"}], " ", "\[Equal]", " ", 
          RowBox[{"Length", "[", "positionList", "]"}], " ", "\[Equal]", "  ", 
          RowBox[{"Length", "[", "mrList", "]"}]}]}], ",", " ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"idBlocks", "::", "blocksErr"}], " ", ",", 
           RowBox[{"Length", "[", "lengthList", "]"}], ",", 
           RowBox[{"Length", "[", "positionList", "]"}], ",", " ", 
           RowBox[{"Length", "[", "mrList", "]"}]}], "]"}], ";", 
         RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"!", " ", 
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"True", ",", " ", "False"}], "}"}], ",", 
           "rectangularShape"}], "]"}]}], ",", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"idBlocks", "::", "rectangularShapeErr"}], " ", ",", 
           "rectangularShape"}], "]"}], ";", 
         RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"nrBlocks", "=", " ", 
       RowBox[{"Length", "[", "lengthList", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
       "rectangularShape", ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"**", "\[IndentingNewLine]", "Creates"}], " ", 
          "parallelepipedic", " ", "blocks", " ", "with", " ", 
          "magnetization"}], "\[IndentingNewLine]", "***)"}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"blockCenter", " ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"RegionCentroid", "[", 
             RowBox[{"Polygon", "[", "#", "]"}], "]"}], "&"}], "/@", 
           "blockShapeList"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"blockWidth", " ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Max", "[", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", " ", "1"}], "]"}], "]"}], "]"}], " ", "-",
              " ", 
             RowBox[{"Min", "[", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", " ", "1"}], "]"}], "]"}], "]"}]}], "&"}], 
           "/@", "blockShapeList"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"blockHeight", " ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Max", "[", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", " ", "2"}], "]"}], "]"}], "]"}], " ", "-",
              " ", 
             RowBox[{"Min", "[", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", " ", "2"}], "]"}], "]"}], "]"}]}], "&"}], 
           "/@", "blockShapeList"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"blockList", " ", "=", " ", 
          RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"For", " ", "[", 
          RowBox[{
           RowBox[{"i", "=", "1"}], ",", " ", 
           RowBox[{"i", "\[LessEqual]", " ", "nrBlocks"}], ",", " ", 
           RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"lengthList", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "  ", "\[NotEqual]", " ", 
               "0"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"block", " ", "=", " ", 
                RowBox[{"MapThread", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"radObjRecMag", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{"positionList", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"#2", ",", "#3", ",", 
                    RowBox[{"lengthList", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "}"}], ",", 
                    RowBox[{"mrList", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "]"}], "&"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                   "blockCenter", ",", " ", "blockWidth", ",", " ", 
                    "blockHeight"}], "}"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"block", " ", "=", " ", 
                RowBox[{"MapThread", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"radObjDivMag", "[", 
                    RowBox[{"#1", ",", " ", "#2"}], "]"}], "&"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"block", ",", " ", "blockSubdivision"}], "}"}]}], 
                 "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"blockList", ",", " ", "block"}], "]"}], ";"}]}], 
             "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"blockContainer", "=", " ", 
          RowBox[{"radObjCnt", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{"{", "blockList", "}"}], "]"}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"**", "\[IndentingNewLine]", "Creates"}], " ", "extruded",
             " ", "polygon", " ", "blocks", " ", "with", " ", 
            RowBox[{
            "magnetization", ".", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", "The"}], " ", "block", " ", "is", " ", 
            "created", " ", "in", " ", "the", " ", "Radia", " ", "coordinate",
             " ", "system", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"x", ":", "longitudinal"}], ",", " ", 
              RowBox[{"y", ":", "horizontal"}], ",", " ", 
              RowBox[{"z", ":", "vertical"}]}], ")"}]}], ";", " ", 
           RowBox[{
           "so", " ", "it", " ", "needs", " ", "to", " ", "be", " ", 
            "rotated", " ", "to", " ", "match", " ", "Sirius", " ", 
            "coordinate", " ", "system", " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"x", ":", "horizontal"}], ",", " ", 
               RowBox[{"y", ":", "vertical"}], ",", " ", 
               RowBox[{"z", ":", "longitudinal"}]}], ")"}], ".", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", "The"}], " ", 
            "permanent", " ", "blocks", " ", "are", " ", "created", " ", 
            "with", " ", "a", " ", "extrusion", " ", "of", " ", "the", " ", 
            "cross", " ", "section", " ", "of", " ", "the", " ", "block", " ",
             "and", " ", "the", " ", "magnetization", " ", "vector", " ", 
            "must", " ", "be", " ", "specified", " ", "in", " ", "the", " ", 
            "block", " ", 
            RowBox[{
            "creation", ".", " ", "\[IndentingNewLine]", "However"}]}]}], ",",
           " ", 
          RowBox[{
          "the", " ", "extrusion", " ", "is", " ", "done", " ", "in", " ", 
           "the", " ", "x", " ", "direction"}], ",", " ", 
          RowBox[{
          "so", " ", "for", " ", "blocks", " ", "with", " ", "a", " ", 
           "constant", " ", "cross", " ", "section", " ", "in", " ", "the", 
           " ", "longitudinal", " ", "direction"}], ",", " ", 
          RowBox[{
          "the", " ", "objects", " ", "must", " ", "be", " ", "rotated", " ", 
           "after", " ", 
           RowBox[{"creation", ".", " ", "\[IndentingNewLine]", "The"}], " ", 
           "magnetization", " ", "vector", " ", "is", " ", "affected", " ", 
           "by", " ", "this", " ", "rotation"}], ",", " ", 
          RowBox[{
          "so", " ", "a", " ", "inverse", " ", "transformation", " ", "must", 
           " ", "be", " ", "applied", " ", "to", " ", "the", " ", "vector", 
           " ", "before", " ", "the", " ", "block", " ", "is", " ", 
           RowBox[{"created", "."}]}]}], "\[IndentingNewLine]", "***)"}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Counterclockwise", " ", "rotations", " ", "of", " ", "the", " ", 
           "magnetization", " ", "vector", " ", "by", " ", 
           RowBox[{"\[Pi]", "/", "2"}], " ", "around", " ", "the", " ", "y"}],
           "-", 
          RowBox[{"axis", " ", "and", " ", "by", " ", 
           RowBox[{"\[Pi]", "/", "2"}], " ", "around", " ", "the", " ", "x"}],
           "-", "axis"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"rotMrList", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"\[Pi]", "/", "2"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], ",", " ", 
              RowBox[{"Dot", "[", 
               RowBox[{
                RowBox[{"RotationMatrix", "[", 
                 RowBox[{
                  RowBox[{"\[Pi]", "/", "2"}], ",", " ", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], ",", 
                " ", "#"}], "]"}]}], "]"}], " ", "&"}], "/@", "mrList"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"rotBlockSubdivision", " ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "&"}], "/@", " ", 
           "blockSubdivision"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"blockList", " ", "=", " ", 
          RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"For", " ", "[", 
          RowBox[{
           RowBox[{"i", "=", "1"}], ",", " ", 
           RowBox[{"i", "\[LessEqual]", " ", "nrBlocks"}], ",", " ", 
           RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"lengthList", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "  ", "\[NotEqual]", " ", 
               "0"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"block", " ", "=", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"radObjThckPgn", "[", 
                   RowBox[{
                    RowBox[{"positionList", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"lengthList", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", "#", ",", " ", 
                    RowBox[{"rotMrList", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "]"}], "&"}], "/@", 
                 "blockShapeList"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"block", " ", "=", " ", 
                RowBox[{"MapThread", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"radObjDivMag", "[", 
                    RowBox[{"#1", ",", " ", "#2"}], "]"}], "&"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"block", ",", " ", "rotBlockSubdivision"}], 
                   "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"blockList", ",", " ", "block"}], "]"}], ";"}]}], 
             "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"blockContainer", "=", 
          RowBox[{"radObjCnt", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{"{", "blockList", "}"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "Counterclockwise", " ", "rotation", " ", "of", " ", "the", " ", 
            "object", " ", "by"}], " ", "-", 
           RowBox[{
            RowBox[{"\[Pi]", "/", "2"}], " ", "around", " ", "the", " ", 
            "x"}], "-", "axis"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"blockContainer", "=", " ", 
          RowBox[{"radTrfOrnt", "[", 
           RowBox[{"blockContainer", ",", " ", 
            RowBox[{"radTrfRot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
              RowBox[{
               RowBox[{"-", "\[Pi]"}], "/", "2"}]}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "Counterclockwise", " ", "rotation", " ", "of", " ", "the", " ", 
            "object", " ", "by"}], " ", "-", 
           RowBox[{
            RowBox[{"\[Pi]", "/", "2"}], " ", "around", " ", "the", " ", 
            "y"}], "-", "axis"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"blockContainer", "=", " ", 
          RowBox[{"radTrfOrnt", "[", 
           RowBox[{"blockContainer", ",", " ", 
            RowBox[{"radTrfRot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
              RowBox[{
               RowBox[{"-", "\[Pi]"}], "/", "2"}]}], "]"}]}], "]"}]}], 
         ";"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "blockContainer", "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.7667563716198864`*^9, 3.76675637607336*^9}, {
   3.7667564210925236`*^9, 3.7667565039740367`*^9}, {3.767445221866372*^9, 
   3.7674452499623413`*^9}, 3.7674492825809617`*^9, {3.7826372836996193`*^9, 
   3.782637315936621*^9}, {3.782637359577076*^9, 3.7826374825765934`*^9}, {
   3.782637552607568*^9, 3.78263768450115*^9}, {3.782637743188423*^9, 
   3.7826378222055535`*^9}, {3.782637856189788*^9, 3.782637902285347*^9}, {
   3.782637956646202*^9, 3.7826379589118185`*^9}, {3.7826379963510313`*^9, 
   3.7826380522744694`*^9}, {3.7826380832169104`*^9, 3.782638439756551*^9}, {
   3.7826384823501635`*^9, 3.7826385761329775`*^9}, {3.782638608587835*^9, 
   3.782638715809715*^9}, {3.7826388457671947`*^9, 3.7826390394108934`*^9}, {
   3.7826391010200243`*^9, 3.782639101770018*^9}, {3.782639166051016*^9, 
   3.782639483428545*^9}, {3.782639556287635*^9, 3.782639561334486*^9}, {
   3.7826396491173325`*^9, 3.7826398286009946`*^9}, {3.7826399117901325`*^9, 
   3.7826400534547825`*^9}, {3.782640090532792*^9, 3.7826405585668488`*^9}, {
   3.782640594521858*^9, 3.782640772400242*^9}, {3.7826408291968937`*^9, 
   3.782641220744748*^9}, {3.782641266900818*^9, 3.782641439540758*^9}, {
   3.7826415380716205`*^9, 3.782641576430842*^9}, {3.7826416069325433`*^9, 
   3.782641900267953*^9}, {3.782642091536579*^9, 3.7826421241301994`*^9}, {
   3.782642159770681*^9, 3.782642183333087*^9}, {3.782642768258963*^9, 
   3.7826428182481303`*^9}, {3.7826428851853724`*^9, 
   3.7826429424839563`*^9}, {3.782642980298272*^9, 3.7826429824232635`*^9}, {
   3.7826430294252024`*^9, 3.782643045909505*^9}, {3.782643084190604*^9, 
   3.782643129690423*^9}, {3.7826432037264595`*^9, 3.7826433699932384`*^9}, {
   3.782643405307832*^9, 3.782643478420932*^9}, {3.782643611689359*^9, 
   3.7826438111124973`*^9}, {3.782644897374318*^9, 3.782644921501483*^9}, {
   3.7826450171885633`*^9, 3.782645044032238*^9}, 3.7826450852820787`*^9, {
   3.7826451379869146`*^9, 3.782645156986842*^9}, {3.7834337430222216`*^9, 
   3.7834337438503695`*^9}, {3.7834338345867214`*^9, 3.783433837758585*^9}, {
   3.7849719852731423`*^9, 3.784971987038904*^9}, {3.8006905477684984`*^9, 
   3.8006906423307467`*^9}, {3.800690756221059*^9, 3.800690766236659*^9}, {
   3.8006909297238693`*^9, 3.8006910255517483`*^9}, 3.8006912303535028`*^9, {
   3.8045059921675367`*^9, 3.804505996669073*^9}, {3.804850797352042*^9, 
   3.804850807477048*^9}, {3.8049517589196978`*^9, 3.8049517615685425`*^9}, {
   3.8062286811290216`*^9, 3.806228721202465*^9}, {3.806228979261788*^9, 
   3.8062290170507536`*^9}, {3.8062291180831394`*^9, 3.80622916799267*^9}, {
   3.8062292322098484`*^9, 3.8062293461602297`*^9}, {3.806230986856161*^9, 
   3.8062309872205615`*^9}, {3.806231021987795*^9, 3.8062310387314997`*^9}, 
   3.8062310746834383`*^9, {3.8062311117960773`*^9, 3.8062311267617693`*^9}, {
   3.806231197379216*^9, 3.8062313083139057`*^9}, {3.806231354665861*^9, 
   3.806231359055117*^9}, {3.8062313929050198`*^9, 3.806231398383541*^9}, {
   3.8062314489701333`*^9, 3.8062314964060936`*^9}, {3.806231649251237*^9, 
   3.806231652025425*^9}, {3.8062317279393225`*^9, 3.8062317396088457`*^9}, {
   3.806231974992104*^9, 3.806231975324426*^9}, {3.8062321842108383`*^9, 
   3.80623219202647*^9}, 3.8062322825326595`*^9, {3.806232352649621*^9, 
   3.806232387879024*^9}, {3.8062324469851923`*^9, 3.806232511381152*^9}, {
   3.806232544003265*^9, 3.806232588714759*^9}, {3.8062326239026313`*^9, 
   3.8062326400794697`*^9}, {3.8062326931090703`*^9, 3.806232717248754*^9}, {
   3.806232848010804*^9, 3.8062328589514856`*^9}, {3.8062329608016596`*^9, 
   3.8062329717030077`*^9}, {3.806233107012436*^9, 3.8062331071380606`*^9}, {
   3.806233213092393*^9, 3.806233243495797*^9}, 3.806234151752848*^9, {
   3.811790973348828*^9, 3.81179100069236*^9}, {3.811791034750472*^9, 
   3.8117918513521185`*^9}, {3.811821899399679*^9, 3.811821912870348*^9}, {
   3.8118219737455*^9, 3.811822031222424*^9}, {3.8118220718652563`*^9, 
   3.811822110434097*^9}, {3.8118221498110332`*^9, 3.811822379446498*^9}, 
   3.811822412301318*^9, {3.811822598318445*^9, 3.8118226064557867`*^9}, {
   3.8118236629202824`*^9, 3.811823666303432*^9}, {3.8118536066983304`*^9, 
   3.811853628423772*^9}, {3.8125360888714266`*^9, 3.812536115075982*^9}, {
   3.8125362241527753`*^9, 3.8125362243227973`*^9}, {3.8125362689155827`*^9, 
   3.812536357981106*^9}, {3.8125368905814185`*^9, 3.812536942974682*^9}, {
   3.8125371437134495`*^9, 3.8125371631846704`*^9}, 3.81253729351833*^9, {
   3.8125376101392884`*^9, 3.8125376239801445`*^9}, {3.812537684383421*^9, 
   3.812537841361286*^9}, {3.81253803235649*^9, 3.8125380890700197`*^9}, {
   3.8125382022470665`*^9, 3.8125382524901934`*^9}, {3.812538309483726*^9, 
   3.812538316174163*^9}, {3.8125383476761227`*^9, 3.812538430481282*^9}, {
   3.812538499316957*^9, 3.812538570231386*^9}, {3.8125386112639303`*^9, 
   3.8125386137440615`*^9}, {3.8125386808282604`*^9, 3.812538734463213*^9}, {
   3.8125387952170124`*^9, 3.812538796667104*^9}, {3.812538929406506*^9, 
   3.812538939967165*^9}, {3.812538975559382*^9, 3.812538976679451*^9}, {
   3.8125392861109715`*^9, 3.8125393135226855`*^9}, {3.8125393440945807`*^9, 
   3.812539362055702*^9}, {3.8125394140889397`*^9, 3.812539486052806*^9}, {
   3.8125395280254173`*^9, 3.8125395869290843`*^9}, {3.81254011903574*^9, 
   3.812540161078357*^9}, {3.8125402002707767`*^9, 3.8125402135216017`*^9}, {
   3.8125402523840218`*^9, 3.81254026043453*^9}, {3.8125403715414453`*^9, 
   3.812540473097768*^9}, {3.812540511900181*^9, 3.8125405877695456`*^9}, {
   3.8125406375926485`*^9, 3.8125406401728096`*^9}, 3.8125409888186436`*^9, {
   3.8161781061534595`*^9, 3.8161781816375327`*^9}, {3.8161782517015753`*^9, 
   3.8161782537484426`*^9}, {3.816180407779239*^9, 3.816180445466555*^9}, {
   3.816180792419794*^9, 3.8161807987791433`*^9}, {3.8161808354664993`*^9, 
   3.8161808403258495`*^9}, {3.8161809798409276`*^9, 
   3.8161810150283203`*^9}, {3.8161889397634106`*^9, 3.81618908146509*^9}, {
   3.8161891162204165`*^9, 3.816189364138302*^9}, {3.8161899024986024`*^9, 
   3.8161899764607897`*^9}, {3.816190016294608*^9, 3.816190017216479*^9}, {
   3.816190108478877*^9, 3.816190385809641*^9}, {3.816190519527711*^9, 
   3.8161905348104925`*^9}, {3.8161905702519407`*^9, 
   3.8161905732519293`*^9}, {3.816190623055337*^9, 3.8161906416986494`*^9}, {
   3.8161907314903755`*^9, 3.8161907542447243`*^9}, {3.816190796201868*^9, 
   3.8161908013282037`*^9}, {3.816190838324855*^9, 3.8161908438730707`*^9}, {
   3.816190926859888*^9, 3.8161909307192464`*^9}, {3.816612848368778*^9, 
   3.816612929305269*^9}, {3.8166130846927524`*^9, 3.816613231109089*^9}, {
   3.8166135535337315`*^9, 3.8166136584210224`*^9}, 3.816614204079871*^9, {
   3.816629081579727*^9, 3.8166291978863153`*^9}, {3.816629232772005*^9, 
   3.8166295026830626`*^9}, {3.816629555534605*^9, 3.8166297371760917`*^9}, {
   3.816629951096596*^9, 3.8166299826530952`*^9}, {3.816630661452345*^9, 
   3.816630662083006*^9}, {3.816630729595662*^9, 3.8166307485575027`*^9}, {
   3.816689523978589*^9, 3.816689526877671*^9}, {3.8166895597138705`*^9, 
   3.8166895615751925`*^9}, {3.8166989873184624`*^9, 
   3.8166990361209087`*^9}, {3.8166992608883195`*^9, 
   3.8166993279952765`*^9}, {3.8187637986771817`*^9, 
   3.8187638012972775`*^9}, {3.8187638459525676`*^9, 
   3.8187639719259357`*^9}, {3.818764014538122*^9, 3.8187640757616796`*^9}, {
   3.8188452591640754`*^9, 3.8188453011321845`*^9}, {3.818845341928625*^9, 
   3.818845343633266*^9}, {3.818845387624538*^9, 3.8188454153953238`*^9}, {
   3.8188454679220333`*^9, 3.8188455578771753`*^9}, {3.818845593376182*^9, 
   3.8188456421994534`*^9}, {3.823414349077173*^9, 3.823414429712388*^9}, {
   3.8234144684786463`*^9, 3.823414624258769*^9}, {3.8234146713979597`*^9, 
   3.82341477710907*^9}, {3.823414823530842*^9, 3.823414963995948*^9}, {
   3.823415084630122*^9, 3.823415220976251*^9}, {3.8234153104368486`*^9, 
   3.823415423494299*^9}, {3.8234154751410885`*^9, 3.8234156153528724`*^9}, {
   3.8234156586320543`*^9, 3.82341567964981*^9}, {3.8234157144127817`*^9, 
   3.8234157988179073`*^9}, {3.82341584103793*^9, 3.823415872652322*^9}, {
   3.8234159065466375`*^9, 3.823416243157824*^9}, {3.823416276577391*^9, 
   3.823416482894273*^9}, {3.8234165539780483`*^9, 3.8234167234485335`*^9}, {
   3.823416952346986*^9, 3.8234172303380632`*^9}, {3.823464698781279*^9, 
   3.8234647235240974`*^9}, {3.8234647704614844`*^9, 3.823464777049828*^9}, {
   3.8234650294832983`*^9, 3.8234651045484533`*^9}, {3.8234651634598*^9, 
   3.823465362171029*^9}, {3.823465399139107*^9, 3.8234654270404415`*^9}, {
   3.823465458080378*^9, 3.8234654737574244`*^9}, {3.8234655415220795`*^9, 
   3.8234656474426303`*^9}, {3.8234658757738495`*^9, 
   3.8234659424663754`*^9}, {3.823465987106947*^9, 3.823466155820458*^9}, {
   3.82346618806015*^9, 3.8234662200565567`*^9}, {3.823466259356388*^9, 
   3.8234664018879323`*^9}, {3.823466432840127*^9, 3.823466434466775*^9}, {
   3.8234665313694315`*^9, 3.823466555091982*^9}, {3.823466591004874*^9, 
   3.8234666173762712`*^9}, {3.8234667185036798`*^9, 
   3.8234668275079765`*^9}, {3.823466929213806*^9, 3.8234669534748797`*^9}, {
   3.823467011361973*^9, 3.82346706047451*^9}, {3.823467093205944*^9, 
   3.823467369420749*^9}, {3.823467599276674*^9, 3.823467666763075*^9}, {
   3.823467803140915*^9, 3.8234678509639683`*^9}, {3.823467995214959*^9, 
   3.8234679999881744`*^9}, {3.823468158791218*^9, 3.8234687286013203`*^9}, {
   3.8234689892676153`*^9, 3.823469464430042*^9}, {3.8234694976820583`*^9, 
   3.8234695097657213`*^9}, {3.823469546354806*^9, 3.823469547109761*^9}, {
   3.823471185159027*^9, 3.823471288281087*^9}, {3.8235104870244246`*^9, 
   3.8235105344275312`*^9}, {3.8235105772309866`*^9, 
   3.8235107690347075`*^9}, {3.8235109720434422`*^9, 3.82351100337962*^9}, {
   3.823511035601386*^9, 3.8235110885925837`*^9}, {3.8235113486199512`*^9, 
   3.823511379038562*^9}, {3.823512368933484*^9, 3.8235124277461405`*^9}, {
   3.8235867749795113`*^9, 3.8235868003197384`*^9}, {3.82360552593515*^9, 
   3.823605527309478*^9}, {3.823624202432304*^9, 3.823624262494573*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[4]:=",ExpressionUUID->"056895f9-0538-4868-975a-a7ed3ddd8de0"]
}, Closed]],

Cell[CellGroupData[{

Cell["idMrList", "Subsection",
 CellChangeTimes->{{3.766754730782276*^9, 3.7667547560811443`*^9}, {
  3.823414331626872*^9, 3.823414332902458*^9}, {3.8234144621854887`*^9, 
  3.8234144630332193`*^9}, {3.8234702429147415`*^9, 3.823470289002407*^9}, {
  3.8234704804421325`*^9, 
  3.823470484295821*^9}},ExpressionUUID->"1e497aed-2a04-4536-b071-\
9089c61c5ede"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idMrList", "::", "usage"}], "=", 
    "\"\<idMrList[mr, nrBlocks, firstBlock]: Returns a list of magnetization \
vectors for an ideal insertion device. \\n\\nArgs: \\nmr [T] is remanent \
magnetization value, \\nnrBlocks is the number of blocks of the list, \
\\nfirstBlock is the direction of the magnetization of the first block of the \
list (1 for up, 2 for backward, 3 for down, 4 for foward direction).\>\""}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idMrList", "[", 
    RowBox[{"mr_", ",", " ", "nrBlocks_", ",", " ", "firstBlock_"}], "]"}], 
   " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "directionList", ",", " ", "addIdx", ",", " ", "mrFunction", ",", " ", 
       "mrList"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"directionList", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"0", ",", " ", "0", ",", " ", 
           RowBox[{"-", "1"}]}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"-", "1"}], ",", " ", "0"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"0", ",", " ", "0", ",", "1"}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"mrFunction", "[", "idx_", "]"}], " ", ":=", " ", 
       RowBox[{"mr", "*", 
        RowBox[{"directionList", "[", 
         RowBox[{"[", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"Divisible", "[", 
             RowBox[{
              RowBox[{
              "idx", " ", "+", " ", "firstBlock", " ", "-", " ", "1"}], ",", 
              " ", "4"}], "]"}], " ", ",", " ", "4", " ", ",", " ", 
            RowBox[{"Mod", "[", 
             RowBox[{
              RowBox[{"idx", "+", " ", "firstBlock", " ", "-", " ", "1"}], 
              ",", " ", "4"}], "]"}]}], " ", "]"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mrList", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"mrFunction", "[", "#", "]"}], " ", "&"}], "/@", " ", 
        RowBox[{"Range", "[", 
         RowBox[{"1", ",", " ", "nrBlocks"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "mrList", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7667563716198864`*^9, 3.76675637607336*^9}, {
   3.7667564210925236`*^9, 3.7667565039740367`*^9}, {3.767445221866372*^9, 
   3.7674452499623413`*^9}, 3.7674492825809617`*^9, {3.7826372836996193`*^9, 
   3.782637315936621*^9}, {3.782637359577076*^9, 3.7826374825765934`*^9}, {
   3.782637552607568*^9, 3.78263768450115*^9}, {3.782637743188423*^9, 
   3.7826378222055535`*^9}, {3.782637856189788*^9, 3.782637902285347*^9}, {
   3.782637956646202*^9, 3.7826379589118185`*^9}, {3.7826379963510313`*^9, 
   3.7826380522744694`*^9}, {3.7826380832169104`*^9, 3.782638439756551*^9}, {
   3.7826384823501635`*^9, 3.7826385761329775`*^9}, {3.782638608587835*^9, 
   3.782638715809715*^9}, {3.7826388457671947`*^9, 3.7826390394108934`*^9}, {
   3.7826391010200243`*^9, 3.782639101770018*^9}, {3.782639166051016*^9, 
   3.782639483428545*^9}, {3.782639556287635*^9, 3.782639561334486*^9}, {
   3.7826396491173325`*^9, 3.7826398286009946`*^9}, {3.7826399117901325`*^9, 
   3.7826400534547825`*^9}, {3.782640090532792*^9, 3.7826405585668488`*^9}, {
   3.782640594521858*^9, 3.782640772400242*^9}, {3.7826408291968937`*^9, 
   3.782641220744748*^9}, {3.782641266900818*^9, 3.782641439540758*^9}, {
   3.7826415380716205`*^9, 3.782641576430842*^9}, {3.7826416069325433`*^9, 
   3.782641900267953*^9}, {3.782642091536579*^9, 3.7826421241301994`*^9}, {
   3.782642159770681*^9, 3.782642183333087*^9}, {3.782642768258963*^9, 
   3.7826428182481303`*^9}, {3.7826428851853724`*^9, 
   3.7826429424839563`*^9}, {3.782642980298272*^9, 3.7826429824232635`*^9}, {
   3.7826430294252024`*^9, 3.782643045909505*^9}, {3.782643084190604*^9, 
   3.782643129690423*^9}, {3.7826432037264595`*^9, 3.7826433699932384`*^9}, {
   3.782643405307832*^9, 3.782643478420932*^9}, {3.782643611689359*^9, 
   3.7826438111124973`*^9}, {3.782644897374318*^9, 3.782644921501483*^9}, {
   3.7826450171885633`*^9, 3.782645044032238*^9}, 3.7826450852820787`*^9, {
   3.7826451379869146`*^9, 3.782645156986842*^9}, {3.7834337430222216`*^9, 
   3.7834337438503695`*^9}, {3.7834338345867214`*^9, 3.783433837758585*^9}, {
   3.7849719852731423`*^9, 3.784971987038904*^9}, {3.8006905477684984`*^9, 
   3.8006906423307467`*^9}, {3.800690756221059*^9, 3.800690766236659*^9}, {
   3.8006909297238693`*^9, 3.8006910255517483`*^9}, 3.8006912303535028`*^9, {
   3.8045059921675367`*^9, 3.804505996669073*^9}, {3.804850797352042*^9, 
   3.804850807477048*^9}, {3.8049517589196978`*^9, 3.8049517615685425`*^9}, {
   3.8062286811290216`*^9, 3.806228721202465*^9}, {3.806228979261788*^9, 
   3.8062290170507536`*^9}, {3.8062291180831394`*^9, 3.80622916799267*^9}, {
   3.8062292322098484`*^9, 3.8062293461602297`*^9}, {3.806230986856161*^9, 
   3.8062309872205615`*^9}, {3.806231021987795*^9, 3.8062310387314997`*^9}, 
   3.8062310746834383`*^9, {3.8062311117960773`*^9, 3.8062311267617693`*^9}, {
   3.806231197379216*^9, 3.8062313083139057`*^9}, {3.806231354665861*^9, 
   3.806231359055117*^9}, {3.8062313929050198`*^9, 3.806231398383541*^9}, {
   3.8062314489701333`*^9, 3.8062314964060936`*^9}, {3.806231649251237*^9, 
   3.806231652025425*^9}, {3.8062317279393225`*^9, 3.8062317396088457`*^9}, {
   3.806231974992104*^9, 3.806231975324426*^9}, {3.8062321842108383`*^9, 
   3.80623219202647*^9}, 3.8062322825326595`*^9, {3.806232352649621*^9, 
   3.806232387879024*^9}, {3.8062324469851923`*^9, 3.806232511381152*^9}, {
   3.806232544003265*^9, 3.806232588714759*^9}, {3.8062326239026313`*^9, 
   3.8062326400794697`*^9}, {3.8062326931090703`*^9, 3.806232717248754*^9}, {
   3.806232848010804*^9, 3.8062328589514856`*^9}, {3.8062329608016596`*^9, 
   3.8062329717030077`*^9}, {3.806233107012436*^9, 3.8062331071380606`*^9}, {
   3.806233213092393*^9, 3.806233243495797*^9}, 3.806234151752848*^9, {
   3.811790973348828*^9, 3.81179100069236*^9}, {3.811791034750472*^9, 
   3.8117918513521185`*^9}, {3.811821899399679*^9, 3.811821912870348*^9}, {
   3.8118219737455*^9, 3.811822031222424*^9}, {3.8118220718652563`*^9, 
   3.811822110434097*^9}, {3.8118221498110332`*^9, 3.811822379446498*^9}, 
   3.811822412301318*^9, {3.811822598318445*^9, 3.8118226064557867`*^9}, {
   3.8118236629202824`*^9, 3.811823666303432*^9}, {3.8118536066983304`*^9, 
   3.811853628423772*^9}, {3.8125360888714266`*^9, 3.812536115075982*^9}, {
   3.8125362241527753`*^9, 3.8125362243227973`*^9}, {3.8125362689155827`*^9, 
   3.812536357981106*^9}, {3.8125368905814185`*^9, 3.812536942974682*^9}, {
   3.8125371437134495`*^9, 3.8125371631846704`*^9}, 3.81253729351833*^9, {
   3.8125376101392884`*^9, 3.8125376239801445`*^9}, {3.812537684383421*^9, 
   3.812537841361286*^9}, {3.81253803235649*^9, 3.8125380890700197`*^9}, {
   3.8125382022470665`*^9, 3.8125382524901934`*^9}, {3.812538309483726*^9, 
   3.812538316174163*^9}, {3.8125383476761227`*^9, 3.812538430481282*^9}, {
   3.812538499316957*^9, 3.812538570231386*^9}, {3.8125386112639303`*^9, 
   3.8125386137440615`*^9}, {3.8125386808282604`*^9, 3.812538734463213*^9}, {
   3.8125387952170124`*^9, 3.812538796667104*^9}, {3.812538929406506*^9, 
   3.812538939967165*^9}, {3.812538975559382*^9, 3.812538976679451*^9}, {
   3.8125392861109715`*^9, 3.8125393135226855`*^9}, {3.8125393440945807`*^9, 
   3.812539362055702*^9}, {3.8125394140889397`*^9, 3.812539486052806*^9}, {
   3.8125395280254173`*^9, 3.8125395869290843`*^9}, {3.81254011903574*^9, 
   3.812540161078357*^9}, {3.8125402002707767`*^9, 3.8125402135216017`*^9}, {
   3.8125402523840218`*^9, 3.81254026043453*^9}, {3.8125403715414453`*^9, 
   3.812540473097768*^9}, {3.812540511900181*^9, 3.8125405877695456`*^9}, {
   3.8125406375926485`*^9, 3.8125406401728096`*^9}, 3.8125409888186436`*^9, {
   3.8161781061534595`*^9, 3.8161781816375327`*^9}, {3.8161782517015753`*^9, 
   3.8161782537484426`*^9}, {3.816180407779239*^9, 3.816180445466555*^9}, {
   3.816180792419794*^9, 3.8161807987791433`*^9}, {3.8161808354664993`*^9, 
   3.8161808403258495`*^9}, {3.8161809798409276`*^9, 
   3.8161810150283203`*^9}, {3.8161889397634106`*^9, 3.81618908146509*^9}, {
   3.8161891162204165`*^9, 3.816189364138302*^9}, {3.8161899024986024`*^9, 
   3.8161899764607897`*^9}, {3.816190016294608*^9, 3.816190017216479*^9}, {
   3.816190108478877*^9, 3.816190385809641*^9}, {3.816190519527711*^9, 
   3.8161905348104925`*^9}, {3.8161905702519407`*^9, 
   3.8161905732519293`*^9}, {3.816190623055337*^9, 3.8161906416986494`*^9}, {
   3.8161907314903755`*^9, 3.8161907542447243`*^9}, {3.816190796201868*^9, 
   3.8161908013282037`*^9}, {3.816190838324855*^9, 3.8161908438730707`*^9}, {
   3.816190926859888*^9, 3.8161909307192464`*^9}, {3.816612848368778*^9, 
   3.816612929305269*^9}, {3.8166130846927524`*^9, 3.816613231109089*^9}, {
   3.8166135535337315`*^9, 3.8166136584210224`*^9}, 3.816614204079871*^9, {
   3.816629081579727*^9, 3.8166291978863153`*^9}, {3.816629232772005*^9, 
   3.8166295026830626`*^9}, {3.816629555534605*^9, 3.8166297371760917`*^9}, {
   3.816629951096596*^9, 3.8166299826530952`*^9}, {3.816630661452345*^9, 
   3.816630662083006*^9}, {3.816630729595662*^9, 3.8166307485575027`*^9}, {
   3.816689523978589*^9, 3.816689526877671*^9}, {3.8166895597138705`*^9, 
   3.8166895615751925`*^9}, {3.8166989873184624`*^9, 
   3.8166990361209087`*^9}, {3.8166992608883195`*^9, 
   3.8166993279952765`*^9}, {3.8187637986771817`*^9, 
   3.8187638012972775`*^9}, {3.8187638459525676`*^9, 
   3.8187639719259357`*^9}, {3.818764014538122*^9, 3.8187640757616796`*^9}, {
   3.8188452591640754`*^9, 3.8188453011321845`*^9}, {3.818845341928625*^9, 
   3.818845343633266*^9}, {3.818845387624538*^9, 3.8188454153953238`*^9}, {
   3.8188454679220333`*^9, 3.8188455578771753`*^9}, {3.818845593376182*^9, 
   3.8188456421994534`*^9}, {3.823414349077173*^9, 3.823414429712388*^9}, {
   3.8234144684786463`*^9, 3.823414624258769*^9}, {3.8234146713979597`*^9, 
   3.82341477710907*^9}, {3.823414823530842*^9, 3.823414963995948*^9}, {
   3.823415084630122*^9, 3.823415220976251*^9}, {3.8234153104368486`*^9, 
   3.823415423494299*^9}, {3.8234154751410885`*^9, 3.8234156153528724`*^9}, {
   3.8234156586320543`*^9, 3.82341567964981*^9}, {3.8234157144127817`*^9, 
   3.8234157988179073`*^9}, {3.82341584103793*^9, 3.823415872652322*^9}, {
   3.8234159065466375`*^9, 3.823416243157824*^9}, {3.823416276577391*^9, 
   3.823416482894273*^9}, {3.8234165539780483`*^9, 3.8234167234485335`*^9}, {
   3.823416952346986*^9, 3.8234172303380632`*^9}, {3.823464698781279*^9, 
   3.8234647235240974`*^9}, {3.8234647704614844`*^9, 3.823464777049828*^9}, {
   3.8234650294832983`*^9, 3.8234651045484533`*^9}, {3.8234651634598*^9, 
   3.823465362171029*^9}, {3.823465399139107*^9, 3.8234654270404415`*^9}, {
   3.823465458080378*^9, 3.8234654737574244`*^9}, {3.8234655415220795`*^9, 
   3.8234656474426303`*^9}, {3.8234658757738495`*^9, 
   3.8234659424663754`*^9}, {3.823465987106947*^9, 3.823466155820458*^9}, {
   3.82346618806015*^9, 3.8234662200565567`*^9}, {3.823466259356388*^9, 
   3.8234664018879323`*^9}, {3.823466432840127*^9, 3.823466434466775*^9}, {
   3.8234665313694315`*^9, 3.823466555091982*^9}, {3.823466591004874*^9, 
   3.8234666173762712`*^9}, {3.8234667185036798`*^9, 
   3.8234668275079765`*^9}, {3.823466929213806*^9, 3.8234669534748797`*^9}, {
   3.8234696362312984`*^9, 3.8234696387355967`*^9}, {3.8234696745896482`*^9, 
   3.823469818086609*^9}, {3.8234698896830115`*^9, 3.8234699366902432`*^9}, {
   3.82346999296961*^9, 3.823469998053043*^9}, {3.8234702599760823`*^9, 
   3.823470425200961*^9}, {3.8234704620074673`*^9, 3.8234708491321774`*^9}, {
   3.823470880749569*^9, 3.8234709084145346`*^9}, {3.823470963447277*^9, 
   3.823470963938912*^9}, {3.823471036026034*^9, 3.823471066588216*^9}, {
   3.823471315498252*^9, 3.823471782436694*^9}, {3.8234718131225767`*^9, 
   3.8234718275918226`*^9}, {3.823472268998621*^9, 3.823472277162772*^9}, {
   3.823472402960125*^9, 3.8234724778456993`*^9}, {3.8234725093513875`*^9, 
   3.823472556150152*^9}, {3.823472658260929*^9, 3.8234726779891024`*^9}, {
   3.8235159465565767`*^9, 3.8235159545960627`*^9}, {3.8235904673267975`*^9, 
   3.823590501094429*^9}, {3.8236017535278215`*^9, 3.8236017614665775`*^9}, {
   3.8236022046924753`*^9, 3.823602211560128*^9}, {3.823603079167359*^9, 
   3.8236032550691433`*^9}, {3.823603350066885*^9, 3.823603370076379*^9}, {
   3.8236049692728205`*^9, 3.823604969401476*^9}, {3.8236050050141354`*^9, 
   3.823605005281458*^9}, {3.8236052748320837`*^9, 3.8236052871042757`*^9}, {
   3.823605379428216*^9, 3.8236054342355547`*^9}, 3.8236055344742703`*^9, {
   3.8236059518134937`*^9, 3.823605974490837*^9}, {3.823606012289691*^9, 
   3.823606031250952*^9}, {3.823606205350049*^9, 3.8236062349548244`*^9}, {
   3.823606483426959*^9, 3.8236068010686703`*^9}, {3.823607640741192*^9, 
   3.8236077094345236`*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[10]:=",ExpressionUUID->"f7348a1e-5492-42f7-90b4-1afc2974e076"]
}, Closed]],

Cell[CellGroupData[{

Cell["idCassette", "Subsection",
 CellChangeTimes->{{3.766754730782276*^9, 3.7667547560811443`*^9}, {
  3.823414331626872*^9, 3.823414332902458*^9}, {3.8234144621854887`*^9, 
  3.8234144630332193`*^9}, {3.823509521275796*^9, 
  3.823509521913088*^9}},ExpressionUUID->"0d079493-bdfa-4338-8e2b-\
f601566cfc9c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idCassette", "::", "usage"}], "=", 
    "\"\<idCassette[blockShape, nrPeriods, periodLength, mr, firstBlock, \
\\\"blockDistance\\\"\[Rule] 0,  \\\"blockSubdivision\\\"\[Rule] {}, \
\\\"rectangularShape\\\"\[Rule] False, \\\"terminationStart\\\"\[Rule] {}, \\\
\"terminationEnd\\\"\[Rule] {}]: Returns the cassette. \\n\\nArgs: \
\\nblockShape [mm] is a list of {x, y} points defining the block shapes, \
\\nnrPeriods is the number of periods of the casssette, \\nperiodLength [mm] \
is the insertion device period length,  \\nmr [T] is remanent magnetization \
value,  \\nfirstBlock is the direction of the magnetization of first core \
block (1 for up, 2 for backward, 3 for down, 4 for foward direction). \
\\n\\nOptional args: \\nblockDistance [mm] is the longitudinal distance \
between blocks, \\nblockSubdivision is the subdivision to be apply to the \
blocks (must have the same length as blockShape), \\nrectangularShape is True \
if the block shapes are rectangular and False otherwise, \\nterminationStart \
is a list of lists with the lengths [mm] and distances [mm] for the \
termination at the start of the cassette, \\nterminationEnd is the same as \
terminationStart for the termination at the end of the cassette.\>\""}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idCassette", "::", "argErr"}], " ", "=", 
   "\"\<Invalid value for function argument (nrPeriods, periodLength and mr \
must be > 0)\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idCassette", "::", "termErr"}], " ", "=", 
    "\"\<Inconsistent length between termination length and distance lists: \
`1` and `2`\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idCassette", "[", 
    RowBox[{
    "blockShape_", ",", " ", "nrPeriods_", ",", " ", "periodLength_", ",", 
     "  ", "mr_", ",", " ", "firstBlock_", ",", "  ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<blockDistance\>\"", "\[Rule]", " ", "0"}], ",", 
        RowBox[{"\"\<blockSubdivision\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<rectangularShape\>\"", "\[Rule]", " ", "False"}], ",", 
        " ", 
        RowBox[{"\"\<terminationStart\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<terminationEnd\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}]}], "}"}], "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "i", ",", " ", "blockDistance", ",", " ", "rectangularShape", ",", " ", 
       "blockSubdivision", ",", "terminationStart", ",", "terminationEnd", 
       ",", "\[IndentingNewLine]", "startLengthList", ",", " ", 
       "startDistanceList", ",", "startMrList", ",", "endLengthList", ",", 
       " ", "endDistanceList", ",", "endMrList", ",", " ", 
       "\[IndentingNewLine]", "blockLength", ",", " ", "nrStartBlocks", ",", 
       " ", "nrEndBlocks", ",", " ", "nrCoreBlocks", ",", " ", "nrBlocks", 
       ",", " ", "blockPosition", ",", "\[IndentingNewLine]", "lengthList", 
       ",", "distanceList", ",", " ", "positionList", ",", " ", "coreMrList", 
       ",", " ", "mrList", " ", ",", "shift", ",", "cassette"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Optional", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
     " ", 
     RowBox[{
      RowBox[{"blockDistance", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<blockDistance\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"rectangularShape", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<rectangularShape\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"blockSubdivision", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<blockSubdivision\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"terminationStart", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<terminationStart\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"terminationEnd", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<terminationEnd\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Check", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "terminationStart", "]"}], "\[Equal]", "2"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"startLengthList", " ", "=", " ", 
          RowBox[{"terminationStart", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"startDistanceList", "=", " ", 
          RowBox[{"terminationStart", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"startLengthList", " ", "=", " ", 
          RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"startDistanceList", "=", " ", 
          RowBox[{"{", "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "terminationEnd", "]"}], "\[Equal]", "2"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"endLengthList", " ", "=", " ", 
          RowBox[{"terminationEnd", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"endDistanceList", "=", " ", 
          RowBox[{"terminationEnd", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"endLengthList", " ", "=", " ", 
          RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"endDistanceList", "=", " ", 
          RowBox[{"{", "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"nrPeriods", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{"idCassette", "::", "argErr"}], " ", "]"}], ";", 
         RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"periodLength", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{"idCassette", "::", "argErr"}], " ", "]"}], ";", 
         RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"mr", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{"idCassette", "::", "argErr"}], " ", "]"}], ";", 
         RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "startLengthList", "]"}], " ", "\[NotEqual]", 
         "  ", 
         RowBox[{"Length", "[", "startDistanceList", "]"}]}], ",", " ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"idCassette", "::", "termErr"}], " ", ",", 
           RowBox[{"Length", "[", "startLengthList", "]"}], ",", 
           RowBox[{"Length", "[", "startDistanceList", "]"}]}], "]"}], ";", 
         RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "endLengthList", "]"}], " ", "\[NotEqual]", 
         "  ", 
         RowBox[{"Length", "[", "endDistanceList", "]"}]}], ",", " ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"idCassette", "::", "termErr"}], " ", ",", 
           RowBox[{"Length", "[", "endLengthList", "]"}], ",", 
           RowBox[{"Length", "[", "endDistanceList", "]"}]}], "]"}], ";", 
         RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Number", " ", "of", " ", "blocks"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"nrStartBlocks", " ", "=", " ", 
       RowBox[{"Length", "[", "startLengthList", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nrCoreBlocks", "=", " ", 
       RowBox[{"4", "*", "nrPeriods"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nrEndBlocks", " ", "=", " ", 
       RowBox[{"Length", "[", "endLengthList", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nrBlocks", " ", "=", " ", 
       RowBox[{
       "nrCoreBlocks", " ", "+", " ", "nrStartBlocks", " ", "+", " ", 
        "nrEndBlocks"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Length", " ", "List"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"blockLength", " ", "=", " ", 
       RowBox[{
        RowBox[{"periodLength", "/", "4"}], " ", "-", " ", 
        "blockDistance"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"lengthList", " ", "=", " ", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", 
         RowBox[{"startLengthList", ",", " ", 
          RowBox[{"Table", "[", 
           RowBox[{"blockLength", ",", " ", "nrCoreBlocks"}], "]"}], ",", " ",
           "endLengthList"}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"distanceList", " ", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", 
         RowBox[{"startDistanceList", ",", " ", 
          RowBox[{"Table", "[", 
           RowBox[{"blockDistance", ",", " ", 
            RowBox[{"nrCoreBlocks", "-", "1"}]}], "]"}], ",", " ", 
          "endDistanceList"}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Position", " ", "List"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"positionList", " ", "=", " ", 
       RowBox[{"{", "0", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "2"}], ",", 
        RowBox[{"i", "\[LessEqual]", " ", "nrBlocks"}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"blockPosition", " ", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"(", " ", 
             RowBox[{
              RowBox[{"lengthList", "[", 
               RowBox[{"[", "i", "]"}], "]"}], " ", "+", " ", 
              RowBox[{"lengthList", "[", 
               RowBox[{"[", 
                RowBox[{"i", "-", "1"}], "]"}], "]"}]}], ")"}], "/", "2"}], 
           " ", "+", " ", 
           RowBox[{"distanceList", "[", 
            RowBox[{"[", 
             RowBox[{"i", "-", "1"}], "]"}], "]"}]}]}], " ", ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"positionList", ",", " ", "blockPosition"}], "]"}], ";"}]}],
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"positionList", " ", "=", 
       RowBox[{"Accumulate", "[", "positionList", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Mr", " ", "List"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"startMrList", " ", "=", " ", 
       RowBox[{"idMrList", "[", 
        RowBox[{"mr", ",", " ", "nrStartBlocks", ",", " ", 
         RowBox[{
         "4", " ", "+", " ", "firstBlock", "-", " ", "nrStartBlocks"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"coreMrList", " ", "=", " ", 
       RowBox[{"idMrList", "[", 
        RowBox[{"mr", ",", " ", "nrCoreBlocks", ",", " ", "firstBlock"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"endMrList", " ", "=", " ", 
       RowBox[{"idMrList", "[", 
        RowBox[{"mr", ",", " ", "nrEndBlocks", ",", " ", "firstBlock"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mrList", " ", "=", " ", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "startMrList", ",", " ", "coreMrList", ",", " ", "endMrList"}], 
          "}"}], ",", " ", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Create", " ", "and", " ", "centralize", " ", "cassette"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"cassette", " ", "=", " ", 
       RowBox[{"idBlocks", "[", 
        RowBox[{
        "blockShape", ",", " ", "lengthList", ",", "positionList", ",", " ", 
         "mrList", ",", " ", 
         RowBox[{
         "\"\<rectangularShape\>\"", "\[Rule]", " ", "rectangularShape"}], 
         ",", " ", 
         RowBox[{
         "\"\<blockSubdivision\>\"", "\[Rule]", " ", "blockSubdivision"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"shift", "=", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"positionList", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "+", " ", 
           RowBox[{"positionList", "[", 
            RowBox[{"[", 
             RowBox[{"-", "1"}], "]"}], "]"}]}], ")"}]}], "/", "2"}]}], " ", 
      ";", "\[IndentingNewLine]", 
      RowBox[{"cassette", " ", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"cassette", ",", 
         RowBox[{"radTrfTrsl", "[", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "shift"}], "}"}], "]"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "cassette", "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7667563716198864`*^9, 3.76675637607336*^9}, {
   3.7667564210925236`*^9, 3.7667565039740367`*^9}, {3.767445221866372*^9, 
   3.7674452499623413`*^9}, 3.7674492825809617`*^9, {3.7826372836996193`*^9, 
   3.782637315936621*^9}, {3.782637359577076*^9, 3.7826374825765934`*^9}, {
   3.782637552607568*^9, 3.78263768450115*^9}, {3.782637743188423*^9, 
   3.7826378222055535`*^9}, {3.782637856189788*^9, 3.782637902285347*^9}, {
   3.782637956646202*^9, 3.7826379589118185`*^9}, {3.7826379963510313`*^9, 
   3.7826380522744694`*^9}, {3.7826380832169104`*^9, 3.782638439756551*^9}, {
   3.7826384823501635`*^9, 3.7826385761329775`*^9}, {3.782638608587835*^9, 
   3.782638715809715*^9}, {3.7826388457671947`*^9, 3.7826390394108934`*^9}, {
   3.7826391010200243`*^9, 3.782639101770018*^9}, {3.782639166051016*^9, 
   3.782639483428545*^9}, {3.782639556287635*^9, 3.782639561334486*^9}, {
   3.7826396491173325`*^9, 3.7826398286009946`*^9}, {3.7826399117901325`*^9, 
   3.7826400534547825`*^9}, {3.782640090532792*^9, 3.7826405585668488`*^9}, {
   3.782640594521858*^9, 3.782640772400242*^9}, {3.7826408291968937`*^9, 
   3.782641220744748*^9}, {3.782641266900818*^9, 3.782641439540758*^9}, {
   3.7826415380716205`*^9, 3.782641576430842*^9}, {3.7826416069325433`*^9, 
   3.782641900267953*^9}, {3.782642091536579*^9, 3.7826421241301994`*^9}, {
   3.782642159770681*^9, 3.782642183333087*^9}, {3.782642768258963*^9, 
   3.7826428182481303`*^9}, {3.7826428851853724`*^9, 
   3.7826429424839563`*^9}, {3.782642980298272*^9, 3.7826429824232635`*^9}, {
   3.7826430294252024`*^9, 3.782643045909505*^9}, {3.782643084190604*^9, 
   3.782643129690423*^9}, {3.7826432037264595`*^9, 3.7826433699932384`*^9}, {
   3.782643405307832*^9, 3.782643478420932*^9}, {3.782643611689359*^9, 
   3.7826438111124973`*^9}, {3.782644897374318*^9, 3.782644921501483*^9}, {
   3.7826450171885633`*^9, 3.782645044032238*^9}, 3.7826450852820787`*^9, {
   3.7826451379869146`*^9, 3.782645156986842*^9}, {3.7834337430222216`*^9, 
   3.7834337438503695`*^9}, {3.7834338345867214`*^9, 3.783433837758585*^9}, {
   3.7849719852731423`*^9, 3.784971987038904*^9}, {3.8006905477684984`*^9, 
   3.8006906423307467`*^9}, {3.800690756221059*^9, 3.800690766236659*^9}, {
   3.8006909297238693`*^9, 3.8006910255517483`*^9}, 3.8006912303535028`*^9, {
   3.8045059921675367`*^9, 3.804505996669073*^9}, {3.804850797352042*^9, 
   3.804850807477048*^9}, {3.8049517589196978`*^9, 3.8049517615685425`*^9}, {
   3.8062286811290216`*^9, 3.806228721202465*^9}, {3.806228979261788*^9, 
   3.8062290170507536`*^9}, {3.8062291180831394`*^9, 3.80622916799267*^9}, {
   3.8062292322098484`*^9, 3.8062293461602297`*^9}, {3.806230986856161*^9, 
   3.8062309872205615`*^9}, {3.806231021987795*^9, 3.8062310387314997`*^9}, 
   3.8062310746834383`*^9, {3.8062311117960773`*^9, 3.8062311267617693`*^9}, {
   3.806231197379216*^9, 3.8062313083139057`*^9}, {3.806231354665861*^9, 
   3.806231359055117*^9}, {3.8062313929050198`*^9, 3.806231398383541*^9}, {
   3.8062314489701333`*^9, 3.8062314964060936`*^9}, {3.806231649251237*^9, 
   3.806231652025425*^9}, {3.8062317279393225`*^9, 3.8062317396088457`*^9}, {
   3.806231974992104*^9, 3.806231975324426*^9}, {3.8062321842108383`*^9, 
   3.80623219202647*^9}, 3.8062322825326595`*^9, {3.806232352649621*^9, 
   3.806232387879024*^9}, {3.8062324469851923`*^9, 3.806232511381152*^9}, {
   3.806232544003265*^9, 3.806232588714759*^9}, {3.8062326239026313`*^9, 
   3.8062326400794697`*^9}, {3.8062326931090703`*^9, 3.806232717248754*^9}, {
   3.806232848010804*^9, 3.8062328589514856`*^9}, {3.8062329608016596`*^9, 
   3.8062329717030077`*^9}, {3.806233107012436*^9, 3.8062331071380606`*^9}, {
   3.806233213092393*^9, 3.806233243495797*^9}, 3.806234151752848*^9, {
   3.811790973348828*^9, 3.81179100069236*^9}, {3.811791034750472*^9, 
   3.8117918513521185`*^9}, {3.811821899399679*^9, 3.811821912870348*^9}, {
   3.8118219737455*^9, 3.811822031222424*^9}, {3.8118220718652563`*^9, 
   3.811822110434097*^9}, {3.8118221498110332`*^9, 3.811822379446498*^9}, 
   3.811822412301318*^9, {3.811822598318445*^9, 3.8118226064557867`*^9}, {
   3.8118236629202824`*^9, 3.811823666303432*^9}, {3.8118536066983304`*^9, 
   3.811853628423772*^9}, {3.8125360888714266`*^9, 3.812536115075982*^9}, {
   3.8125362241527753`*^9, 3.8125362243227973`*^9}, {3.8125362689155827`*^9, 
   3.812536357981106*^9}, {3.8125368905814185`*^9, 3.812536942974682*^9}, {
   3.8125371437134495`*^9, 3.8125371631846704`*^9}, 3.81253729351833*^9, {
   3.8125376101392884`*^9, 3.8125376239801445`*^9}, {3.812537684383421*^9, 
   3.812537841361286*^9}, {3.81253803235649*^9, 3.8125380890700197`*^9}, {
   3.8125382022470665`*^9, 3.8125382524901934`*^9}, {3.812538309483726*^9, 
   3.812538316174163*^9}, {3.8125383476761227`*^9, 3.812538430481282*^9}, {
   3.812538499316957*^9, 3.812538570231386*^9}, {3.8125386112639303`*^9, 
   3.8125386137440615`*^9}, {3.8125386808282604`*^9, 3.812538734463213*^9}, {
   3.8125387952170124`*^9, 3.812538796667104*^9}, {3.812538929406506*^9, 
   3.812538939967165*^9}, {3.812538975559382*^9, 3.812538976679451*^9}, {
   3.8125392861109715`*^9, 3.8125393135226855`*^9}, {3.8125393440945807`*^9, 
   3.812539362055702*^9}, {3.8125394140889397`*^9, 3.812539486052806*^9}, {
   3.8125395280254173`*^9, 3.8125395869290843`*^9}, {3.81254011903574*^9, 
   3.812540161078357*^9}, {3.8125402002707767`*^9, 3.8125402135216017`*^9}, {
   3.8125402523840218`*^9, 3.81254026043453*^9}, {3.8125403715414453`*^9, 
   3.812540473097768*^9}, {3.812540511900181*^9, 3.8125405877695456`*^9}, {
   3.8125406375926485`*^9, 3.8125406401728096`*^9}, 3.8125409888186436`*^9, {
   3.8161781061534595`*^9, 3.8161781816375327`*^9}, {3.8161782517015753`*^9, 
   3.8161782537484426`*^9}, {3.816180407779239*^9, 3.816180445466555*^9}, {
   3.816180792419794*^9, 3.8161807987791433`*^9}, {3.8161808354664993`*^9, 
   3.8161808403258495`*^9}, {3.8161809798409276`*^9, 
   3.8161810150283203`*^9}, {3.8161889397634106`*^9, 3.81618908146509*^9}, {
   3.8161891162204165`*^9, 3.816189364138302*^9}, {3.8161899024986024`*^9, 
   3.8161899764607897`*^9}, {3.816190016294608*^9, 3.816190017216479*^9}, {
   3.816190108478877*^9, 3.816190385809641*^9}, {3.816190519527711*^9, 
   3.8161905348104925`*^9}, {3.8161905702519407`*^9, 
   3.8161905732519293`*^9}, {3.816190623055337*^9, 3.8161906416986494`*^9}, {
   3.8161907314903755`*^9, 3.8161907542447243`*^9}, {3.816190796201868*^9, 
   3.8161908013282037`*^9}, {3.816190838324855*^9, 3.8161908438730707`*^9}, {
   3.816190926859888*^9, 3.8161909307192464`*^9}, {3.816612848368778*^9, 
   3.816612929305269*^9}, {3.8166130846927524`*^9, 3.816613231109089*^9}, {
   3.8166135535337315`*^9, 3.8166136584210224`*^9}, 3.816614204079871*^9, {
   3.816629081579727*^9, 3.8166291978863153`*^9}, {3.816629232772005*^9, 
   3.8166295026830626`*^9}, {3.816629555534605*^9, 3.8166297371760917`*^9}, {
   3.816629951096596*^9, 3.8166299826530952`*^9}, {3.816630661452345*^9, 
   3.816630662083006*^9}, {3.816630729595662*^9, 3.8166307485575027`*^9}, {
   3.816689523978589*^9, 3.816689526877671*^9}, {3.8166895597138705`*^9, 
   3.8166895615751925`*^9}, {3.8166989873184624`*^9, 
   3.8166990361209087`*^9}, {3.8166992608883195`*^9, 
   3.8166993279952765`*^9}, {3.8187637986771817`*^9, 
   3.8187638012972775`*^9}, {3.8187638459525676`*^9, 
   3.8187639719259357`*^9}, {3.818764014538122*^9, 3.8187640757616796`*^9}, {
   3.8188452591640754`*^9, 3.8188453011321845`*^9}, {3.818845341928625*^9, 
   3.818845343633266*^9}, {3.818845387624538*^9, 3.8188454153953238`*^9}, {
   3.8188454679220333`*^9, 3.8188455578771753`*^9}, {3.818845593376182*^9, 
   3.8188456421994534`*^9}, {3.823414349077173*^9, 3.823414429712388*^9}, {
   3.8234144684786463`*^9, 3.823414624258769*^9}, {3.8234146713979597`*^9, 
   3.82341477710907*^9}, {3.823414823530842*^9, 3.823414963995948*^9}, {
   3.823415084630122*^9, 3.823415220976251*^9}, {3.8234153104368486`*^9, 
   3.823415423494299*^9}, {3.8234154751410885`*^9, 3.8234156153528724`*^9}, {
   3.8234156586320543`*^9, 3.82341567964981*^9}, {3.8234157144127817`*^9, 
   3.8234157988179073`*^9}, {3.82341584103793*^9, 3.823415872652322*^9}, {
   3.8234159065466375`*^9, 3.823416243157824*^9}, {3.823416276577391*^9, 
   3.823416482894273*^9}, {3.8234165539780483`*^9, 3.8234167234485335`*^9}, {
   3.823416952346986*^9, 3.8234172303380632`*^9}, {3.823464698781279*^9, 
   3.8234647235240974`*^9}, {3.8234647704614844`*^9, 3.823464777049828*^9}, {
   3.8234650294832983`*^9, 3.8234651045484533`*^9}, {3.8234651634598*^9, 
   3.823465362171029*^9}, {3.823465399139107*^9, 3.8234654270404415`*^9}, {
   3.823465458080378*^9, 3.8234654737574244`*^9}, {3.8234655415220795`*^9, 
   3.8234656474426303`*^9}, {3.8234658757738495`*^9, 
   3.8234659424663754`*^9}, {3.823465987106947*^9, 3.823466155820458*^9}, {
   3.82346618806015*^9, 3.8234662200565567`*^9}, {3.823466259356388*^9, 
   3.8234664018879323`*^9}, {3.823466432840127*^9, 3.823466434466775*^9}, {
   3.8234665313694315`*^9, 3.823466555091982*^9}, {3.823466591004874*^9, 
   3.8234666173762712`*^9}, {3.8234667185036798`*^9, 
   3.8234668275079765`*^9}, {3.823466929213806*^9, 3.8234669534748797`*^9}, {
   3.8234696362312984`*^9, 3.8234696387355967`*^9}, {3.8234696745896482`*^9, 
   3.823469818086609*^9}, {3.8234698896830115`*^9, 3.8234699366902432`*^9}, {
   3.82346999296961*^9, 3.823469998053043*^9}, {3.823509525550356*^9, 
   3.823509526184658*^9}, {3.823509952919734*^9, 3.823509955487851*^9}, 
   3.8235102398897705`*^9, {3.823511467717247*^9, 3.823511470124797*^9}, {
   3.823511554941818*^9, 3.823511558568113*^9}, {3.823511643062001*^9, 
   3.8235116942978907`*^9}, {3.8235117290848017`*^9, 3.823511889851577*^9}, {
   3.82351192972188*^9, 3.823512019570406*^9}, {3.82351205596102*^9, 
   3.82351235513245*^9}, {3.8235124469746833`*^9, 3.8235124762623024`*^9}, {
   3.823512519086664*^9, 3.8235130955042243`*^9}, {3.8235131752986865`*^9, 
   3.8235131997063694`*^9}, {3.8235132306385927`*^9, 
   3.8235136190472064`*^9}, {3.823513798236662*^9, 3.82351382497212*^9}, {
   3.8235139345308933`*^9, 3.823513957724861*^9}, {3.82351413116971*^9, 
   3.8235141670736313`*^9}, {3.8235142414136906`*^9, 
   3.8235143169754844`*^9}, {3.8235149170995073`*^9, 
   3.8235151464277754`*^9}, {3.8235152168882537`*^9, 3.8235152307671185`*^9}, 
   3.8235154454156632`*^9, {3.8235156907621355`*^9, 3.823515877911276*^9}, {
   3.823515908314914*^9, 3.823515933359892*^9}, {3.8235857771038837`*^9, 
   3.823585845580636*^9}, {3.8235861731629033`*^9, 3.8235863857154436`*^9}, 
   3.82358644683704*^9, {3.823586740979498*^9, 3.8235867432813377`*^9}, {
   3.8235871570092125`*^9, 3.823587355521941*^9}, {3.823587488729479*^9, 
   3.823587551937358*^9}, {3.8235876111169877`*^9, 3.823587654888852*^9}, {
   3.823590389001402*^9, 3.823590458370781*^9}, {3.8236000961032457`*^9, 
   3.823600199044775*^9}, {3.823600237313366*^9, 3.8236002508810625`*^9}, {
   3.8236002929484673`*^9, 3.8236003195014086`*^9}, {3.823600468916529*^9, 
   3.823600813136409*^9}, {3.823601081674781*^9, 3.8236011657148876`*^9}, {
   3.823601201197913*^9, 3.823601299006188*^9}, {3.823601344642064*^9, 
   3.8236013938304324`*^9}, {3.823601430930152*^9, 3.8236017245623674`*^9}, {
   3.823601782149267*^9, 3.823601797825279*^9}, {3.8236018428737264`*^9, 
   3.8236020259099092`*^9}, {3.823602086217523*^9, 3.823602089456854*^9}, {
   3.82360212032927*^9, 3.823602127144001*^9}, {3.8236070957512712`*^9, 
   3.823607201737035*^9}, {3.8236073157010527`*^9, 3.8236073271832943`*^9}, {
   3.8236073968468695`*^9, 3.823607436060931*^9}, {3.823607472264048*^9, 
   3.82360747605291*^9}, {3.8236075085130444`*^9, 3.8236075171259947`*^9}, {
   3.823607607649748*^9, 3.823607614372757*^9}, {3.8236077927645273`*^9, 
   3.8236078185654826`*^9}, {3.823607891136278*^9, 3.8236079810159044`*^9}, {
   3.823608165863063*^9, 3.8236082256670218`*^9}, {3.8236107993261175`*^9, 
   3.8236108340736246`*^9}, {3.823610891145894*^9, 3.8236110531363983`*^9}, {
   3.8236111034776793`*^9, 3.823611145167108*^9}, {3.823611178810048*^9, 
   3.8236112388484173`*^9}, {3.8236112733011837`*^9, 
   3.8236113068444233`*^9}, {3.8236113417210875`*^9, 
   3.8236113722803464`*^9}, {3.82361366852085*^9, 3.8236136796470785`*^9}, 
   3.823615598505378*^9},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[12]:=",ExpressionUUID->"763036e8-7753-403a-9931-3ea46d04d9d7"]
}, Closed]],

Cell[CellGroupData[{

Cell["idDelta", "Subsection",
 CellChangeTimes->{{3.766754730782276*^9, 3.7667547560811443`*^9}, {
  3.823414331626872*^9, 3.823414332902458*^9}, {3.8234144621854887`*^9, 
  3.8234144630332193`*^9}, {3.823509521275796*^9, 3.823509521913088*^9}, {
  3.823586476922537*^9, 
  3.8235864777136555`*^9}},ExpressionUUID->"e3637092-da73-47ec-873f-\
16b5b813ec57"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idDelta", "::", "usage"}], "=", 
    "\"\<idDelta[nrPeriods, periodLength, mr, gap, \\\"dP\\\"\[Rule] 0, \
\\\"dCP\\\"\[Rule] 0, \\\"dGV\\\"\[Rule] 0, \\\"dGH\\\"\[Rule] 0, \
\\\"blockShape\\\"\[Rule] \\\"deltaSabia\\\", \\\"blockDistance\\\"\[Rule] 0, \
 \\\"blockSubdivision\\\"\[Rule] {}, \\\"rectangularShape\\\"\[Rule] False, \
\\\"terminationStart\\\"\[Rule] {}, \\\"terminationEnd\\\"\[Rule] {}]: \
Returns the insertion device model. \\n\\nArgs: \\nnrPeriods is the number of \
periods of the casssette, \\nperiodLength [mm] is the insertion device period \
length,  \\nmr [T] is remanent magnetization value, \\ngap [mm] if the \
insertion device minimum gap. \\n\\nOptional args: \\ndP, dCP, dGV and dGH \
[mm] are types of longitudinal displacement used for polarization control, \
\\nblockShape [mm] is a list of {x, y} points defining the block shapes or a \
predefined shape name, \\nblockDistance [mm] is the longitudinal distance \
between blocks, \\nblockSubdivision is the subdivision to be apply to the \
blocks (must have the same length as blockShape), \\nrectangularShape is True \
if the block shapes are rectangular and False otherwise, \\nterminationStart \
is a list of lists with the lengths [mm] and distances [mm] for the \
termination at the start of the insertion device, \\nterminationEnd is the \
same as terminationStart for the termination at the end of the insertion \
device.\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idDelta", "::", "gapErr"}], " ", "=", 
    "\"\<Invalid value for gap argument: `1`\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idDelta", "[", 
    RowBox[{
    "nrPeriods_", ",", " ", "periodLength_", ",", " ", "mr_", ",", " ", 
     "gap_", ",", "  ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<dP\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<dCP\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<dGV\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<dGH\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<blockShape\>\"", "\[Rule]", " ", "\"\<deltaSabia\>\""}], 
        ",", "  ", 
        RowBox[{"\"\<blockDistance\>\"", "\[Rule]", " ", "0"}], ",", 
        RowBox[{"\"\<blockSubdivision\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<rectangularShape\>\"", "\[Rule]", " ", "False"}], ",", 
        "  ", 
        RowBox[{"\"\<terminationStart\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<terminationEnd\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}]}], "}"}], "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "i", ",", " ", "dP", ",", " ", "dCP", ",", "dGV", ",", " ", "dGH", ",", 
       " ", "blockShapeInput", ",", " ", "blockShapeA", ",", " ", 
       "blockShapeB", ",", "blockShapeC", ",", " ", "blockShape", ",", " ", 
       "blockDistance", ",", " ", "rectangularShape", ",", " ", 
       "blockSubdivision", ",", " ", "terminationStart", ",", " ", 
       "terminationEnd", ",", "\[IndentingNewLine]", "csd", ",", " ", "cse", 
       ",", " ", "cid", ",", " ", "cie", ",", " ", "csdShift", ",", " ", 
       "cseShift", ",", " ", "cidShift", ",", " ", "cieShift", ",", " ", 
       "device"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Delete", " ", "previous", " ", "Radia", " ", "objects"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"radUtiDelAll", "[", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Optional", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"dP", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<dP\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dCP", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<dCP\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dGV", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<dGV\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dGH", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<dGH\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"blockShapeInput", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<blockShape\>\"", "]"}]}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"blockDistance", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<blockDistance\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"blockSubdivision", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<blockSubdivision\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"rectangularShape", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<rectangularShape\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"terminationStart", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<terminationStart\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"terminationEnd", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<terminationEnd\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Check", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"gap", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"idDelta", "::", "gapErr"}], ",", " ", "gap"}], " ", "]"}],
          ";", 
         RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"blockShape", " ", "=", " ", "blockShapeInput"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Which", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"blockShapeInput", "\[Equal]", " ", "\"\<prototype\>\""}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"blockShapeA", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "2.75"}], ",", " ", "0"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "11.2662"}], ",", 
              RowBox[{"-", "8.9645"}]}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "7.73071"}], ",", 
              RowBox[{"-", "12.5"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"7.73071", ",", " ", 
              RowBox[{"-", "12.5"}]}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"11.2662", ",", " ", 
              RowBox[{"-", "8.9645"}]}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"2.75", ",", "0"}], "}"}]}], "}"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"blockShapeB", " ", "=", " ", 
          RowBox[{"{", " ", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "7.73071"}], ",", 
              RowBox[{"-", "12.5"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "11.2662"}], ",", " ", 
              RowBox[{"-", "16.0355"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "2.75"}], ",", 
              RowBox[{"-", "25"}]}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"2.75", ",", 
              RowBox[{"-", "25"}]}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"11.2662", ",", 
              RowBox[{"-", "16.0355"}]}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"7.73071", ",", " ", 
              RowBox[{"-", "12.5"}]}], "}"}]}], "}"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"blockShape", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{"blockShapeA", ",", " ", "blockShapeB"}], "}"}]}]}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
        "blockShapeInput", " ", "\[Equal]", " ", "\"\<deltaSabia\>\""}], " ", 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"blockShapeA", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "5.25"}], ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "22.5"}], ",", 
              RowBox[{"-", "19.3"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "22.5"}], ",", " ", 
              RowBox[{"-", "29.2"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "17.8"}], ",", " ", 
              RowBox[{"-", "33.2"}]}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"17.8", ",", " ", 
              RowBox[{"-", "33.2"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"22.5", ",", 
              RowBox[{"-", "29.2"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"22.5", ",", 
              RowBox[{"-", "19.3"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"5.25", ",", "0"}], "}"}]}], "}"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"blockShapeB", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "17.8"}], ",", " ", 
              RowBox[{"-", "33.2"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "17.8"}], ",", 
              RowBox[{"-", "38.4"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"17.8", ",", " ", 
              RowBox[{"-", "38.4"}]}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"17.8", ",", " ", 
              RowBox[{"-", "33.2"}]}], "}"}]}], "}"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"blockShapeC", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "17.8"}], ",", 
              RowBox[{"-", "38.4"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "22.5"}], ",", 
              RowBox[{"-", "42.4"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "22.5"}], ",", 
              RowBox[{"-", "49"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "21.5"}], ",", 
              RowBox[{"-", "50"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"21.5", ",", 
              RowBox[{"-", "50"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"22.5", ",", 
              RowBox[{"-", "49"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"22.5", ",", 
              RowBox[{"-", "42.4"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"17.8", ",", 
              RowBox[{"-", "38.4"}]}], "}"}]}], "}"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"blockShape", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
           "blockShapeA", ",", " ", "blockShapeB", ",", "blockShapeC"}], 
           "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"csd", " ", "=", " ", 
       RowBox[{"idCassette", "[", 
        RowBox[{
        "blockShape", ",", " ", "nrPeriods", ",", " ", "periodLength", ",", 
         "  ", "mr", ",", " ", "3", ",", " ", 
         RowBox[{"\"\<blockDistance\>\"", "\[Rule]", " ", "blockDistance"}], 
         ",", 
         RowBox[{
         "\"\<blockSubdivision\>\"", "\[Rule]", " ", "blockSubdivision"}], 
         ",", " ", 
         RowBox[{
         "\"\<rectangularShape\>\"", "\[Rule]", " ", "rectangularShape"}], 
         ",", 
         RowBox[{
         "\"\<terminationStart\>\"", "\[Rule]", " ", "terminationStart"}], 
         ",", " ", 
         RowBox[{
         "\"\<terminationEnd\>\"", "\[Rule]", " ", "terminationEnd"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"csdShift", " ", "=", " ", "dGV"}], ";", "\[IndentingNewLine]", 
      RowBox[{"csd", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"csd", ",", 
         RowBox[{"radTrfTrsl", "[", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"-", "gap"}], "/", "2"}], ",", "csdShift"}], "}"}], 
          "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"csd", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"csd", ",", " ", 
         RowBox[{"radTrfRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", "\[Pi]"}], "]"}]}],
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"cse", " ", "=", " ", 
       RowBox[{"idCassette", "[", 
        RowBox[{
        "blockShape", ",", " ", "nrPeriods", ",", " ", "periodLength", ",", 
         "  ", "mr", ",", " ", "3", ",", " ", 
         RowBox[{"\"\<blockDistance\>\"", "\[Rule]", " ", "blockDistance"}], 
         ",", 
         RowBox[{
         "\"\<blockSubdivision\>\"", "\[Rule]", " ", "blockSubdivision"}], 
         ",", " ", 
         RowBox[{
         "\"\<rectangularShape\>\"", "\[Rule]", " ", "rectangularShape"}], 
         ",", " ", 
         RowBox[{
         "\"\<terminationStart\>\"", "\[Rule]", " ", "terminationStart"}], 
         ",", " ", 
         RowBox[{
         "\"\<terminationEnd\>\"", "\[Rule]", " ", "terminationEnd"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"cseShift", " ", "=", " ", 
       RowBox[{"dGV", "+", " ", "dGH", "+", " ", "dP", "+", "dCP"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cse", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"cse", ",", 
         RowBox[{"radTrfTrsl", "[", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"-", "gap"}], "/", "2"}], ",", "cseShift"}], "}"}], 
          "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"cse", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"cse", ",", " ", 
         RowBox[{"radTrfRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
           RowBox[{
            RowBox[{"-", "\[Pi]"}], "/", "2"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"cid", " ", "=", " ", 
       RowBox[{"idCassette", "[", 
        RowBox[{
        "blockShape", ",", " ", "nrPeriods", ",", " ", "periodLength", ",", 
         "  ", "mr", ",", " ", "1", ",", " ", 
         RowBox[{"\"\<blockDistance\>\"", "\[Rule]", " ", "blockDistance"}], 
         ",", 
         RowBox[{
         "\"\<blockSubdivision\>\"", "\[Rule]", " ", "blockSubdivision"}], 
         ",", " ", 
         RowBox[{
         "\"\<rectangularShape\>\"", "\[Rule]", " ", "rectangularShape"}], 
         ",", " ", 
         RowBox[{
         "\"\<terminationStart\>\"", "\[Rule]", " ", "terminationStart"}], 
         ",", " ", 
         RowBox[{
         "\"\<terminationEnd\>\"", "\[Rule]", " ", "terminationEnd"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"cidShift", " ", "=", " ", 
       RowBox[{"dP", "-", "dCP"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"cid", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"cid", ",", 
         RowBox[{"radTrfTrsl", "[", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"-", "gap"}], "/", "2"}], ",", "cidShift"}], "}"}], 
          "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"cid", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"cid", ",", " ", 
         RowBox[{"radTrfRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
           RowBox[{"\[Pi]", "/", "2"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"cie", " ", "=", " ", 
       RowBox[{"idCassette", "[", 
        RowBox[{
        "blockShape", ",", " ", "nrPeriods", ",", " ", "periodLength", ",", 
         "  ", "mr", ",", " ", "1", ",", " ", 
         RowBox[{"\"\<blockDistance\>\"", "\[Rule]", " ", "blockDistance"}], 
         ",", 
         RowBox[{
         "\"\<blockSubdivision\>\"", "\[Rule]", " ", "blockSubdivision"}], 
         ",", " ", 
         RowBox[{
         "\"\<rectangularShape\>\"", "\[Rule]", " ", "rectangularShape"}], 
         ",", " ", 
         RowBox[{
         "\"\<terminationStart\>\"", "\[Rule]", " ", "terminationStart"}], 
         ",", " ", 
         RowBox[{
         "\"\<terminationEnd\>\"", "\[Rule]", " ", "terminationEnd"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"cieShift", " ", "=", " ", "dGH"}], ";", "\[IndentingNewLine]", 
      RowBox[{"cie", " ", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"cie", ",", 
         RowBox[{"radTrfTrsl", "[", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"-", "gap"}], "/", "2"}], ",", "cieShift"}], "}"}], 
          "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"device", " ", "=", " ", 
       RowBox[{"radObjCnt", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"csd", ",", " ", "cse", ",", " ", "cid", ",", " ", "cie"}], 
          "}"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"device", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"device", ",", 
         RowBox[{"radTrfRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
           RowBox[{
            RowBox[{"-", "\[Pi]"}], "/", "4"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "device", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7667563716198864`*^9, 3.76675637607336*^9}, {
   3.7667564210925236`*^9, 3.7667565039740367`*^9}, {3.767445221866372*^9, 
   3.7674452499623413`*^9}, 3.7674492825809617`*^9, {3.7826372836996193`*^9, 
   3.782637315936621*^9}, {3.782637359577076*^9, 3.7826374825765934`*^9}, {
   3.782637552607568*^9, 3.78263768450115*^9}, {3.782637743188423*^9, 
   3.7826378222055535`*^9}, {3.782637856189788*^9, 3.782637902285347*^9}, {
   3.782637956646202*^9, 3.7826379589118185`*^9}, {3.7826379963510313`*^9, 
   3.7826380522744694`*^9}, {3.7826380832169104`*^9, 3.782638439756551*^9}, {
   3.7826384823501635`*^9, 3.7826385761329775`*^9}, {3.782638608587835*^9, 
   3.782638715809715*^9}, {3.7826388457671947`*^9, 3.7826390394108934`*^9}, {
   3.7826391010200243`*^9, 3.782639101770018*^9}, {3.782639166051016*^9, 
   3.782639483428545*^9}, {3.782639556287635*^9, 3.782639561334486*^9}, {
   3.7826396491173325`*^9, 3.7826398286009946`*^9}, {3.7826399117901325`*^9, 
   3.7826400534547825`*^9}, {3.782640090532792*^9, 3.7826405585668488`*^9}, {
   3.782640594521858*^9, 3.782640772400242*^9}, {3.7826408291968937`*^9, 
   3.782641220744748*^9}, {3.782641266900818*^9, 3.782641439540758*^9}, {
   3.7826415380716205`*^9, 3.782641576430842*^9}, {3.7826416069325433`*^9, 
   3.782641900267953*^9}, {3.782642091536579*^9, 3.7826421241301994`*^9}, {
   3.782642159770681*^9, 3.782642183333087*^9}, {3.782642768258963*^9, 
   3.7826428182481303`*^9}, {3.7826428851853724`*^9, 
   3.7826429424839563`*^9}, {3.782642980298272*^9, 3.7826429824232635`*^9}, {
   3.7826430294252024`*^9, 3.782643045909505*^9}, {3.782643084190604*^9, 
   3.782643129690423*^9}, {3.7826432037264595`*^9, 3.7826433699932384`*^9}, {
   3.782643405307832*^9, 3.782643478420932*^9}, {3.782643611689359*^9, 
   3.7826438111124973`*^9}, {3.782644897374318*^9, 3.782644921501483*^9}, {
   3.7826450171885633`*^9, 3.782645044032238*^9}, 3.7826450852820787`*^9, {
   3.7826451379869146`*^9, 3.782645156986842*^9}, {3.7834337430222216`*^9, 
   3.7834337438503695`*^9}, {3.7834338345867214`*^9, 3.783433837758585*^9}, {
   3.7849719852731423`*^9, 3.784971987038904*^9}, {3.8006905477684984`*^9, 
   3.8006906423307467`*^9}, {3.800690756221059*^9, 3.800690766236659*^9}, {
   3.8006909297238693`*^9, 3.8006910255517483`*^9}, 3.8006912303535028`*^9, {
   3.8045059921675367`*^9, 3.804505996669073*^9}, {3.804850797352042*^9, 
   3.804850807477048*^9}, {3.8049517589196978`*^9, 3.8049517615685425`*^9}, {
   3.8062286811290216`*^9, 3.806228721202465*^9}, {3.806228979261788*^9, 
   3.8062290170507536`*^9}, {3.8062291180831394`*^9, 3.80622916799267*^9}, {
   3.8062292322098484`*^9, 3.8062293461602297`*^9}, {3.806230986856161*^9, 
   3.8062309872205615`*^9}, {3.806231021987795*^9, 3.8062310387314997`*^9}, 
   3.8062310746834383`*^9, {3.8062311117960773`*^9, 3.8062311267617693`*^9}, {
   3.806231197379216*^9, 3.8062313083139057`*^9}, {3.806231354665861*^9, 
   3.806231359055117*^9}, {3.8062313929050198`*^9, 3.806231398383541*^9}, {
   3.8062314489701333`*^9, 3.8062314964060936`*^9}, {3.806231649251237*^9, 
   3.806231652025425*^9}, {3.8062317279393225`*^9, 3.8062317396088457`*^9}, {
   3.806231974992104*^9, 3.806231975324426*^9}, {3.8062321842108383`*^9, 
   3.80623219202647*^9}, 3.8062322825326595`*^9, {3.806232352649621*^9, 
   3.806232387879024*^9}, {3.8062324469851923`*^9, 3.806232511381152*^9}, {
   3.806232544003265*^9, 3.806232588714759*^9}, {3.8062326239026313`*^9, 
   3.8062326400794697`*^9}, {3.8062326931090703`*^9, 3.806232717248754*^9}, {
   3.806232848010804*^9, 3.8062328589514856`*^9}, {3.8062329608016596`*^9, 
   3.8062329717030077`*^9}, {3.806233107012436*^9, 3.8062331071380606`*^9}, {
   3.806233213092393*^9, 3.806233243495797*^9}, 3.806234151752848*^9, {
   3.811790973348828*^9, 3.81179100069236*^9}, {3.811791034750472*^9, 
   3.8117918513521185`*^9}, {3.811821899399679*^9, 3.811821912870348*^9}, {
   3.8118219737455*^9, 3.811822031222424*^9}, {3.8118220718652563`*^9, 
   3.811822110434097*^9}, {3.8118221498110332`*^9, 3.811822379446498*^9}, 
   3.811822412301318*^9, {3.811822598318445*^9, 3.8118226064557867`*^9}, {
   3.8118236629202824`*^9, 3.811823666303432*^9}, {3.8118536066983304`*^9, 
   3.811853628423772*^9}, {3.8125360888714266`*^9, 3.812536115075982*^9}, {
   3.8125362241527753`*^9, 3.8125362243227973`*^9}, {3.8125362689155827`*^9, 
   3.812536357981106*^9}, {3.8125368905814185`*^9, 3.812536942974682*^9}, {
   3.8125371437134495`*^9, 3.8125371631846704`*^9}, 3.81253729351833*^9, {
   3.8125376101392884`*^9, 3.8125376239801445`*^9}, {3.812537684383421*^9, 
   3.812537841361286*^9}, {3.81253803235649*^9, 3.8125380890700197`*^9}, {
   3.8125382022470665`*^9, 3.8125382524901934`*^9}, {3.812538309483726*^9, 
   3.812538316174163*^9}, {3.8125383476761227`*^9, 3.812538430481282*^9}, {
   3.812538499316957*^9, 3.812538570231386*^9}, {3.8125386112639303`*^9, 
   3.8125386137440615`*^9}, {3.8125386808282604`*^9, 3.812538734463213*^9}, {
   3.8125387952170124`*^9, 3.812538796667104*^9}, {3.812538929406506*^9, 
   3.812538939967165*^9}, {3.812538975559382*^9, 3.812538976679451*^9}, {
   3.8125392861109715`*^9, 3.8125393135226855`*^9}, {3.8125393440945807`*^9, 
   3.812539362055702*^9}, {3.8125394140889397`*^9, 3.812539486052806*^9}, {
   3.8125395280254173`*^9, 3.8125395869290843`*^9}, {3.81254011903574*^9, 
   3.812540161078357*^9}, {3.8125402002707767`*^9, 3.8125402135216017`*^9}, {
   3.8125402523840218`*^9, 3.81254026043453*^9}, {3.8125403715414453`*^9, 
   3.812540473097768*^9}, {3.812540511900181*^9, 3.8125405877695456`*^9}, {
   3.8125406375926485`*^9, 3.8125406401728096`*^9}, 3.8125409888186436`*^9, {
   3.8161781061534595`*^9, 3.8161781816375327`*^9}, {3.8161782517015753`*^9, 
   3.8161782537484426`*^9}, {3.816180407779239*^9, 3.816180445466555*^9}, {
   3.816180792419794*^9, 3.8161807987791433`*^9}, {3.8161808354664993`*^9, 
   3.8161808403258495`*^9}, {3.8161809798409276`*^9, 
   3.8161810150283203`*^9}, {3.8161889397634106`*^9, 3.81618908146509*^9}, {
   3.8161891162204165`*^9, 3.816189364138302*^9}, {3.8161899024986024`*^9, 
   3.8161899764607897`*^9}, {3.816190016294608*^9, 3.816190017216479*^9}, {
   3.816190108478877*^9, 3.816190385809641*^9}, {3.816190519527711*^9, 
   3.8161905348104925`*^9}, {3.8161905702519407`*^9, 
   3.8161905732519293`*^9}, {3.816190623055337*^9, 3.8161906416986494`*^9}, {
   3.8161907314903755`*^9, 3.8161907542447243`*^9}, {3.816190796201868*^9, 
   3.8161908013282037`*^9}, {3.816190838324855*^9, 3.8161908438730707`*^9}, {
   3.816190926859888*^9, 3.8161909307192464`*^9}, {3.816612848368778*^9, 
   3.816612929305269*^9}, {3.8166130846927524`*^9, 3.816613231109089*^9}, {
   3.8166135535337315`*^9, 3.8166136584210224`*^9}, 3.816614204079871*^9, {
   3.816629081579727*^9, 3.8166291978863153`*^9}, {3.816629232772005*^9, 
   3.8166295026830626`*^9}, {3.816629555534605*^9, 3.8166297371760917`*^9}, {
   3.816629951096596*^9, 3.8166299826530952`*^9}, {3.816630661452345*^9, 
   3.816630662083006*^9}, {3.816630729595662*^9, 3.8166307485575027`*^9}, {
   3.816689523978589*^9, 3.816689526877671*^9}, {3.8166895597138705`*^9, 
   3.8166895615751925`*^9}, {3.8166989873184624`*^9, 
   3.8166990361209087`*^9}, {3.8166992608883195`*^9, 
   3.8166993279952765`*^9}, {3.8187637986771817`*^9, 
   3.8187638012972775`*^9}, {3.8187638459525676`*^9, 
   3.8187639719259357`*^9}, {3.818764014538122*^9, 3.8187640757616796`*^9}, {
   3.8188452591640754`*^9, 3.8188453011321845`*^9}, {3.818845341928625*^9, 
   3.818845343633266*^9}, {3.818845387624538*^9, 3.8188454153953238`*^9}, {
   3.8188454679220333`*^9, 3.8188455578771753`*^9}, {3.818845593376182*^9, 
   3.8188456421994534`*^9}, {3.823414349077173*^9, 3.823414429712388*^9}, {
   3.8234144684786463`*^9, 3.823414624258769*^9}, {3.8234146713979597`*^9, 
   3.82341477710907*^9}, {3.823414823530842*^9, 3.823414963995948*^9}, {
   3.823415084630122*^9, 3.823415220976251*^9}, {3.8234153104368486`*^9, 
   3.823415423494299*^9}, {3.8234154751410885`*^9, 3.8234156153528724`*^9}, {
   3.8234156586320543`*^9, 3.82341567964981*^9}, {3.8234157144127817`*^9, 
   3.8234157988179073`*^9}, {3.82341584103793*^9, 3.823415872652322*^9}, {
   3.8234159065466375`*^9, 3.823416243157824*^9}, {3.823416276577391*^9, 
   3.823416482894273*^9}, {3.8234165539780483`*^9, 3.8234167234485335`*^9}, {
   3.823416952346986*^9, 3.8234172303380632`*^9}, {3.823464698781279*^9, 
   3.8234647235240974`*^9}, {3.8234647704614844`*^9, 3.823464777049828*^9}, {
   3.8234650294832983`*^9, 3.8234651045484533`*^9}, {3.8234651634598*^9, 
   3.823465362171029*^9}, {3.823465399139107*^9, 3.8234654270404415`*^9}, {
   3.823465458080378*^9, 3.8234654737574244`*^9}, {3.8234655415220795`*^9, 
   3.8234656474426303`*^9}, {3.8234658757738495`*^9, 
   3.8234659424663754`*^9}, {3.823465987106947*^9, 3.823466155820458*^9}, {
   3.82346618806015*^9, 3.8234662200565567`*^9}, {3.823466259356388*^9, 
   3.8234664018879323`*^9}, {3.823466432840127*^9, 3.823466434466775*^9}, {
   3.8234665313694315`*^9, 3.823466555091982*^9}, {3.823466591004874*^9, 
   3.8234666173762712`*^9}, {3.8234667185036798`*^9, 
   3.8234668275079765`*^9}, {3.823466929213806*^9, 3.8234669534748797`*^9}, {
   3.8234696362312984`*^9, 3.8234696387355967`*^9}, {3.8234696745896482`*^9, 
   3.823469818086609*^9}, {3.8234698896830115`*^9, 3.8234699366902432`*^9}, {
   3.82346999296961*^9, 3.823469998053043*^9}, {3.823509525550356*^9, 
   3.823509526184658*^9}, {3.823509952919734*^9, 3.823509955487851*^9}, 
   3.8235102398897705`*^9, {3.823511467717247*^9, 3.823511470124797*^9}, {
   3.823511554941818*^9, 3.823511558568113*^9}, {3.823511643062001*^9, 
   3.8235116942978907`*^9}, {3.8235117290848017`*^9, 3.823511889851577*^9}, {
   3.82351192972188*^9, 3.823512019570406*^9}, {3.82351205596102*^9, 
   3.82351235513245*^9}, {3.8235124469746833`*^9, 3.8235124762623024`*^9}, {
   3.823512519086664*^9, 3.8235130955042243`*^9}, {3.8235131752986865`*^9, 
   3.8235131997063694`*^9}, {3.8235132306385927`*^9, 
   3.8235136190472064`*^9}, {3.823513798236662*^9, 3.82351382497212*^9}, {
   3.8235139345308933`*^9, 3.823513957724861*^9}, {3.82351413116971*^9, 
   3.8235141670736313`*^9}, {3.8235142414136906`*^9, 
   3.8235143169754844`*^9}, {3.8235149170995073`*^9, 
   3.8235151464277754`*^9}, {3.8235152168882537`*^9, 3.8235152307671185`*^9}, 
   3.8235154454156632`*^9, {3.8235156907621355`*^9, 3.823515877911276*^9}, {
   3.823515908314914*^9, 3.823515933359892*^9}, {3.8235857771038837`*^9, 
   3.823585845580636*^9}, {3.8235861731629033`*^9, 3.8235863857154436`*^9}, 
   3.82358644683704*^9, {3.8235864840040593`*^9, 3.8235865599998302`*^9}, {
   3.823586616753211*^9, 3.823586672941083*^9}, 3.8235867602320085`*^9, {
   3.823586830104992*^9, 3.8235868879182806`*^9}, {3.823586928422922*^9, 
   3.823587144450817*^9}, {3.8235873769027243`*^9, 3.823587413429014*^9}, {
   3.823587446893462*^9, 3.823587458796609*^9}, {3.8235876576724343`*^9, 
   3.8235879130316916`*^9}, {3.823587948860773*^9, 3.8235879547879505`*^9}, {
   3.823587999175168*^9, 3.823588114932392*^9}, {3.823588154112542*^9, 
   3.8235881588757973`*^9}, {3.8235882977281876`*^9, 
   3.8235883005396996`*^9}, {3.823588420575471*^9, 3.8235884349160557`*^9}, {
   3.8235885833463745`*^9, 3.8235886309081335`*^9}, {3.823588675478856*^9, 
   3.823588758139676*^9}, {3.8235889282584496`*^9, 3.8235891007877502`*^9}, {
   3.823589261015967*^9, 3.8235892618796716`*^9}, {3.8235893322553415`*^9, 
   3.823589355942937*^9}, {3.823589657255609*^9, 3.823589715213504*^9}, {
   3.8235898876909456`*^9, 3.823589902558157*^9}, {3.823589966866068*^9, 
   3.823589978881874*^9}, {3.823590040039212*^9, 3.823590050953046*^9}, {
   3.823590087899172*^9, 3.823590112640926*^9}, {3.8235901463816643`*^9, 
   3.8235901482406573`*^9}, {3.823590203917699*^9, 3.8235902307808104`*^9}, {
   3.823590281921956*^9, 3.8235903052694693`*^9}, {3.8235905235932255`*^9, 
   3.823590535604083*^9}, 3.8236085528288436`*^9, {3.8236105290942698`*^9, 
   3.8236107034776244`*^9}, {3.823610740303029*^9, 3.823610754313583*^9}, {
   3.8236245506384964`*^9, 3.82362493617677*^9}, {3.8236249670012817`*^9, 
   3.8236250139866157`*^9}, {3.8236250448540125`*^9, 3.823625081487977*^9}, {
   3.8236251466665545`*^9, 3.823625191545456*^9}, {3.8236253697904606`*^9, 
   3.823625400690769*^9}, {3.82362607571436*^9, 3.823626079428421*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[16]:=",ExpressionUUID->"74000170-029d-4a45-be58-1fe9721ca462"]
}, Closed]],

Cell[CellGroupData[{

Cell["idAppleII", "Subsection",
 CellChangeTimes->{{3.766754730782276*^9, 3.7667547560811443`*^9}, {
  3.823414331626872*^9, 3.823414332902458*^9}, {3.8234144621854887`*^9, 
  3.8234144630332193`*^9}, {3.823509521275796*^9, 3.823509521913088*^9}, {
  3.823586476922537*^9, 3.8235864777136555`*^9}, {3.8236244850520477`*^9, 
  3.8236245063839254`*^9}},ExpressionUUID->"2428bf3c-641a-4267-85e0-\
44545ecd0f95"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idAppleII", "::", "usage"}], "=", 
    "\"\<idAppleII[nrPeriods, periodLength, mr, gap, \\\"dP\\\"\[Rule] 0, \
\\\"dCP\\\"\[Rule] 0, \\\"dG\\\"\[Rule] 0, \\\"blockShape\\\"\[Rule] \
\\\"default\\\", \\\"blockDistance\\\"\[Rule] 0,  \\\"blockSubdivision\\\"\
\[Rule] {}, \\\"rectangularShape\\\"\[Rule] False, \\\"terminationStart\\\"\
\[Rule] {}, \\\"terminationEnd\\\"\[Rule] {}]: Returns the insertion device \
model. \\n\\nArgs: \\nnrPeriods is the number of periods of the casssette, \
\\nperiodLength [mm] is the insertion device period length,  \\nmr [T] is \
remanent magnetization value, \\ngap [mm] if the insertion device minimum \
gap. \\n\\nOptional args: \\ndP and dCP [mm] are types of longitudinal \
displacement used for polarization control and dG [mm] is the gap oppening, \
\\nblockShape [mm] is a list of {x, y} points defining the block shapes or a \
predefined shape name, \\nblockDistance [mm] is the longitudinal distance \
between blocks, \\nblockSubdivision is the subdivision to be apply to the \
blocks (must have the same length as blockShape), \\nrectangularShape is True \
if the block shapes are rectangular and False otherwise, \\nterminationStart \
is a list of lists with the lengths [mm] and distances [mm] for the \
termination at the start of the insertion device, \\nterminationEnd is the \
same as terminationStart for the termination at the end of the insertion \
device.\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idAppleII", "::", "gapErr"}], " ", "=", 
    "\"\<Invalid value for gap argument: `1`\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idAppleII", "[", 
    RowBox[{
    "nrPeriods_", ",", " ", "periodLength_", ",", " ", "mr_", ",", " ", 
     "gap_", ",", "  ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<dP\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<dCP\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<dG\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<blockShape\>\"", "\[Rule]", " ", "\"\<default\>\""}], 
        ",", "  ", 
        RowBox[{"\"\<blockDistance\>\"", "\[Rule]", " ", "0"}], ",", 
        RowBox[{"\"\<blockSubdivision\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<rectangularShape\>\"", "\[Rule]", " ", "False"}], ",", 
        "  ", 
        RowBox[{"\"\<terminationStart\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<terminationEnd\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}]}], "}"}], "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "i", ",", " ", "dP", ",", " ", "dCP", ",", "dG", ",", " ", 
       "blockShapeInput", ",", " ", "blockShapeA", ",", " ", "blockShapeB", 
       ",", "blockShapeC", ",", " ", "blockShape", ",", " ", 
       "mirrorBlockShape", ",", " ", "blockDistance", ",", " ", 
       "rectangularShape", ",", " ", "blockSubdivision", ",", " ", 
       "terminationStart", ",", " ", "terminationEnd", ",", 
       "\[IndentingNewLine]", "csd", ",", " ", "cse", ",", " ", "cid", ",", 
       " ", "cie", ",", " ", "csdShift", ",", " ", "cseShift", ",", " ", 
       "cidShift", ",", " ", "cieShift", ",", " ", "device"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Delete", " ", "previous", " ", "Radia", " ", "objects"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"radUtiDelAll", "[", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Optional", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"dP", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<dP\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dCP", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<dCP\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dG", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<dG\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"blockShapeInput", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<blockShape\>\"", "]"}]}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"blockDistance", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<blockDistance\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"blockSubdivision", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<blockSubdivision\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"rectangularShape", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<rectangularShape\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"terminationStart", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<terminationStart\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"terminationEnd", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<terminationEnd\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Check", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"gap", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"idDelta", "::", "gapErr"}], ",", " ", "gap"}], " ", "]"}],
          ";", 
         RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"blockShape", " ", "=", " ", "blockShapeInput"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Which", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"blockShapeInput", "\[Equal]", " ", "\"\<default\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"blockShapeA", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", " ", "0"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"50", ",", " ", "0"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"50", ",", 
              RowBox[{"-", "50"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", " ", 
              RowBox[{"-", "50"}]}], "}"}]}], "}"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"blockShape", " ", "=", " ", 
          RowBox[{"{", "blockShapeA", "}"}]}], ";"}]}], "\[IndentingNewLine]",
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Depth", "[", "blockShape", "]"}], "\[NotEqual]", " ", "4"}],
         ",", 
        RowBox[{"blockShape", " ", "=", " ", 
         RowBox[{"{", "blockShape", "}"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mirrorBlockShape", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"-", "1"}], ")"}], "*", 
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "&"}], "/@", " ", 
          "#"}], "&"}], "/@", " ", "blockShape"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"csd", " ", "=", " ", 
       RowBox[{"idCassette", "[", 
        RowBox[{
        "mirrorBlockShape", ",", " ", "nrPeriods", ",", " ", "periodLength", 
         ",", "  ", "mr", ",", " ", "3", ",", " ", 
         RowBox[{"\"\<blockDistance\>\"", "\[Rule]", " ", "blockDistance"}], 
         ",", 
         RowBox[{
         "\"\<blockSubdivision\>\"", "\[Rule]", " ", "blockSubdivision"}], 
         ",", " ", 
         RowBox[{
         "\"\<rectangularShape\>\"", "\[Rule]", " ", "rectangularShape"}], 
         ",", 
         RowBox[{
         "\"\<terminationStart\>\"", "\[Rule]", " ", "terminationStart"}], 
         ",", " ", 
         RowBox[{
         "\"\<terminationEnd\>\"", "\[Rule]", " ", "terminationEnd"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"csdShift", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"csd", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"csd", ",", 
         RowBox[{"radTrfTrsl", "[", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "gap"}], "/", "2"}], "-", 
             RowBox[{"dG", "/", "2"}]}], ",", "csdShift"}], "}"}], "]"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"csd", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"csd", ",", " ", 
         RowBox[{"radTrfRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", "\[Pi]"}], "]"}]}],
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"cse", " ", "=", " ", 
       RowBox[{"idCassette", "[", 
        RowBox[{
        "blockShape", ",", " ", "nrPeriods", ",", " ", "periodLength", ",", 
         "  ", "mr", ",", " ", "3", ",", " ", 
         RowBox[{"\"\<blockDistance\>\"", "\[Rule]", " ", "blockDistance"}], 
         ",", 
         RowBox[{
         "\"\<blockSubdivision\>\"", "\[Rule]", " ", "blockSubdivision"}], 
         ",", " ", 
         RowBox[{
         "\"\<rectangularShape\>\"", "\[Rule]", " ", "rectangularShape"}], 
         ",", " ", 
         RowBox[{
         "\"\<terminationStart\>\"", "\[Rule]", " ", "terminationStart"}], 
         ",", " ", 
         RowBox[{
         "\"\<terminationEnd\>\"", "\[Rule]", " ", "terminationEnd"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"cseShift", " ", "=", " ", 
       RowBox[{"dP", "+", "dCP"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"cse", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"cse", ",", 
         RowBox[{"radTrfTrsl", "[", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "gap"}], "/", "2"}], "-", 
             RowBox[{"dG", "/", "2"}]}], ",", "cseShift"}], "}"}], "]"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"cse", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"cse", ",", " ", 
         RowBox[{"radTrfRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", "\[Pi]"}], "]"}]}],
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"cid", " ", "=", " ", 
       RowBox[{"idCassette", "[", 
        RowBox[{
        "blockShape", ",", " ", "nrPeriods", ",", " ", "periodLength", ",", 
         "  ", "mr", ",", " ", "1", ",", " ", 
         RowBox[{"\"\<blockDistance\>\"", "\[Rule]", " ", "blockDistance"}], 
         ",", 
         RowBox[{
         "\"\<blockSubdivision\>\"", "\[Rule]", " ", "blockSubdivision"}], 
         ",", " ", 
         RowBox[{
         "\"\<rectangularShape\>\"", "\[Rule]", " ", "rectangularShape"}], 
         ",", " ", 
         RowBox[{
         "\"\<terminationStart\>\"", "\[Rule]", " ", "terminationStart"}], 
         ",", " ", 
         RowBox[{
         "\"\<terminationEnd\>\"", "\[Rule]", " ", "terminationEnd"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"cidShift", " ", "=", " ", 
       RowBox[{"dP", "-", "dCP"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"cid", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"cid", ",", 
         RowBox[{"radTrfTrsl", "[", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "gap"}], "/", "2"}], "-", 
             RowBox[{"dG", "/", "2"}]}], ",", "cidShift"}], "}"}], "]"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"cie", " ", "=", " ", 
       RowBox[{"idCassette", "[", 
        RowBox[{
        "mirrorBlockShape", ",", " ", "nrPeriods", ",", " ", "periodLength", 
         ",", "  ", "mr", ",", " ", "1", ",", " ", 
         RowBox[{"\"\<blockDistance\>\"", "\[Rule]", " ", "blockDistance"}], 
         ",", 
         RowBox[{
         "\"\<blockSubdivision\>\"", "\[Rule]", " ", "blockSubdivision"}], 
         ",", " ", 
         RowBox[{
         "\"\<rectangularShape\>\"", "\[Rule]", " ", "rectangularShape"}], 
         ",", " ", 
         RowBox[{
         "\"\<terminationStart\>\"", "\[Rule]", " ", "terminationStart"}], 
         ",", " ", 
         RowBox[{
         "\"\<terminationEnd\>\"", "\[Rule]", " ", "terminationEnd"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"cieShift", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"cie", " ", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"cie", ",", 
         RowBox[{"radTrfTrsl", "[", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "gap"}], "/", "2"}], "-", 
             RowBox[{"dG", "/", "2"}]}], ",", "cieShift"}], "}"}], "]"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"device", " ", "=", " ", 
       RowBox[{"radObjCnt", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"csd", ",", " ", "cse", ",", " ", "cid", ",", " ", "cie"}], 
          "}"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "device", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7667563716198864`*^9, 3.76675637607336*^9}, {
   3.7667564210925236`*^9, 3.7667565039740367`*^9}, {3.767445221866372*^9, 
   3.7674452499623413`*^9}, 3.7674492825809617`*^9, {3.7826372836996193`*^9, 
   3.782637315936621*^9}, {3.782637359577076*^9, 3.7826374825765934`*^9}, {
   3.782637552607568*^9, 3.78263768450115*^9}, {3.782637743188423*^9, 
   3.7826378222055535`*^9}, {3.782637856189788*^9, 3.782637902285347*^9}, {
   3.782637956646202*^9, 3.7826379589118185`*^9}, {3.7826379963510313`*^9, 
   3.7826380522744694`*^9}, {3.7826380832169104`*^9, 3.782638439756551*^9}, {
   3.7826384823501635`*^9, 3.7826385761329775`*^9}, {3.782638608587835*^9, 
   3.782638715809715*^9}, {3.7826388457671947`*^9, 3.7826390394108934`*^9}, {
   3.7826391010200243`*^9, 3.782639101770018*^9}, {3.782639166051016*^9, 
   3.782639483428545*^9}, {3.782639556287635*^9, 3.782639561334486*^9}, {
   3.7826396491173325`*^9, 3.7826398286009946`*^9}, {3.7826399117901325`*^9, 
   3.7826400534547825`*^9}, {3.782640090532792*^9, 3.7826405585668488`*^9}, {
   3.782640594521858*^9, 3.782640772400242*^9}, {3.7826408291968937`*^9, 
   3.782641220744748*^9}, {3.782641266900818*^9, 3.782641439540758*^9}, {
   3.7826415380716205`*^9, 3.782641576430842*^9}, {3.7826416069325433`*^9, 
   3.782641900267953*^9}, {3.782642091536579*^9, 3.7826421241301994`*^9}, {
   3.782642159770681*^9, 3.782642183333087*^9}, {3.782642768258963*^9, 
   3.7826428182481303`*^9}, {3.7826428851853724`*^9, 
   3.7826429424839563`*^9}, {3.782642980298272*^9, 3.7826429824232635`*^9}, {
   3.7826430294252024`*^9, 3.782643045909505*^9}, {3.782643084190604*^9, 
   3.782643129690423*^9}, {3.7826432037264595`*^9, 3.7826433699932384`*^9}, {
   3.782643405307832*^9, 3.782643478420932*^9}, {3.782643611689359*^9, 
   3.7826438111124973`*^9}, {3.782644897374318*^9, 3.782644921501483*^9}, {
   3.7826450171885633`*^9, 3.782645044032238*^9}, 3.7826450852820787`*^9, {
   3.7826451379869146`*^9, 3.782645156986842*^9}, {3.7834337430222216`*^9, 
   3.7834337438503695`*^9}, {3.7834338345867214`*^9, 3.783433837758585*^9}, {
   3.7849719852731423`*^9, 3.784971987038904*^9}, {3.8006905477684984`*^9, 
   3.8006906423307467`*^9}, {3.800690756221059*^9, 3.800690766236659*^9}, {
   3.8006909297238693`*^9, 3.8006910255517483`*^9}, 3.8006912303535028`*^9, {
   3.8045059921675367`*^9, 3.804505996669073*^9}, {3.804850797352042*^9, 
   3.804850807477048*^9}, {3.8049517589196978`*^9, 3.8049517615685425`*^9}, {
   3.8062286811290216`*^9, 3.806228721202465*^9}, {3.806228979261788*^9, 
   3.8062290170507536`*^9}, {3.8062291180831394`*^9, 3.80622916799267*^9}, {
   3.8062292322098484`*^9, 3.8062293461602297`*^9}, {3.806230986856161*^9, 
   3.8062309872205615`*^9}, {3.806231021987795*^9, 3.8062310387314997`*^9}, 
   3.8062310746834383`*^9, {3.8062311117960773`*^9, 3.8062311267617693`*^9}, {
   3.806231197379216*^9, 3.8062313083139057`*^9}, {3.806231354665861*^9, 
   3.806231359055117*^9}, {3.8062313929050198`*^9, 3.806231398383541*^9}, {
   3.8062314489701333`*^9, 3.8062314964060936`*^9}, {3.806231649251237*^9, 
   3.806231652025425*^9}, {3.8062317279393225`*^9, 3.8062317396088457`*^9}, {
   3.806231974992104*^9, 3.806231975324426*^9}, {3.8062321842108383`*^9, 
   3.80623219202647*^9}, 3.8062322825326595`*^9, {3.806232352649621*^9, 
   3.806232387879024*^9}, {3.8062324469851923`*^9, 3.806232511381152*^9}, {
   3.806232544003265*^9, 3.806232588714759*^9}, {3.8062326239026313`*^9, 
   3.8062326400794697`*^9}, {3.8062326931090703`*^9, 3.806232717248754*^9}, {
   3.806232848010804*^9, 3.8062328589514856`*^9}, {3.8062329608016596`*^9, 
   3.8062329717030077`*^9}, {3.806233107012436*^9, 3.8062331071380606`*^9}, {
   3.806233213092393*^9, 3.806233243495797*^9}, 3.806234151752848*^9, {
   3.811790973348828*^9, 3.81179100069236*^9}, {3.811791034750472*^9, 
   3.8117918513521185`*^9}, {3.811821899399679*^9, 3.811821912870348*^9}, {
   3.8118219737455*^9, 3.811822031222424*^9}, {3.8118220718652563`*^9, 
   3.811822110434097*^9}, {3.8118221498110332`*^9, 3.811822379446498*^9}, 
   3.811822412301318*^9, {3.811822598318445*^9, 3.8118226064557867`*^9}, {
   3.8118236629202824`*^9, 3.811823666303432*^9}, {3.8118536066983304`*^9, 
   3.811853628423772*^9}, {3.8125360888714266`*^9, 3.812536115075982*^9}, {
   3.8125362241527753`*^9, 3.8125362243227973`*^9}, {3.8125362689155827`*^9, 
   3.812536357981106*^9}, {3.8125368905814185`*^9, 3.812536942974682*^9}, {
   3.8125371437134495`*^9, 3.8125371631846704`*^9}, 3.81253729351833*^9, {
   3.8125376101392884`*^9, 3.8125376239801445`*^9}, {3.812537684383421*^9, 
   3.812537841361286*^9}, {3.81253803235649*^9, 3.8125380890700197`*^9}, {
   3.8125382022470665`*^9, 3.8125382524901934`*^9}, {3.812538309483726*^9, 
   3.812538316174163*^9}, {3.8125383476761227`*^9, 3.812538430481282*^9}, {
   3.812538499316957*^9, 3.812538570231386*^9}, {3.8125386112639303`*^9, 
   3.8125386137440615`*^9}, {3.8125386808282604`*^9, 3.812538734463213*^9}, {
   3.8125387952170124`*^9, 3.812538796667104*^9}, {3.812538929406506*^9, 
   3.812538939967165*^9}, {3.812538975559382*^9, 3.812538976679451*^9}, {
   3.8125392861109715`*^9, 3.8125393135226855`*^9}, {3.8125393440945807`*^9, 
   3.812539362055702*^9}, {3.8125394140889397`*^9, 3.812539486052806*^9}, {
   3.8125395280254173`*^9, 3.8125395869290843`*^9}, {3.81254011903574*^9, 
   3.812540161078357*^9}, {3.8125402002707767`*^9, 3.8125402135216017`*^9}, {
   3.8125402523840218`*^9, 3.81254026043453*^9}, {3.8125403715414453`*^9, 
   3.812540473097768*^9}, {3.812540511900181*^9, 3.8125405877695456`*^9}, {
   3.8125406375926485`*^9, 3.8125406401728096`*^9}, 3.8125409888186436`*^9, {
   3.8161781061534595`*^9, 3.8161781816375327`*^9}, {3.8161782517015753`*^9, 
   3.8161782537484426`*^9}, {3.816180407779239*^9, 3.816180445466555*^9}, {
   3.816180792419794*^9, 3.8161807987791433`*^9}, {3.8161808354664993`*^9, 
   3.8161808403258495`*^9}, {3.8161809798409276`*^9, 
   3.8161810150283203`*^9}, {3.8161889397634106`*^9, 3.81618908146509*^9}, {
   3.8161891162204165`*^9, 3.816189364138302*^9}, {3.8161899024986024`*^9, 
   3.8161899764607897`*^9}, {3.816190016294608*^9, 3.816190017216479*^9}, {
   3.816190108478877*^9, 3.816190385809641*^9}, {3.816190519527711*^9, 
   3.8161905348104925`*^9}, {3.8161905702519407`*^9, 
   3.8161905732519293`*^9}, {3.816190623055337*^9, 3.8161906416986494`*^9}, {
   3.8161907314903755`*^9, 3.8161907542447243`*^9}, {3.816190796201868*^9, 
   3.8161908013282037`*^9}, {3.816190838324855*^9, 3.8161908438730707`*^9}, {
   3.816190926859888*^9, 3.8161909307192464`*^9}, {3.816612848368778*^9, 
   3.816612929305269*^9}, {3.8166130846927524`*^9, 3.816613231109089*^9}, {
   3.8166135535337315`*^9, 3.8166136584210224`*^9}, 3.816614204079871*^9, {
   3.816629081579727*^9, 3.8166291978863153`*^9}, {3.816629232772005*^9, 
   3.8166295026830626`*^9}, {3.816629555534605*^9, 3.8166297371760917`*^9}, {
   3.816629951096596*^9, 3.8166299826530952`*^9}, {3.816630661452345*^9, 
   3.816630662083006*^9}, {3.816630729595662*^9, 3.8166307485575027`*^9}, {
   3.816689523978589*^9, 3.816689526877671*^9}, {3.8166895597138705`*^9, 
   3.8166895615751925`*^9}, {3.8166989873184624`*^9, 
   3.8166990361209087`*^9}, {3.8166992608883195`*^9, 
   3.8166993279952765`*^9}, {3.8187637986771817`*^9, 
   3.8187638012972775`*^9}, {3.8187638459525676`*^9, 
   3.8187639719259357`*^9}, {3.818764014538122*^9, 3.8187640757616796`*^9}, {
   3.8188452591640754`*^9, 3.8188453011321845`*^9}, {3.818845341928625*^9, 
   3.818845343633266*^9}, {3.818845387624538*^9, 3.8188454153953238`*^9}, {
   3.8188454679220333`*^9, 3.8188455578771753`*^9}, {3.818845593376182*^9, 
   3.8188456421994534`*^9}, {3.823414349077173*^9, 3.823414429712388*^9}, {
   3.8234144684786463`*^9, 3.823414624258769*^9}, {3.8234146713979597`*^9, 
   3.82341477710907*^9}, {3.823414823530842*^9, 3.823414963995948*^9}, {
   3.823415084630122*^9, 3.823415220976251*^9}, {3.8234153104368486`*^9, 
   3.823415423494299*^9}, {3.8234154751410885`*^9, 3.8234156153528724`*^9}, {
   3.8234156586320543`*^9, 3.82341567964981*^9}, {3.8234157144127817`*^9, 
   3.8234157988179073`*^9}, {3.82341584103793*^9, 3.823415872652322*^9}, {
   3.8234159065466375`*^9, 3.823416243157824*^9}, {3.823416276577391*^9, 
   3.823416482894273*^9}, {3.8234165539780483`*^9, 3.8234167234485335`*^9}, {
   3.823416952346986*^9, 3.8234172303380632`*^9}, {3.823464698781279*^9, 
   3.8234647235240974`*^9}, {3.8234647704614844`*^9, 3.823464777049828*^9}, {
   3.8234650294832983`*^9, 3.8234651045484533`*^9}, {3.8234651634598*^9, 
   3.823465362171029*^9}, {3.823465399139107*^9, 3.8234654270404415`*^9}, {
   3.823465458080378*^9, 3.8234654737574244`*^9}, {3.8234655415220795`*^9, 
   3.8234656474426303`*^9}, {3.8234658757738495`*^9, 
   3.8234659424663754`*^9}, {3.823465987106947*^9, 3.823466155820458*^9}, {
   3.82346618806015*^9, 3.8234662200565567`*^9}, {3.823466259356388*^9, 
   3.8234664018879323`*^9}, {3.823466432840127*^9, 3.823466434466775*^9}, {
   3.8234665313694315`*^9, 3.823466555091982*^9}, {3.823466591004874*^9, 
   3.8234666173762712`*^9}, {3.8234667185036798`*^9, 
   3.8234668275079765`*^9}, {3.823466929213806*^9, 3.8234669534748797`*^9}, {
   3.8234696362312984`*^9, 3.8234696387355967`*^9}, {3.8234696745896482`*^9, 
   3.823469818086609*^9}, {3.8234698896830115`*^9, 3.8234699366902432`*^9}, {
   3.82346999296961*^9, 3.823469998053043*^9}, {3.823509525550356*^9, 
   3.823509526184658*^9}, {3.823509952919734*^9, 3.823509955487851*^9}, 
   3.8235102398897705`*^9, {3.823511467717247*^9, 3.823511470124797*^9}, {
   3.823511554941818*^9, 3.823511558568113*^9}, {3.823511643062001*^9, 
   3.8235116942978907`*^9}, {3.8235117290848017`*^9, 3.823511889851577*^9}, {
   3.82351192972188*^9, 3.823512019570406*^9}, {3.82351205596102*^9, 
   3.82351235513245*^9}, {3.8235124469746833`*^9, 3.8235124762623024`*^9}, {
   3.823512519086664*^9, 3.8235130955042243`*^9}, {3.8235131752986865`*^9, 
   3.8235131997063694`*^9}, {3.8235132306385927`*^9, 
   3.8235136190472064`*^9}, {3.823513798236662*^9, 3.82351382497212*^9}, {
   3.8235139345308933`*^9, 3.823513957724861*^9}, {3.82351413116971*^9, 
   3.8235141670736313`*^9}, {3.8235142414136906`*^9, 
   3.8235143169754844`*^9}, {3.8235149170995073`*^9, 
   3.8235151464277754`*^9}, {3.8235152168882537`*^9, 3.8235152307671185`*^9}, 
   3.8235154454156632`*^9, {3.8235156907621355`*^9, 3.823515877911276*^9}, {
   3.823515908314914*^9, 3.823515933359892*^9}, {3.8235857771038837`*^9, 
   3.823585845580636*^9}, {3.8235861731629033`*^9, 3.8235863857154436`*^9}, 
   3.82358644683704*^9, {3.8235864840040593`*^9, 3.8235865599998302`*^9}, {
   3.823586616753211*^9, 3.823586672941083*^9}, 3.8235867602320085`*^9, {
   3.823586830104992*^9, 3.8235868879182806`*^9}, {3.823586928422922*^9, 
   3.823587144450817*^9}, {3.8235873769027243`*^9, 3.823587413429014*^9}, {
   3.823587446893462*^9, 3.823587458796609*^9}, {3.8235876576724343`*^9, 
   3.8235879130316916`*^9}, {3.823587948860773*^9, 3.8235879547879505`*^9}, {
   3.823587999175168*^9, 3.823588114932392*^9}, {3.823588154112542*^9, 
   3.8235881588757973`*^9}, {3.8235882977281876`*^9, 
   3.8235883005396996`*^9}, {3.823588420575471*^9, 3.8235884349160557`*^9}, {
   3.8235885833463745`*^9, 3.8235886309081335`*^9}, {3.823588675478856*^9, 
   3.823588758139676*^9}, {3.8235889282584496`*^9, 3.8235891007877502`*^9}, {
   3.823589261015967*^9, 3.8235892618796716`*^9}, {3.8235893322553415`*^9, 
   3.823589355942937*^9}, {3.823589657255609*^9, 3.823589715213504*^9}, {
   3.8235898876909456`*^9, 3.823589902558157*^9}, {3.823589966866068*^9, 
   3.823589978881874*^9}, {3.823590040039212*^9, 3.823590050953046*^9}, {
   3.823590087899172*^9, 3.823590112640926*^9}, {3.8235901463816643`*^9, 
   3.8235901482406573`*^9}, {3.823590203917699*^9, 3.8235902307808104`*^9}, {
   3.823590281921956*^9, 3.8235903052694693`*^9}, {3.8235905235932255`*^9, 
   3.823590535604083*^9}, 3.8236085528288436`*^9, {3.8236105290942698`*^9, 
   3.8236107034776244`*^9}, {3.823610740303029*^9, 3.823610754313583*^9}, {
   3.8236245506384964`*^9, 3.82362493617677*^9}, {3.8236249670012817`*^9, 
   3.8236250139866157`*^9}, {3.8236250448540125`*^9, 3.823625081487977*^9}, {
   3.8236251466665545`*^9, 3.823625191545456*^9}, {3.8236252474398785`*^9, 
   3.8236252952339783`*^9}, {3.82362532527758*^9, 3.823625358174545*^9}, {
   3.8236254183664675`*^9, 3.8236254707223597`*^9}, {3.8236255214765377`*^9, 
   3.8236257024791627`*^9}, {3.82362592487003*^9, 3.823625960495693*^9}, {
   3.82362604598695*^9, 3.8236260694710674`*^9}, {3.823626181301801*^9, 
   3.8236263068897195`*^9}, 3.823626411287345*^9},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[19]:=",ExpressionUUID->"569db941-87e0-406b-bfc0-c32a4ddccf45"]
}, Closed]],

Cell[CellGroupData[{

Cell["idAPU", "Subsection",
 CellChangeTimes->{{3.766754730782276*^9, 3.7667547560811443`*^9}, {
  3.823414331626872*^9, 3.823414332902458*^9}, {3.8234144621854887`*^9, 
  3.8234144630332193`*^9}, {3.823509521275796*^9, 3.823509521913088*^9}, {
  3.823586476922537*^9, 3.8235864777136555`*^9}, {3.8236244850520477`*^9, 
  3.8236245063839254`*^9}, {3.8236266535789566`*^9, 
  3.823626655571662*^9}},ExpressionUUID->"a0a5e4ac-9fa0-405c-83fd-\
3ce22ce8faeb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idAPU", "::", "usage"}], "=", 
    "\"\<idAPU[nrPeriods, periodLength, mr, gap, \\\"dG\\\"\[Rule] 0, \
\\\"blockShape\\\"\[Rule] \\\"default\\\", \\\"blockDistance\\\"\[Rule] 0,  \
\\\"blockSubdivision\\\"\[Rule] {}, \\\"rectangularShape\\\"\[Rule] False, \\\
\"terminationStart\\\"\[Rule] {}, \\\"terminationEnd\\\"\[Rule] {}]: Returns \
the insertion device model. \\n\\nArgs: \\nnrPeriods is the number of periods \
of the casssette, \\nperiodLength [mm] is the insertion device period length, \
 \\nmr [T] is remanent magnetization value, \\ngap [mm] if the insertion \
device minimum gap. \\n\\nOptional args: \\ndG [mm] is the longitudinal \
displacement used to control the field amplitude, \\nblockShape [mm] is a \
list of {x, y} points defining the block shapes or a predefined shape name, \
\\nblockDistance [mm] is the longitudinal distance between blocks, \
\\nblockSubdivision is the subdivision to be apply to the blocks (must have \
the same length as blockShape), \\nrectangularShape is True if the block \
shapes are rectangular and False otherwise, \\nterminationStart is a list of \
lists with the lengths [mm] and distances [mm] for the termination at the \
start of the insertion device, \\nterminationEnd is the same as \
terminationStart for the termination at the end of the insertion \
device.\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idAPU", "::", "gapErr"}], " ", "=", 
    "\"\<Invalid value for gap argument: `1`\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idAPU", "[", 
    RowBox[{
    "nrPeriods_", ",", " ", "periodLength_", ",", " ", "mr_", ",", " ", 
     "gap_", ",", "  ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<dG\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<blockShape\>\"", "\[Rule]", " ", "\"\<kyma22\>\""}], ",",
         "  ", 
        RowBox[{"\"\<blockDistance\>\"", "\[Rule]", " ", "0"}], ",", 
        RowBox[{"\"\<blockSubdivision\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<rectangularShape\>\"", "\[Rule]", " ", "False"}], ",", 
        "  ", 
        RowBox[{"\"\<terminationStart\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<terminationEnd\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}]}], "}"}], "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "i", ",", " ", "dG", ",", " ", "blockShapeInput", ",", " ", 
       "blockShapeA", ",", " ", "blockShapeB", ",", "blockShapeC", ",", " ", 
       "blockShape", ",", " ", "blockDistance", ",", " ", "rectangularShape", 
       ",", " ", "blockSubdivision", ",", " ", "terminationStart", ",", " ", 
       "terminationEnd", ",", "\[IndentingNewLine]", "cs", ",", " ", "ci", 
       ",", " ", "csShift", ",", " ", "ciShift", ",", " ", "device"}], "}"}], 
     ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Delete", " ", "previous", " ", "Radia", " ", "objects"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"radUtiDelAll", "[", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Optional", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"dG", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<dG\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"blockShapeInput", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<blockShape\>\"", "]"}]}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"blockDistance", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<blockDistance\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"blockSubdivision", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<blockSubdivision\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"rectangularShape", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<rectangularShape\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"terminationStart", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<terminationStart\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"terminationEnd", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<terminationEnd\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Check", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"gap", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"idDelta", "::", "gapErr"}], ",", " ", "gap"}], " ", "]"}],
          ";", 
         RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"blockShape", " ", "=", " ", "blockShapeInput"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Which", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"blockShapeInput", "\[Equal]", " ", "\"\<kyma22\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"blockShapeA", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", " ", 
             RowBox[{"15", ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"18", ",", " ", 
              RowBox[{"-", "3"}]}], "}"}], ",", 
            RowBox[{"{", " ", 
             RowBox[{"18", ",", " ", 
              RowBox[{"-", "17"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"15", ",", 
              RowBox[{"-", "20"}]}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "15"}], ",", "  ", 
              RowBox[{"-", "20"}]}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "18"}], ",", " ", 
              RowBox[{"-", " ", "17"}]}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "18"}], ",", "  ", 
              RowBox[{"-", "3"}]}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "15"}], ",", " ", "0"}], " ", "}"}]}], "}"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"blockShape", " ", "=", " ", 
          RowBox[{"{", "blockShapeA", "}"}]}], ";"}]}], "\[IndentingNewLine]",
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"cs", " ", "=", " ", 
       RowBox[{"idCassette", "[", 
        RowBox[{
        "blockShape", ",", " ", "nrPeriods", ",", " ", "periodLength", ",", 
         "  ", "mr", ",", " ", "3", ",", " ", 
         RowBox[{"\"\<blockDistance\>\"", "\[Rule]", " ", "blockDistance"}], 
         ",", 
         RowBox[{
         "\"\<blockSubdivision\>\"", "\[Rule]", " ", "blockSubdivision"}], 
         ",", " ", 
         RowBox[{
         "\"\<rectangularShape\>\"", "\[Rule]", " ", "rectangularShape"}], 
         ",", 
         RowBox[{
         "\"\<terminationStart\>\"", "\[Rule]", " ", "terminationStart"}], 
         ",", " ", 
         RowBox[{
         "\"\<terminationEnd\>\"", "\[Rule]", " ", "terminationEnd"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"csShift", " ", "=", " ", "dG"}], ";", "\[IndentingNewLine]", 
      RowBox[{"cs", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"cs", ",", 
         RowBox[{"radTrfTrsl", "[", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"-", "gap"}], "/", "2"}], ",", "csShift"}], "}"}], 
          "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"cs", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"cs", ",", " ", 
         RowBox[{"radTrfRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", "\[Pi]"}], "]"}]}],
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"ci", "=", 
       RowBox[{"idCassette", "[", 
        RowBox[{
        "blockShape", ",", " ", "nrPeriods", ",", " ", "periodLength", ",", 
         "  ", "mr", ",", " ", "1", ",", " ", 
         RowBox[{"\"\<blockDistance\>\"", "\[Rule]", " ", "blockDistance"}], 
         ",", 
         RowBox[{
         "\"\<blockSubdivision\>\"", "\[Rule]", " ", "blockSubdivision"}], 
         ",", " ", 
         RowBox[{
         "\"\<rectangularShape\>\"", "\[Rule]", " ", "rectangularShape"}], 
         ",", " ", 
         RowBox[{
         "\"\<terminationStart\>\"", "\[Rule]", " ", "terminationStart"}], 
         ",", " ", 
         RowBox[{
         "\"\<terminationEnd\>\"", "\[Rule]", " ", "terminationEnd"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ciShift", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"ci", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"ci", ",", 
         RowBox[{"radTrfTrsl", "[", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"-", "gap"}], "/", "2"}], ",", "ciShift"}], "}"}], 
          "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"device", " ", "=", " ", 
       RowBox[{"radObjCnt", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"cs", ",", " ", "ci"}], "}"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "device", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7667563716198864`*^9, 3.76675637607336*^9}, {
   3.7667564210925236`*^9, 3.7667565039740367`*^9}, {3.767445221866372*^9, 
   3.7674452499623413`*^9}, 3.7674492825809617`*^9, {3.7826372836996193`*^9, 
   3.782637315936621*^9}, {3.782637359577076*^9, 3.7826374825765934`*^9}, {
   3.782637552607568*^9, 3.78263768450115*^9}, {3.782637743188423*^9, 
   3.7826378222055535`*^9}, {3.782637856189788*^9, 3.782637902285347*^9}, {
   3.782637956646202*^9, 3.7826379589118185`*^9}, {3.7826379963510313`*^9, 
   3.7826380522744694`*^9}, {3.7826380832169104`*^9, 3.782638439756551*^9}, {
   3.7826384823501635`*^9, 3.7826385761329775`*^9}, {3.782638608587835*^9, 
   3.782638715809715*^9}, {3.7826388457671947`*^9, 3.7826390394108934`*^9}, {
   3.7826391010200243`*^9, 3.782639101770018*^9}, {3.782639166051016*^9, 
   3.782639483428545*^9}, {3.782639556287635*^9, 3.782639561334486*^9}, {
   3.7826396491173325`*^9, 3.7826398286009946`*^9}, {3.7826399117901325`*^9, 
   3.7826400534547825`*^9}, {3.782640090532792*^9, 3.7826405585668488`*^9}, {
   3.782640594521858*^9, 3.782640772400242*^9}, {3.7826408291968937`*^9, 
   3.782641220744748*^9}, {3.782641266900818*^9, 3.782641439540758*^9}, {
   3.7826415380716205`*^9, 3.782641576430842*^9}, {3.7826416069325433`*^9, 
   3.782641900267953*^9}, {3.782642091536579*^9, 3.7826421241301994`*^9}, {
   3.782642159770681*^9, 3.782642183333087*^9}, {3.782642768258963*^9, 
   3.7826428182481303`*^9}, {3.7826428851853724`*^9, 
   3.7826429424839563`*^9}, {3.782642980298272*^9, 3.7826429824232635`*^9}, {
   3.7826430294252024`*^9, 3.782643045909505*^9}, {3.782643084190604*^9, 
   3.782643129690423*^9}, {3.7826432037264595`*^9, 3.7826433699932384`*^9}, {
   3.782643405307832*^9, 3.782643478420932*^9}, {3.782643611689359*^9, 
   3.7826438111124973`*^9}, {3.782644897374318*^9, 3.782644921501483*^9}, {
   3.7826450171885633`*^9, 3.782645044032238*^9}, 3.7826450852820787`*^9, {
   3.7826451379869146`*^9, 3.782645156986842*^9}, {3.7834337430222216`*^9, 
   3.7834337438503695`*^9}, {3.7834338345867214`*^9, 3.783433837758585*^9}, {
   3.7849719852731423`*^9, 3.784971987038904*^9}, {3.8006905477684984`*^9, 
   3.8006906423307467`*^9}, {3.800690756221059*^9, 3.800690766236659*^9}, {
   3.8006909297238693`*^9, 3.8006910255517483`*^9}, 3.8006912303535028`*^9, {
   3.8045059921675367`*^9, 3.804505996669073*^9}, {3.804850797352042*^9, 
   3.804850807477048*^9}, {3.8049517589196978`*^9, 3.8049517615685425`*^9}, {
   3.8062286811290216`*^9, 3.806228721202465*^9}, {3.806228979261788*^9, 
   3.8062290170507536`*^9}, {3.8062291180831394`*^9, 3.80622916799267*^9}, {
   3.8062292322098484`*^9, 3.8062293461602297`*^9}, {3.806230986856161*^9, 
   3.8062309872205615`*^9}, {3.806231021987795*^9, 3.8062310387314997`*^9}, 
   3.8062310746834383`*^9, {3.8062311117960773`*^9, 3.8062311267617693`*^9}, {
   3.806231197379216*^9, 3.8062313083139057`*^9}, {3.806231354665861*^9, 
   3.806231359055117*^9}, {3.8062313929050198`*^9, 3.806231398383541*^9}, {
   3.8062314489701333`*^9, 3.8062314964060936`*^9}, {3.806231649251237*^9, 
   3.806231652025425*^9}, {3.8062317279393225`*^9, 3.8062317396088457`*^9}, {
   3.806231974992104*^9, 3.806231975324426*^9}, {3.8062321842108383`*^9, 
   3.80623219202647*^9}, 3.8062322825326595`*^9, {3.806232352649621*^9, 
   3.806232387879024*^9}, {3.8062324469851923`*^9, 3.806232511381152*^9}, {
   3.806232544003265*^9, 3.806232588714759*^9}, {3.8062326239026313`*^9, 
   3.8062326400794697`*^9}, {3.8062326931090703`*^9, 3.806232717248754*^9}, {
   3.806232848010804*^9, 3.8062328589514856`*^9}, {3.8062329608016596`*^9, 
   3.8062329717030077`*^9}, {3.806233107012436*^9, 3.8062331071380606`*^9}, {
   3.806233213092393*^9, 3.806233243495797*^9}, 3.806234151752848*^9, {
   3.811790973348828*^9, 3.81179100069236*^9}, {3.811791034750472*^9, 
   3.8117918513521185`*^9}, {3.811821899399679*^9, 3.811821912870348*^9}, {
   3.8118219737455*^9, 3.811822031222424*^9}, {3.8118220718652563`*^9, 
   3.811822110434097*^9}, {3.8118221498110332`*^9, 3.811822379446498*^9}, 
   3.811822412301318*^9, {3.811822598318445*^9, 3.8118226064557867`*^9}, {
   3.8118236629202824`*^9, 3.811823666303432*^9}, {3.8118536066983304`*^9, 
   3.811853628423772*^9}, {3.8125360888714266`*^9, 3.812536115075982*^9}, {
   3.8125362241527753`*^9, 3.8125362243227973`*^9}, {3.8125362689155827`*^9, 
   3.812536357981106*^9}, {3.8125368905814185`*^9, 3.812536942974682*^9}, {
   3.8125371437134495`*^9, 3.8125371631846704`*^9}, 3.81253729351833*^9, {
   3.8125376101392884`*^9, 3.8125376239801445`*^9}, {3.812537684383421*^9, 
   3.812537841361286*^9}, {3.81253803235649*^9, 3.8125380890700197`*^9}, {
   3.8125382022470665`*^9, 3.8125382524901934`*^9}, {3.812538309483726*^9, 
   3.812538316174163*^9}, {3.8125383476761227`*^9, 3.812538430481282*^9}, {
   3.812538499316957*^9, 3.812538570231386*^9}, {3.8125386112639303`*^9, 
   3.8125386137440615`*^9}, {3.8125386808282604`*^9, 3.812538734463213*^9}, {
   3.8125387952170124`*^9, 3.812538796667104*^9}, {3.812538929406506*^9, 
   3.812538939967165*^9}, {3.812538975559382*^9, 3.812538976679451*^9}, {
   3.8125392861109715`*^9, 3.8125393135226855`*^9}, {3.8125393440945807`*^9, 
   3.812539362055702*^9}, {3.8125394140889397`*^9, 3.812539486052806*^9}, {
   3.8125395280254173`*^9, 3.8125395869290843`*^9}, {3.81254011903574*^9, 
   3.812540161078357*^9}, {3.8125402002707767`*^9, 3.8125402135216017`*^9}, {
   3.8125402523840218`*^9, 3.81254026043453*^9}, {3.8125403715414453`*^9, 
   3.812540473097768*^9}, {3.812540511900181*^9, 3.8125405877695456`*^9}, {
   3.8125406375926485`*^9, 3.8125406401728096`*^9}, 3.8125409888186436`*^9, {
   3.8161781061534595`*^9, 3.8161781816375327`*^9}, {3.8161782517015753`*^9, 
   3.8161782537484426`*^9}, {3.816180407779239*^9, 3.816180445466555*^9}, {
   3.816180792419794*^9, 3.8161807987791433`*^9}, {3.8161808354664993`*^9, 
   3.8161808403258495`*^9}, {3.8161809798409276`*^9, 
   3.8161810150283203`*^9}, {3.8161889397634106`*^9, 3.81618908146509*^9}, {
   3.8161891162204165`*^9, 3.816189364138302*^9}, {3.8161899024986024`*^9, 
   3.8161899764607897`*^9}, {3.816190016294608*^9, 3.816190017216479*^9}, {
   3.816190108478877*^9, 3.816190385809641*^9}, {3.816190519527711*^9, 
   3.8161905348104925`*^9}, {3.8161905702519407`*^9, 
   3.8161905732519293`*^9}, {3.816190623055337*^9, 3.8161906416986494`*^9}, {
   3.8161907314903755`*^9, 3.8161907542447243`*^9}, {3.816190796201868*^9, 
   3.8161908013282037`*^9}, {3.816190838324855*^9, 3.8161908438730707`*^9}, {
   3.816190926859888*^9, 3.8161909307192464`*^9}, {3.816612848368778*^9, 
   3.816612929305269*^9}, {3.8166130846927524`*^9, 3.816613231109089*^9}, {
   3.8166135535337315`*^9, 3.8166136584210224`*^9}, 3.816614204079871*^9, {
   3.816629081579727*^9, 3.8166291978863153`*^9}, {3.816629232772005*^9, 
   3.8166295026830626`*^9}, {3.816629555534605*^9, 3.8166297371760917`*^9}, {
   3.816629951096596*^9, 3.8166299826530952`*^9}, {3.816630661452345*^9, 
   3.816630662083006*^9}, {3.816630729595662*^9, 3.8166307485575027`*^9}, {
   3.816689523978589*^9, 3.816689526877671*^9}, {3.8166895597138705`*^9, 
   3.8166895615751925`*^9}, {3.8166989873184624`*^9, 
   3.8166990361209087`*^9}, {3.8166992608883195`*^9, 
   3.8166993279952765`*^9}, {3.8187637986771817`*^9, 
   3.8187638012972775`*^9}, {3.8187638459525676`*^9, 
   3.8187639719259357`*^9}, {3.818764014538122*^9, 3.8187640757616796`*^9}, {
   3.8188452591640754`*^9, 3.8188453011321845`*^9}, {3.818845341928625*^9, 
   3.818845343633266*^9}, {3.818845387624538*^9, 3.8188454153953238`*^9}, {
   3.8188454679220333`*^9, 3.8188455578771753`*^9}, {3.818845593376182*^9, 
   3.8188456421994534`*^9}, {3.823414349077173*^9, 3.823414429712388*^9}, {
   3.8234144684786463`*^9, 3.823414624258769*^9}, {3.8234146713979597`*^9, 
   3.82341477710907*^9}, {3.823414823530842*^9, 3.823414963995948*^9}, {
   3.823415084630122*^9, 3.823415220976251*^9}, {3.8234153104368486`*^9, 
   3.823415423494299*^9}, {3.8234154751410885`*^9, 3.8234156153528724`*^9}, {
   3.8234156586320543`*^9, 3.82341567964981*^9}, {3.8234157144127817`*^9, 
   3.8234157988179073`*^9}, {3.82341584103793*^9, 3.823415872652322*^9}, {
   3.8234159065466375`*^9, 3.823416243157824*^9}, {3.823416276577391*^9, 
   3.823416482894273*^9}, {3.8234165539780483`*^9, 3.8234167234485335`*^9}, {
   3.823416952346986*^9, 3.8234172303380632`*^9}, {3.823464698781279*^9, 
   3.8234647235240974`*^9}, {3.8234647704614844`*^9, 3.823464777049828*^9}, {
   3.8234650294832983`*^9, 3.8234651045484533`*^9}, {3.8234651634598*^9, 
   3.823465362171029*^9}, {3.823465399139107*^9, 3.8234654270404415`*^9}, {
   3.823465458080378*^9, 3.8234654737574244`*^9}, {3.8234655415220795`*^9, 
   3.8234656474426303`*^9}, {3.8234658757738495`*^9, 
   3.8234659424663754`*^9}, {3.823465987106947*^9, 3.823466155820458*^9}, {
   3.82346618806015*^9, 3.8234662200565567`*^9}, {3.823466259356388*^9, 
   3.8234664018879323`*^9}, {3.823466432840127*^9, 3.823466434466775*^9}, {
   3.8234665313694315`*^9, 3.823466555091982*^9}, {3.823466591004874*^9, 
   3.8234666173762712`*^9}, {3.8234667185036798`*^9, 
   3.8234668275079765`*^9}, {3.823466929213806*^9, 3.8234669534748797`*^9}, {
   3.8234696362312984`*^9, 3.8234696387355967`*^9}, {3.8234696745896482`*^9, 
   3.823469818086609*^9}, {3.8234698896830115`*^9, 3.8234699366902432`*^9}, {
   3.82346999296961*^9, 3.823469998053043*^9}, {3.823509525550356*^9, 
   3.823509526184658*^9}, {3.823509952919734*^9, 3.823509955487851*^9}, 
   3.8235102398897705`*^9, {3.823511467717247*^9, 3.823511470124797*^9}, {
   3.823511554941818*^9, 3.823511558568113*^9}, {3.823511643062001*^9, 
   3.8235116942978907`*^9}, {3.8235117290848017`*^9, 3.823511889851577*^9}, {
   3.82351192972188*^9, 3.823512019570406*^9}, {3.82351205596102*^9, 
   3.82351235513245*^9}, {3.8235124469746833`*^9, 3.8235124762623024`*^9}, {
   3.823512519086664*^9, 3.8235130955042243`*^9}, {3.8235131752986865`*^9, 
   3.8235131997063694`*^9}, {3.8235132306385927`*^9, 
   3.8235136190472064`*^9}, {3.823513798236662*^9, 3.82351382497212*^9}, {
   3.8235139345308933`*^9, 3.823513957724861*^9}, {3.82351413116971*^9, 
   3.8235141670736313`*^9}, {3.8235142414136906`*^9, 
   3.8235143169754844`*^9}, {3.8235149170995073`*^9, 
   3.8235151464277754`*^9}, {3.8235152168882537`*^9, 3.8235152307671185`*^9}, 
   3.8235154454156632`*^9, {3.8235156907621355`*^9, 3.823515877911276*^9}, {
   3.823515908314914*^9, 3.823515933359892*^9}, {3.8235857771038837`*^9, 
   3.823585845580636*^9}, {3.8235861731629033`*^9, 3.8235863857154436`*^9}, 
   3.82358644683704*^9, {3.8235864840040593`*^9, 3.8235865599998302`*^9}, {
   3.823586616753211*^9, 3.823586672941083*^9}, 3.8235867602320085`*^9, {
   3.823586830104992*^9, 3.8235868879182806`*^9}, {3.823586928422922*^9, 
   3.823587144450817*^9}, {3.8235873769027243`*^9, 3.823587413429014*^9}, {
   3.823587446893462*^9, 3.823587458796609*^9}, {3.8235876576724343`*^9, 
   3.8235879130316916`*^9}, {3.823587948860773*^9, 3.8235879547879505`*^9}, {
   3.823587999175168*^9, 3.823588114932392*^9}, {3.823588154112542*^9, 
   3.8235881588757973`*^9}, {3.8235882977281876`*^9, 
   3.8235883005396996`*^9}, {3.823588420575471*^9, 3.8235884349160557`*^9}, {
   3.8235885833463745`*^9, 3.8235886309081335`*^9}, {3.823588675478856*^9, 
   3.823588758139676*^9}, {3.8235889282584496`*^9, 3.8235891007877502`*^9}, {
   3.823589261015967*^9, 3.8235892618796716`*^9}, {3.8235893322553415`*^9, 
   3.823589355942937*^9}, {3.823589657255609*^9, 3.823589715213504*^9}, {
   3.8235898876909456`*^9, 3.823589902558157*^9}, {3.823589966866068*^9, 
   3.823589978881874*^9}, {3.823590040039212*^9, 3.823590050953046*^9}, {
   3.823590087899172*^9, 3.823590112640926*^9}, {3.8235901463816643`*^9, 
   3.8235901482406573`*^9}, {3.823590203917699*^9, 3.8235902307808104`*^9}, {
   3.823590281921956*^9, 3.8235903052694693`*^9}, {3.8235905235932255`*^9, 
   3.823590535604083*^9}, 3.8236085528288436`*^9, {3.8236105290942698`*^9, 
   3.8236107034776244`*^9}, {3.823610740303029*^9, 3.823610754313583*^9}, {
   3.8236245506384964`*^9, 3.82362493617677*^9}, {3.8236249670012817`*^9, 
   3.8236250139866157`*^9}, {3.8236250448540125`*^9, 3.823625081487977*^9}, {
   3.8236251466665545`*^9, 3.823625191545456*^9}, {3.8236252474398785`*^9, 
   3.8236252952339783`*^9}, {3.82362532527758*^9, 3.823625358174545*^9}, {
   3.8236254183664675`*^9, 3.8236254707223597`*^9}, {3.8236255214765377`*^9, 
   3.8236257024791627`*^9}, {3.82362592487003*^9, 3.823625960495693*^9}, {
   3.82362604598695*^9, 3.8236260694710674`*^9}, {3.823626181301801*^9, 
   3.8236263068897195`*^9}, 3.823626411287345*^9, {3.823626660512401*^9, 
   3.8236267972225556`*^9}, {3.8236268420456066`*^9, 3.8236269668725967`*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[22]:=",ExpressionUUID->"c72fa571-3554-48e3-bd7d-e28f899f46bd"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Utilities", "Section",
 CellChangeTimes->{{3.7663982103876667`*^9, 3.7663982168978977`*^9}, {
  3.7663982623594646`*^9, 
  3.766398265542498*^9}},ExpressionUUID->"f20aa789-107b-4ba9-a8ec-\
431d9a935df5"],

Cell[CellGroupData[{

Cell["idSolve", "Subsection",
 CellChangeTimes->{
  3.7667548496524267`*^9, {3.8119940063406706`*^9, 3.811994007491991*^9}, {
   3.8236165420662384`*^9, 
   3.8236165426057916`*^9}},ExpressionUUID->"26c81835-38a5-4a74-b320-\
8ad5dbdde227"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idSolve", "::", "usage"}], " ", "=", " ", 
    "\"\<idSolve[device, prec, naxIter, \\\"silent\\\"\[Rule] False]: Call \
RadSolve function and print results.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idSolve", "[", 
    RowBox[{"device_", ",", "  ", "prec_", ",", " ", "maxIter_", ",", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{"\"\<silent\>\"", "\[Rule]", " ", "False"}], "}"}], "]"}]}], 
    " ", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "sre", ",", " ", "sz", ",", " ", "t0", ",", " ", "t1", ",", " ", 
       "silent"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"silent", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<silent\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"sre", "=", 
       RowBox[{"RadSolve", "[", 
        RowBox[{"device", ",", "prec", ",", "maxIter"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sz", " ", "=", " ", 
       RowBox[{"radObjDegFre", "[", "device", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", " ", "silent"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Solved in: \>\"", ",", 
           RowBox[{
            RowBox[{"Round", "[", 
             RowBox[{"t1", "-", "t0"}], "]"}], "/", "60.0"}], ",", 
           "\"\< min\>\""}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Number of Degrees of Freedom = \>\"", ",", "sz"}], 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<Typical Memory Size of Interation Matrix [MBytes] = \>\"", ",", 
           RowBox[{"N", "[", 
            RowBox[{"sz", "*", 
             RowBox[{"(", 
              RowBox[{"sz", "+", "1"}], ")"}], "*", 
             RowBox[{"4", "/", "1000000"}]}], "]"}]}], "]"}], ";", " ", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<Average absolute change in magnetization between the last two \
iterations = \>\"", ",", 
           RowBox[{"sre", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<Maximum absolute value of magnetization over all the objects = \
\>\"", ",", 
           RowBox[{"sre", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<Maximum absolute value of magnetic field strength over central \
points of all the objects = \>\"", ",", 
           RowBox[{"sre", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Number of iterations done = \>\"", ",", 
           RowBox[{"sre", "[", 
            RowBox[{"[", "4", "]"}], "]"}], ",", " ", "\"\<\\n\>\""}], "]"}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.811994080047217*^9, 3.811994158715458*^9}, {
  3.8119942336302195`*^9, 3.8119942569198236`*^9}, {3.811994358880513*^9, 
  3.811994431713492*^9}, {3.8119944656793065`*^9, 3.8119945642559*^9}, {
  3.8157453072264175`*^9, 3.8157453789063025`*^9}, {3.8236165386124725`*^9, 
  3.823616636971261*^9}, {3.8236167124073877`*^9, 3.8236167128541956`*^9}, {
  3.823617431875698*^9, 3.8236174810377913`*^9}, {3.823618172804639*^9, 
  3.823618188603362*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[25]:=",ExpressionUUID->"fce3d94d-6746-4041-b916-22ab05e4baf7"]
}, Closed]],

Cell[CellGroupData[{

Cell["idShow", "Subsection",
 CellChangeTimes->{
  3.766754821368951*^9, {3.823617496975554*^9, 
   3.8236174975011373`*^9}},ExpressionUUID->"8c6d00d2-3a3f-490e-951b-\
602c40d52fe4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idShow", "::", "usage"}], " ", "=", " ", 
    "\"\<idShow[device, \\\"showMr\\\"\[Rule] False, \\\"arrowSize\\\"\[Rule] \
10, \\\"arrowHeadSize\\\"\[Rule] Medium]: Show the insertion device \
model.\>\""}], ";"}], " ", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idShow", "[", 
    RowBox[{"device_", ",", " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<showMr\>\"", "\[Rule]", " ", "False"}], ",", "  ", 
        RowBox[{"\"\<arrowSize\>\"", "\[Rule]", " ", "10"}], ",", " ", 
        RowBox[{"\"\<arrowHeadSize\>\"", "\[Rule]", "Medium"}]}], "}"}], 
      "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "showMr", ",", " ", "arrowSize", " ", ",", " ", "arrowHeadSize", " ", 
       ",", " ", "objM", " ", ",", " ", "arrowList", ",", " ", "t0", ",", " ",
        "t1"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"RadPlot3DOptions", "[", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"showMr", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<showMr\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"arrowSize", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<arrowSize\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"arrowHeadSize", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<arrowHeadSize\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"showMr", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"objM", " ", "=", " ", 
          RowBox[{"radObjM", "[", "device", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"arrowList", " ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"idBlockArrow", "[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", " ", "arrowSize"}], "]"}],
             "&"}], "/@", "objM"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"Graphics3D", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Opacity", "[", "0.5", "]"}], ",", " ", 
              RowBox[{"radObjDrw", "[", "device", "]"}], ",", 
              RowBox[{"Opacity", "[", "1", "]"}], ",", 
              RowBox[{"Arrowheads", "[", "arrowHeadSize", "]"}], ",", 
              "arrowList"}], "}"}], ",", " ", 
            RowBox[{"BaseStyle", " ", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{"12", ",", " ", 
               RowBox[{
               "FontFamily", " ", "\[Rule]", " ", "\"\<Calibri\>\""}]}], 
              "}"}]}]}], "]"}], "]"}], ";"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"Graphics3D", "[", 
           RowBox[{
            RowBox[{"radObjDrw", "[", "device", "]"}], ",", 
            RowBox[{"BaseStyle", " ", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{"16", ",", " ", 
               RowBox[{
               "FontFamily", " ", "\[Rule]", " ", "\"\<Calibri\>\""}]}], 
              "}"}]}]}], "]"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
      ";"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.7667558489826016`*^9, 3.766755892642285*^9}, {
   3.76675595766302*^9, 3.7667561689633245`*^9}, {3.7667562043411093`*^9, 
   3.766756256829613*^9}, 3.7667563179437857`*^9, 3.766757279583788*^9, {
   3.7674475847961235`*^9, 3.7674476020787315`*^9}, {3.767447784535589*^9, 
   3.767447797099101*^9}, {3.8119962560447073`*^9, 3.811996256795929*^9}, {
   3.8157454068773603`*^9, 3.815745432178673*^9}, {3.823617499774063*^9, 
   3.823617675700945*^9}, {3.8236177704444084`*^9, 3.823617771988284*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[27]:=",ExpressionUUID->"413e2a38-7932-4c0a-85df-2ece1567812f"]
}, Closed]],

Cell[CellGroupData[{

Cell["idBlockArrow", "Subsection",
 CellChangeTimes->{
  3.766754730782276*^9, {3.8236178313831472`*^9, 
   3.823617831551728*^9}},ExpressionUUID->"52194e79-993f-4f5b-8b53-\
64c60481d580"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idBlockArrow", "::", "usage"}], " ", "=", " ", 
    "\"\<idBlockArrow[blockCenter, blockMr, arrowSize]: Returns a arrow in \
the direction of the block magnetization.\>\""}], ";"}], " ", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idBlockArrow", "[", 
    RowBox[{"blockCenter_", ",", " ", "blockMr_", ",", " ", "arrowSize_"}], 
    "]"}], ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"mrArrow", ",", " ", "mrDirection"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mrDirection", " ", "=", " ", 
       RowBox[{"Normalize", "[", "blockMr", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mrArrow", " ", "=", " ", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"blockCenter", " ", "-", " ", 
           RowBox[{"mrDirection", " ", "*", 
            RowBox[{"arrowSize", "/", "2"}]}]}], ",", " ", 
          RowBox[{"blockCenter", " ", "+", " ", 
           RowBox[{"mrDirection", " ", "*", 
            RowBox[{"arrowSize", "/", "2"}]}]}]}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "mrArrow", "]"}], ";"}]}], "\[IndentingNewLine]",
     "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.823617838555989*^9, 3.823617957843767*^9}, {
  3.8236181954560223`*^9, 3.8236181963187523`*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[29]:=",ExpressionUUID->"9a15c4ae-d038-4810-bb83-70a92a913471"]
}, Closed]],

Cell[CellGroupData[{

Cell["idInfo", "Subsection",
 CellChangeTimes->{{3.766754821368951*^9, 3.766754837401464*^9}, {
  3.76744992179731*^9, 3.7674499282822175`*^9}, {3.8236179922313986`*^9, 
  3.823617993235158*^9}},ExpressionUUID->"7e58e129-fd65-47a3-884e-\
66a0e6093894"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idInfo", "::", "usage"}], " ", "=", " ", 
    "\"\<idInfo[device, periodLength]: Returns the field amplitudes and K \
values of the insertion device.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idInfo", "[", 
    RowBox[{"device_", ",", " ", "periodLength_", ",", " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{"\"\<silent\>\"", "\[Rule]", " ", "False"}], "}"}], "]"}]}], 
    "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "bx", ",", " ", "by", ",", " ", "bz", ",", " ", "kh", ",", " ", "kv", 
       ",", " ", "t0", ",", " ", "t1", ",", " ", "silent"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"silent", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<silent\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"bx", " ", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"Abs", "[", 
         RowBox[{"radFldLst", "[", 
          RowBox[{"device", ",", " ", "\"\<bx\>\"", ",", " ", 
           RowBox[{"{", " ", 
            RowBox[{"0", ",", "0", ",", " ", 
             RowBox[{"-", "periodLength"}]}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "periodLength"}], "}"}], ",", " ", 
           "100", ",", " ", "\"\<noarg\>\"", ",", " ", 
           RowBox[{"-", "periodLength"}]}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"by", " ", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"Abs", "[", 
         RowBox[{"radFldLst", "[", 
          RowBox[{"device", ",", " ", "\"\<by\>\"", ",", " ", 
           RowBox[{"{", " ", 
            RowBox[{"0", ",", "0", ",", 
             RowBox[{"-", "periodLength"}]}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "periodLength"}], "}"}], ",", " ", 
           "100", ",", " ", "\"\<noarg\>\"", ",", " ", 
           RowBox[{"-", "periodLength"}]}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"bz", " ", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"Abs", "[", 
         RowBox[{"radFldLst", "[", 
          RowBox[{"device", ",", " ", "\"\<bz\>\"", ",", " ", 
           RowBox[{"{", " ", 
            RowBox[{"0", ",", "0", ",", 
             RowBox[{"-", "periodLength"}]}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "periodLength"}], "}"}], ",", " ", 
           "100", ",", " ", "\"\<noarg\>\"", ",", " ", 
           RowBox[{"-", "periodLength"}]}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"kh", " ", "=", " ", 
       RowBox[{"0.934", "*", "by", "*", 
        RowBox[{"(", 
         RowBox[{"periodLength", "/", "10"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"kv", " ", "=", " ", 
       RowBox[{"0.934", "*", "bx", "*", 
        RowBox[{"(", 
         RowBox[{"periodLength", "/", "10"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", " ", "silent"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<\\nHorizontal field amplitude:    \>\"", ",", " ", "bx", ",", 
           "  ", "\"\< [T]\>\""}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<Vertical field amplitude:      \>\"", ",", " ", "by", ",", 
           " ", "\"\< [T]\>\""}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<Longitudinal field amplitude:  \>\"", ",", " ", "bz", ",", 
           "  ", "\"\< [T]\>\""}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<\\nHorizontal K: \>\"", ",", " ", "kh"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Vertical K:   \>\"", ",", " ", "kv"}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{
        "bx", ",", " ", "by", ",", " ", "bz", ",", " ", "kh", ",", " ", 
         "kv"}], "}"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.7674474456397743`*^9, 3.7674474806295147`*^9}, {
  3.7674475680916853`*^9, 3.7674475684823327`*^9}, {3.767447806856612*^9, 
  3.767447814544712*^9}, {3.76744993168874*^9, 3.76744994276999*^9}, {
  3.7826552143586717`*^9, 3.7826552578428774`*^9}, {3.782655290186495*^9, 
  3.782655300623965*^9}, {3.7844725656385136`*^9, 3.7844725686856365`*^9}, {
  3.7845390869807477`*^9, 3.784539088824651*^9}, {3.8118689810124674`*^9, 
  3.811868999379013*^9}, {3.8236179956936483`*^9, 3.8236179962641134`*^9}, {
  3.82361804642484*^9, 3.8236181663788357`*^9}, {3.823618201918993*^9, 
  3.8236183591393843`*^9}, {3.8236186799918613`*^9, 3.8236186991346345`*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[31]:=",ExpressionUUID->"0c13718e-6079-43d7-8f81-e5adf5dcc272"]
}, Closed]],

Cell[CellGroupData[{

Cell["idPlotFields", "Subsection",
 CellChangeTimes->{
  3.7667548496524267`*^9, {3.823618466433238*^9, 
   3.823618467081491*^9}},ExpressionUUID->"f45e6654-ff43-4e37-a145-\
41f0751c9a87"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idPlotFields", "::", "usage"}], " ", "=", " ", 
    "\"\<idPlotFields[device, positionComponent, positionRange, \\\"px\\\"\
\[Rule] 0, \\\"py\\\"\[Rule] 0, \\\"pz\\\"\[Rule] 0, \
\\\"fieldRange\\\"\[Rule] {All, All}, \\\"silent\\\"\[Rule] False]: Plot the \
insertion device magnetic field versus the coordinate given by \
positionComponent (\\\"x\\\", \\\"y\\\" or \\\"z\\\").\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idPlotFields", "[", 
    RowBox[{
    "device_", ",", " ", "positionComponent_", ",", "positionRange_", ",", 
     " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<px\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<py\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<pz\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<fieldRange\>\"", "\[Rule]", " ", 
         RowBox[{"{", 
          RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", " ", 
        RowBox[{"\"\<silent\>\"", "\[Rule]", " ", "False"}]}], "}"}], "]"}]}],
     "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "plots", ",", " ", "pStr", ",", " ", "px", ",", " ", "py", ",", " ", 
       "pz", ",", " ", "fieldRange", ",", " ", "t0", ",", " ", "t1", ",", " ",
        "silent"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"px", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<px\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"py", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<py\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pz", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<pz\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fieldRange", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<fieldRange\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"silent", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<silent\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"pStr", " ", "=", 
       RowBox[{"ToLowerCase", "[", "positionComponent", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"plots", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Which", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pStr", " ", "\[Equal]", " ", "\"\<x\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"AppendTo", "[", 
          RowBox[{"plots", ",", 
           RowBox[{"Plot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"radFld", "[", 
               RowBox[{"device", ",", "\"\<bx\>\"", ",", 
                RowBox[{"{", 
                 RowBox[{"x", ",", "py", ",", "pz"}], "}"}]}], "]"}], "}"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"x", ",", 
               RowBox[{"positionRange", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"positionRange", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
             RowBox[{"PlotRange", "\[Rule]", " ", 
              RowBox[{"{", 
               RowBox[{"positionRange", ",", " ", "fieldRange"}], "}"}]}], 
             ",", 
             RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"\"\<x [mm]\>\"", ",", "\"\<Bx[T]\>\""}], "}"}]}], ",",
              " ", 
             RowBox[{"PlotStyle", "\[Rule]", "Red"}], ",", "  ", 
             RowBox[{"PlotLegends", "\[Rule]", " ", 
              RowBox[{"{", "\"\<Bx\>\"", "}"}]}]}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"plots", ",", 
           RowBox[{"Plot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"radFld", "[", 
               RowBox[{"device", ",", "\"\<by\>\"", ",", 
                RowBox[{"{", 
                 RowBox[{"x", ",", "py", ",", "pz"}], "}"}]}], "]"}], "}"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"x", ",", 
               RowBox[{"positionRange", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"positionRange", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
             RowBox[{"PlotRange", "\[Rule]", " ", 
              RowBox[{"{", 
               RowBox[{"positionRange", ",", "  ", "fieldRange"}], "}"}]}], 
             ",", 
             RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"\"\<x [mm]\>\"", ",", "\"\<By[T]\>\""}], "}"}]}], ",",
              " ", 
             RowBox[{"PlotStyle", "\[Rule]", "Green"}], ",", "  ", 
             RowBox[{"PlotLegends", "\[Rule]", " ", 
              RowBox[{"{", "\"\<By\>\"", "}"}]}]}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"plots", ",", 
           RowBox[{"Plot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"radFld", "[", 
               RowBox[{"device", ",", "\"\<bz\>\"", ",", 
                RowBox[{"{", 
                 RowBox[{"x", ",", "py", ",", "pz"}], "}"}]}], "]"}], "}"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"x", ",", 
               RowBox[{"positionRange", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"positionRange", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
             RowBox[{"PlotRange", "\[Rule]", " ", 
              RowBox[{"{", 
               RowBox[{"positionRange", ",", " ", "fieldRange"}], "}"}]}], 
             ",", 
             RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"\"\<x [mm]\>\"", ",", "\"\<Bz[T]\>\""}], "}"}]}], ",",
              " ", 
             RowBox[{"PlotStyle", "\[Rule]", "Blue"}], ",", "  ", 
             RowBox[{"PlotLegends", "\[Rule]", " ", 
              RowBox[{"{", "\"\<Bz\>\"", "}"}]}]}], "]"}]}], "]"}]}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"pStr", " ", "\[Equal]", " ", "\"\<y\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"AppendTo", "[", 
          RowBox[{"plots", ",", 
           RowBox[{"Plot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"radFld", "[", 
               RowBox[{"device", ",", "\"\<bx\>\"", ",", 
                RowBox[{"{", 
                 RowBox[{"px", ",", "y", ",", "pz"}], "}"}]}], "]"}], "}"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"y", ",", 
               RowBox[{"positionRange", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"positionRange", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
             RowBox[{"PlotRange", "\[Rule]", " ", 
              RowBox[{"{", 
               RowBox[{"positionRange", ",", " ", "fieldRange"}], "}"}]}], 
             ",", 
             RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"\"\<y [mm]\>\"", ",", "\"\<Bx[T]\>\""}], "}"}]}], ",",
              " ", 
             RowBox[{"PlotStyle", "\[Rule]", "Red"}], ",", "  ", 
             RowBox[{"PlotLegends", "\[Rule]", " ", 
              RowBox[{"{", "\"\<Bx\>\"", "}"}]}]}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"plots", ",", 
           RowBox[{"Plot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"radFld", "[", 
               RowBox[{"device", ",", "\"\<by\>\"", ",", 
                RowBox[{"{", 
                 RowBox[{"px", ",", "y", ",", "pz"}], "}"}]}], "]"}], "}"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"y", ",", 
               RowBox[{"positionRange", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"positionRange", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
             RowBox[{"PlotRange", "\[Rule]", " ", 
              RowBox[{"{", 
               RowBox[{"positionRange", ",", "  ", "fieldRange"}], "}"}]}], 
             ",", 
             RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"\"\<y [mm]\>\"", ",", "\"\<By[T]\>\""}], "}"}]}], ",",
              " ", 
             RowBox[{"PlotStyle", "\[Rule]", "Green"}], ",", "  ", 
             RowBox[{"PlotLegends", "\[Rule]", " ", 
              RowBox[{"{", "\"\<By\>\"", "}"}]}]}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"plots", ",", 
           RowBox[{"Plot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"radFld", "[", 
               RowBox[{"device", ",", "\"\<bz\>\"", ",", 
                RowBox[{"{", 
                 RowBox[{"px", ",", "y", ",", "pz"}], "}"}]}], "]"}], "}"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"y", ",", 
               RowBox[{"positionRange", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"positionRange", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
             RowBox[{"PlotRange", "\[Rule]", " ", 
              RowBox[{"{", 
               RowBox[{"positionRange", ",", "fieldRange"}], "}"}]}], ",", 
             RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"\"\<y [mm]\>\"", ",", "\"\<Bz[T]\>\""}], "}"}]}], ",",
              " ", 
             RowBox[{"PlotStyle", "\[Rule]", "Blue"}], ",", "  ", 
             RowBox[{"PlotLegends", "\[Rule]", " ", 
              RowBox[{"{", "\"\<Bz\>\"", "}"}]}]}], "]"}]}], "]"}]}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"pStr", " ", "\[Equal]", "\"\<z\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"AppendTo", "[", 
          RowBox[{"plots", ",", 
           RowBox[{"Plot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"radFld", "[", 
               RowBox[{"device", ",", "\"\<bx\>\"", ",", 
                RowBox[{"{", 
                 RowBox[{"px", ",", "py", ",", "z"}], "}"}]}], "]"}], "}"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"z", ",", 
               RowBox[{"positionRange", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"positionRange", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
             RowBox[{"PlotRange", "\[Rule]", " ", 
              RowBox[{"{", 
               RowBox[{"positionRange", ",", " ", "fieldRange"}], "}"}]}], 
             ",", 
             RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"\"\<z [mm]\>\"", ",", "\"\<Bx[T]\>\""}], "}"}]}], ",",
              " ", 
             RowBox[{"PlotStyle", "\[Rule]", "Red"}], ",", "  ", 
             RowBox[{"PlotLegends", "\[Rule]", " ", 
              RowBox[{"{", "\"\<Bx\>\"", "}"}]}]}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"plots", ",", 
           RowBox[{"Plot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"radFld", "[", 
               RowBox[{"device", ",", "\"\<by\>\"", ",", 
                RowBox[{"{", 
                 RowBox[{"px", ",", "py", ",", "z"}], "}"}]}], "]"}], "}"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"z", ",", 
               RowBox[{"positionRange", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"positionRange", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
             RowBox[{"PlotRange", "\[Rule]", " ", 
              RowBox[{"{", 
               RowBox[{"positionRange", ",", "  ", "fieldRange"}], "}"}]}], 
             ",", 
             RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"\"\<z [mm]\>\"", ",", "\"\<By[T]\>\""}], "}"}]}], ",",
              " ", 
             RowBox[{"PlotStyle", "\[Rule]", "Green"}], ",", "  ", 
             RowBox[{"PlotLegends", "\[Rule]", " ", 
              RowBox[{"{", "\"\<By\>\"", "}"}]}]}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"plots", ",", 
           RowBox[{"Plot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"radFld", "[", 
               RowBox[{"device", ",", "\"\<bz\>\"", ",", 
                RowBox[{"{", 
                 RowBox[{"px", ",", "py", ",", "z"}], "}"}]}], "]"}], "}"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"z", ",", 
               RowBox[{"positionRange", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"positionRange", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
             RowBox[{"PlotRange", "\[Rule]", " ", 
              RowBox[{"{", 
               RowBox[{"positionRange", ",", "fieldRange"}], "}"}]}], ",", 
             RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"\"\<z [mm]\>\"", ",", "\"\<Bz[T]\>\""}], "}"}]}], ",",
              " ", 
             RowBox[{"PlotStyle", "\[Rule]", "Blue"}], ",", "  ", 
             RowBox[{"PlotLegends", "\[Rule]", " ", 
              RowBox[{"{", "\"\<Bz\>\"", "}"}]}]}], "]"}]}], "]"}]}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", " ", "silent"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<idPlotFields: elapsed time = \>\"", ",", 
           RowBox[{"(", 
            RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "plots", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7674474943805976`*^9, 3.767447507209737*^9}, 
   3.7674475635600443`*^9, {3.767447820092058*^9, 3.767447829967826*^9}, {
   3.7826561255566607`*^9, 3.7826561994021025`*^9}, {3.7826562490425296`*^9, 
   3.7826562914642067`*^9}, {3.8119938559702997`*^9, 3.811993875414157*^9}, {
   3.8119940298393707`*^9, 3.8119940361520557`*^9}, {3.815746982764694*^9, 
   3.815747004835119*^9}, {3.8236184921653633`*^9, 3.8236185867093887`*^9}, {
   3.8236186308472786`*^9, 3.8236186537151794`*^9}, {3.82361870807471*^9, 
   3.823618887514299*^9}, {3.823618922073822*^9, 3.82361932161362*^9}, {
   3.823619353330741*^9, 3.8236193570737257`*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[33]:=",ExpressionUUID->"fd97ef04-7401-413c-9d27-39469d580204"]
}, Closed]],

Cell[CellGroupData[{

Cell["idFieldIntegrals", "Subsection",
 CellChangeTimes->{
  3.7667548688726835`*^9, {3.8236193807633324`*^9, 
   3.823619381323867*^9}},ExpressionUUID->"a4995889-2542-4ef1-925d-\
cedccb9befe2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idFieldIntegrals", "::", "usage"}], " ", "=", " ", 
    "\"\<idFieldIntegrals[device, fieldComponent, positionComponent, \
positionRange, nrPoints, \\\"px\\\"\[Rule] 0, \\\"py\\\"\[Rule] 0, \\\"pz\\\"\
\[Rule] 0,  \\\"silent\\\"\[Rule] False]: Returns the first and second \
magnetic field integrals. The unit is G.cm for the first integral and kG.cm\
\.b2 for the second integral.\>\""}], ";"}], " ", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idFieldIntegrals", "[", 
    RowBox[{
    "device_", ",", " ", "fieldComponent_", ",", " ", "positionComponent_", 
     ",", " ", "positionRange_", ",", " ", "nrPoints_", ",", " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<px\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<py\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<pz\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<silent\>\"", "\[Rule]", " ", "False"}]}], "}"}], "]"}]}],
     "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "px", ",", " ", "py", ",", " ", "pz", ",", " ", "pStr", ",", "position",
        ",", "  ", "posList", ",", " ", "firstIntList", ",", " ", "i", ",", 
       " ", "sfl", ",", " ", "firstInt", ",", " ", "secondInt", ",", " ", 
       "t0", ",", " ", "t1", ",", " ", "silent"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"px", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<px\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"py", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<py\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pz", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<pz\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"silent", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<silent\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"pStr", " ", "=", 
       RowBox[{"ToLowerCase", "[", "positionComponent", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Which", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pStr", " ", "\[Equal]", " ", "\"\<x\>\""}], ",", " ", 
        RowBox[{
         RowBox[{"position", "[", "pos_", "]"}], " ", ":=", " ", 
         RowBox[{"{", 
          RowBox[{"pos", ",", " ", "py", ",", " ", "pz"}], "}"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"pStr", " ", "\[Equal]", " ", "\"\<y\>\""}], ",", 
        RowBox[{
         RowBox[{"position", "[", "pos_", "]"}], " ", ":=", " ", 
         RowBox[{"{", 
          RowBox[{"px", ",", " ", "pos", ",", " ", "pz"}], "}"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"pStr", " ", "\[Equal]", " ", "\"\<z\>\""}], ",", 
        RowBox[{
         RowBox[{"position", "[", "pos_", "]"}], " ", ":=", " ", 
         RowBox[{"{", 
          RowBox[{"px", ",", " ", "py", ",", " ", "pos"}], "}"}]}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"firstInt", " ", "=", " ", 
       RowBox[{"radFldInt", "[", 
        RowBox[{"device", ",", "\"\<fin\>\"", ",", 
         RowBox[{"StringJoin", "[", 
          RowBox[{"\"\<i\>\"", ",", " ", "fieldComponent"}], "]"}], ",", 
         RowBox[{"position", "[", 
          RowBox[{"positionRange", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
         RowBox[{"position", "[", 
          RowBox[{"positionRange", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"posList", " ", "=", " ", 
       RowBox[{"Array", "[", 
        RowBox[{
         RowBox[{"#", "&"}], ",", "nrPoints", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"positionRange", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"positionRange", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sfl", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"firstIntList", " ", "=", " ", 
       RowBox[{"{", "0", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", " ", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", " ", 
        RowBox[{"i", "\[LessEqual]", " ", 
         RowBox[{
          RowBox[{"Length", "[", "posList", "]"}], "-", "1"}]}], ",", " ", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"sfl", " ", "=", " ", 
          RowBox[{"sfl", " ", "+", " ", 
           RowBox[{"radFldInt", "[", 
            RowBox[{"device", ",", "\"\<fin\>\"", ",", 
             RowBox[{"StringJoin", "[", 
              RowBox[{"\"\<i\>\"", ",", " ", "fieldComponent"}], "]"}], ",", 
             " ", 
             RowBox[{"position", "[", 
              RowBox[{"posList", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
             RowBox[{"position", "[", 
              RowBox[{"posList", "[", 
               RowBox[{"[", 
                RowBox[{"i", "+", "1"}], "]"}], "]"}], "]"}]}], "]"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"firstIntList", ",", " ", "sfl"}], "]"}]}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"secondInt", " ", "=", " ", 
       RowBox[{"Integrate", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Interpolation", "[", 
           RowBox[{
            RowBox[{"Transpose", "@", 
             RowBox[{"{", 
              RowBox[{"posList", ",", " ", "firstIntList"}], "}"}]}], ",", 
            " ", 
            RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}], "[", "u",
           "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"u", ",", " ", 
           RowBox[{"positionRange", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{"positionRange", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"firstInt", " ", "=", " ", 
       RowBox[{"firstInt", "*", "1000"}]}], " ", ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"[", 
         RowBox[{"T", ".", "mm"}], "]"}], " ", "\[Rule]", " ", 
        RowBox[{"[", 
         RowBox[{"G", ".", "cm"}], "]"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"secondInt", " ", "=", " ", 
       RowBox[{"secondInt", "/", "10"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"[", 
         RowBox[{"T", ".", "mm\.b2"}], "]"}], " ", "\[Rule]", " ", 
        RowBox[{"[", 
         RowBox[{"kG", ".", "cm\.b2"}], "]"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", " ", "silent"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{
          "fieldComponent", ",", " ", "\"\< First integral: \>\"", ",", " ", 
           "firstInt", ",", "\"\< G.cm\>\""}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{
          "fieldComponent", ",", " ", "\"\< Second integral: \>\"", ",", " ", 
           "secondInt", ",", "\"\< kG.cm\.b2\>\""}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<IDFieldIntegrals: elapsed time = \>\"", ",", 
           RowBox[{"(", 
            RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"firstInt", ",", " ", "secondInt"}], "}"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.767447519038801*^9, 3.7674475570126853`*^9}, {
   3.7674478527196264`*^9, 3.767447856876173*^9}, {3.7674486002357836`*^9, 
   3.7674486471790524`*^9}, {3.782655379174*^9, 3.782655472079883*^9}, {
   3.782655523001548*^9, 3.78265553242339*^9}, {3.8062342296637506`*^9, 
   3.8062342486693964`*^9}, {3.815745479423485*^9, 3.8157455231570635`*^9}, {
   3.8157508495658913`*^9, 3.815750856466805*^9}, {3.8157532035553007`*^9, 
   3.815753204065875*^9}, {3.8157566108675365`*^9, 3.81575661141105*^9}, {
   3.823619384407614*^9, 3.8236196024132113`*^9}, {3.8236196468682165`*^9, 
   3.8236200972838736`*^9}, {3.8236201434154224`*^9, 
   3.8236201443479276`*^9}, {3.8236201753958406`*^9, 3.8236201861520567`*^9}, 
   3.823620252495517*^9, {3.82367639687535*^9, 3.8236764038467073`*^9}, {
   3.823676489971216*^9, 3.8236764922541103`*^9}, {3.8236777764131517`*^9, 
   3.823677778090663*^9}, {3.8236779957721324`*^9, 3.823677996070365*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[35]:=",ExpressionUUID->"d4c1ff8e-927c-454c-aa8b-16a8cfd83e62"]
}, Closed]],

Cell[CellGroupData[{

Cell["idFieldIntegralsList", "Subsection",
 CellChangeTimes->{
  3.7667548688726835`*^9, {3.816633593553114*^9, 3.8166335941013985`*^9}, {
   3.8167015223022566`*^9, 3.8167015224939375`*^9}, {3.816879986192546*^9, 
   3.8168799863306847`*^9}, {3.823620260805281*^9, 3.8236202613976955`*^9}, {
   3.823674563304078*^9, 
   3.8236745650205145`*^9}},ExpressionUUID->"6e03ba2e-0258-4376-8d2b-\
7328a1f290ee"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idFieldIntegralsList", "::", "usage"}], " ", "=", " ", 
    "\"\<idFieldIntegralsList[device, fieldComponent, positionComponent, \
positionRange, nrPoints, \\\"px\\\"\[Rule] 0, \\\"py\\\"\[Rule] 0, \\\"pz\\\"\
\[Rule] 0, \\\"silent\\\"\[Rule] False]: Returns a list with the first and \
second magnetic field integrals. The unit is G.cm for the first integral and \
kG.cm\.b2 for the second integral.\>\""}], ";"}], " ", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idFieldIntegralsList", "[", 
    RowBox[{
    "device_", ",", " ", "fieldComponent_", ",", " ", "positionComponent_", 
     ",", " ", "positionRange_", ",", " ", "nrPoints_", ",", " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<px\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<py\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<pz\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<fieldList\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"\"\<silent\>\"", "\[Rule]", " ", "False"}]}], "}"}], "]"}]}],
     "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "px", ",", " ", "py", ",", " ", "pz", ",", " ", "silent", ",", " ", 
       "pStr", ",", "position", ",", "  ", "posStep", ",", " ", "posList", 
       ",", " ", "fieldListInput", ",", " ", "fieldList", ",", " ", 
       "firstIntList", ",", " ", "secondIntList", ",", "  ", "i", ",", " ", 
       "firstInt", ",", " ", "secondInt", ",", " ", "t0", ",", " ", "t1", ",",
        " ", "ibsum", ",", " ", "iibsum"}], "}"}], ",", "\[IndentingNewLine]",
      "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"px", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<px\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"py", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<py\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pz", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<pz\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fieldListInput", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<fieldList\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"silent", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<silent\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"pStr", " ", "=", 
       RowBox[{"ToLowerCase", "[", "positionComponent", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Which", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pStr", " ", "\[Equal]", " ", "\"\<x\>\""}], ",", " ", 
        RowBox[{
         RowBox[{"position", "[", "pos_", "]"}], " ", ":=", " ", 
         RowBox[{"{", 
          RowBox[{"pos", ",", " ", "py", ",", " ", "pz"}], "}"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"pStr", " ", "\[Equal]", " ", "\"\<y\>\""}], ",", 
        RowBox[{
         RowBox[{"position", "[", "pos_", "]"}], " ", ":=", " ", 
         RowBox[{"{", 
          RowBox[{"px", ",", " ", "pos", ",", " ", "pz"}], "}"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"pStr", " ", "\[Equal]", " ", "\"\<z\>\""}], ",", 
        RowBox[{
         RowBox[{"position", "[", "pos_", "]"}], " ", ":=", " ", 
         RowBox[{"{", 
          RowBox[{"px", ",", " ", "py", ",", " ", "pos"}], "}"}]}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"posStep", " ", "=", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"positionRange", "[", 
           RowBox[{"[", "2", "]"}], "]"}], " ", "-", " ", 
          RowBox[{"positionRange", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "/", "nrPoints"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"posList", " ", "=", " ", 
       RowBox[{"Array", "[", 
        RowBox[{
         RowBox[{"#", "&"}], ",", "nrPoints", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"positionRange", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"positionRange", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "fieldListInput", "]"}], "\[NotEqual]", " ", 
         "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"fieldList", " ", "=", " ", "fieldListInput"}], ";"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"fieldList", " ", "=", " ", 
          RowBox[{"radFldLst", "[", 
           RowBox[{"device", ",", 
            RowBox[{"StringJoin", "[", 
             RowBox[{"\"\<i\>\"", ",", " ", "fieldComponent"}], "]"}], ",", 
            RowBox[{"position", "[", 
             RowBox[{"positionRange", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
            RowBox[{"position", "[", 
             RowBox[{"positionRange", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], ",", " ", "nrPoints", 
            ",", " ", "\"\<noarg\>\"", ",", " ", 
            RowBox[{"positionRange", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"firstIntList", " ", "=", " ", 
       RowBox[{
        RowBox[{"Accumulate", "[", "fieldList", "]"}], "*", "posStep"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"secondIntList", " ", "=", " ", 
       RowBox[{
        RowBox[{"Accumulate", "[", "firstIntList", "]"}], "*", "posStep"}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"firstIntList", " ", "=", " ", 
       RowBox[{"firstIntList", "*", "1000"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"[", 
         RowBox[{"T", ".", "mm"}], "]"}], " ", "\[Rule]", " ", 
        RowBox[{"[", 
         RowBox[{"G", ".", "cm"}], "]"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"secondIntList", " ", "=", " ", 
       RowBox[{"secondIntList", "/", "10"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"[", 
         RowBox[{"T", ".", "mm\.b2"}], "]"}], " ", "\[Rule]", " ", 
        RowBox[{"[", 
         RowBox[{"kG", ".", "cm\.b2"}], "]"}]}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"firstInt", " ", "=", " ", 
       RowBox[{"firstIntList", "[", 
        RowBox[{"[", 
         RowBox[{"-", "1"}], "]"}], "]"}]}], " ", ";", "\[IndentingNewLine]", 
      RowBox[{"secondInt", " ", "=", 
       RowBox[{"secondIntList", "[", 
        RowBox[{"[", 
         RowBox[{"-", "1"}], "]"}], "]"}]}], ";", " ", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", " ", "silent"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{
          "fieldComponent", ",", " ", "\"\< First integral: \>\"", ",", " ", 
           "firstInt", ",", "\"\< G.cm\>\""}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{
          "fieldComponent", ",", " ", "\"\< Second integral: \>\"", ",", " ", 
           "secondInt", ",", "\"\< kG.cm\.b2\>\""}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<idFieldIntegralsList: elapsed time = \>\"", ",", 
           RowBox[{"(", 
            RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{
        "posList", ",", " ", "firstIntList", ",", " ", "secondIntList"}], 
        "}"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGCQAGIQfcf24e+rgm8cX6cvYLgGpPXYp6uC6DmcMmoguqub
vRlEn9n1tANEZ0xM3XRd741jeh/TPhC9jifhCIjO7Ok9CqKLbLeeuxD9xnFT
tuhFEG3Q+/bHl9w3jqvYUv+B6BPSRjO+A2nBD3wzQTTb0cJ9P4D0MukmMH3n
UHTGLyAdpJ4Lpp/YfF6wLP+No+Gp6oUgus/BfymIDvnotB9EL3ry5NRxIG1Q
vuY8iA7p6nknV/DG8XifynsQ7fKnZ+PPmjeOztFCm0B018SfbL+AdIkkCzuI
/lN0TwRE63zTDALRAtfXnxGpfeP47Oe8syBatbmoSxRIuxhuBNNCBzq0xYD0
O+59YDqmRtQVRBcUyoPpW2s4lRSAtATnAjUQPSn2R7cTkL6wz2IWiObUkWFx
BtLLfDTANACNA8bo
  "],
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[37]:=",ExpressionUUID->"f3218b51-b822-48b9-9c9a-ad6433572843"]
}, Closed]],

Cell[CellGroupData[{

Cell["idFieldPhase", "Subsection",
 CellChangeTimes->{
  3.7667548688726835`*^9, {3.814004773706389*^9, 3.8140047880793447`*^9}, {
   3.823620821016119*^9, 
   3.8236208215726285`*^9}},ExpressionUUID->"05684451-b870-4f65-bfb9-\
c0fbd964241e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idFieldPhase", "::", "usage"}], " ", "=", " ", 
    "\"\<idFieldPhase[device, periodLength, positionComponent, positionRange, \
nrPoints, \\\"px\\\"\[Rule] 0, \\\"py\\\"\[Rule] 0, \\\"pz\\\"\[Rule] 0, \
\\\"chopTol\\\"\[Rule] 10^-3, \\\"silent\\\"\[Rule] False]: Returns the phase \
between By and Bx [degrees].\>\""}], ";"}], " ", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idFieldPhase", "[", 
    RowBox[{
    "device_", ",", "periodLength_", ",", " ", "positionComponent_", ",", " ",
      "positionRange_", ",", " ", "nrPoints_", ",", " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<px\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<py\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<pz\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<chopTol\>\"", "\[Rule]", " ", "0.01"}], ",", " ", 
        RowBox[{"\"\<bx\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<by\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<silent\>\"", "\[Rule]", " ", "False"}]}], "}"}], "]"}]}],
     "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "px", ",", " ", "py", ",", " ", "pz", ",", " ", "chopTol", ",", " ", 
       "pStr", ",", " ", "position", ",", " ", "b", ",", "  ", "bxInput", ",",
        " ", "byInput", ",", "   ", "bx", ",", " ", "by", ",", " ", "phase", 
       ",", "  ", "fftx", ",", " ", "ffty", ",", "  ", "maxx", ",", " ", 
       "maxy", ",", " ", "posMax", ",", "  ", "t0", ",", " ", "t1", ",", " ", 
       "silent"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"px", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<px\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"py", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<py\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pz", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<pz\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"bxInput", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<bx\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"byInput", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<by\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"chopTol", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<chopTol\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"silent", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<silent\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"pStr", " ", "=", 
       RowBox[{"ToLowerCase", "[", "positionComponent", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Which", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pStr", " ", "\[Equal]", " ", "\"\<x\>\""}], ",", " ", 
        RowBox[{
         RowBox[{"position", "[", "pos_", "]"}], " ", ":=", " ", 
         RowBox[{"{", 
          RowBox[{"pos", ",", " ", "py", ",", " ", "pz"}], "}"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"pStr", " ", "\[Equal]", " ", "\"\<y\>\""}], ",", 
        RowBox[{
         RowBox[{"position", "[", "pos_", "]"}], " ", ":=", " ", 
         RowBox[{"{", 
          RowBox[{"px", ",", " ", "pos", ",", " ", "pz"}], "}"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"pStr", " ", "\[Equal]", " ", "\"\<z\>\""}], ",", 
        RowBox[{
         RowBox[{"position", "[", "pos_", "]"}], " ", ":=", " ", 
         RowBox[{"{", 
          RowBox[{"px", ",", " ", "py", ",", " ", "pos"}], "}"}]}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"b", " ", "=", " ", 
       RowBox[{"radFldLst", "[", 
        RowBox[{"device", ",", " ", "\"\<bxby\>\"", ",", " ", 
         RowBox[{"position", "[", 
          RowBox[{
           RowBox[{"-", "periodLength"}], "/", "2"}], "]"}], ",", 
         RowBox[{"position", "[", 
          RowBox[{"periodLength", "/", "2"}], "]"}], ",", "100", ",", " ", 
         "\"\<noarg\>\"", ",", "  ", 
         RowBox[{
          RowBox[{"-", "periodLength"}], "/", "2"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"bx", ",", " ", "by"}], "}"}], " ", "=", " ", 
       RowBox[{"Transpose", "[", "b", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"bx", " ", "=", 
       RowBox[{"Chop", "[", 
        RowBox[{"bx", ",", " ", "chopTol"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"by", " ", "=", 
       RowBox[{"Chop", "[", 
        RowBox[{"by", ",", " ", "chopTol"}], "]"}]}], ";", " ", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"AllTrue", "[", 
          RowBox[{"bx", ",", 
           RowBox[{
            RowBox[{"#", "==", "0"}], "&"}]}], "]"}], " ", "||", " ", 
         RowBox[{"AllTrue", "[", 
          RowBox[{"by", ",", 
           RowBox[{
            RowBox[{"#", "==", "0"}], "&"}]}], "]"}]}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"phase", " ", "=", " ", "0"}], ",", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "bxInput", "]"}], " ", "\[NotEqual]", " ", 
            "0"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"bx", " ", "=", " ", "bxInput"}], ";"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"bx", " ", "=", "  ", 
             RowBox[{"radFldLst", "[", 
              RowBox[{"device", ",", " ", "\"\<bx\>\"", ",", " ", 
               RowBox[{"position", "[", 
                RowBox[{"positionRange", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
               RowBox[{"position", "[", 
                RowBox[{"positionRange", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "]"}], ",", " ", "nrPoints", 
               ",", " ", "\"\<noarg\>\"", ",", " ", 
               RowBox[{"positionRange", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "byInput", "]"}], " ", "\[NotEqual]", " ", 
            "0"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"by", " ", "=", " ", "byInput"}], ";"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"by", " ", "=", "  ", 
             RowBox[{"radFldLst", "[", 
              RowBox[{"device", ",", " ", "\"\<by\>\"", ",", " ", 
               RowBox[{"position", "[", 
                RowBox[{"positionRange", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
               RowBox[{"position", "[", 
                RowBox[{"positionRange", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "]"}], ",", " ", "nrPoints", 
               ",", " ", "\"\<noarg\>\"", ",", " ", 
               RowBox[{"positionRange", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"fftx", "=", 
          RowBox[{"Fourier", "[", 
           RowBox[{"bx", ",", 
            RowBox[{"FourierParameters", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "1"}], ",", "1"}], "}"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"ffty", "=", 
          RowBox[{"Fourier", "[", 
           RowBox[{"by", ",", 
            RowBox[{"FourierParameters", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "1"}], ",", "1"}], "}"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"maxx", "=", 
          RowBox[{"Max", "[", 
           RowBox[{"Abs", "[", "fftx", "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"maxy", "=", 
          RowBox[{"Max", "[", 
           RowBox[{"Abs", "[", "ffty", "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"maxx", " ", ">", " ", "maxy"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"posMax", "=", 
             RowBox[{"First", "[", 
              RowBox[{"First", "[", 
               RowBox[{"Position", "[", 
                RowBox[{
                 RowBox[{"Abs", "[", "fftx", "]"}], ",", "maxx"}], "]"}], 
               "]"}], "]"}]}], ";"}], ",", " ", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"posMax", "=", 
             RowBox[{"First", "[", 
              RowBox[{"First", "[", 
               RowBox[{"Position", "[", 
                RowBox[{
                 RowBox[{"Abs", "[", "ffty", "]"}], ",", "maxy"}], "]"}], 
               "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"phase", " ", "=", " ", 
          RowBox[{
           RowBox[{"Arg", "[", 
            RowBox[{"ffty", "[", 
             RowBox[{"[", "posMax", "]"}], "]"}], "]"}], "-", 
           RowBox[{"Arg", "[", 
            RowBox[{"fftx", "[", 
             RowBox[{"[", "posMax", "]"}], "]"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"phase", " ", "=", " ", 
          RowBox[{"phase", "*", 
           RowBox[{"180", "/", "\[Pi]"}]}]}], ";"}]}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", " ", "silent"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Phase between By and Bx [\[Degree]]: \>\"", ",", " ", 
           RowBox[{"Round", "[", 
            RowBox[{"phase", ",", " ", "0.1"}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<idFieldPhase: elapsed time = \>\"", ",", 
           RowBox[{"(", 
            RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "phase", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.767447519038801*^9, 3.7674475570126853`*^9}, {
   3.7674478527196264`*^9, 3.767447856876173*^9}, {3.7674486002357836`*^9, 
   3.7674486471790524`*^9}, {3.782655379174*^9, 3.782655472079883*^9}, {
   3.782655523001548*^9, 3.78265553242339*^9}, {3.8062342296637506`*^9, 
   3.8062342486693964`*^9}, {3.8140047791487875`*^9, 
   3.8140048030103016`*^9}, {3.814004846343008*^9, 3.8140050344263144`*^9}, {
   3.8140051047107515`*^9, 3.814005147863482*^9}, {3.81400575161285*^9, 
   3.814005757983315*^9}, {3.823620822810316*^9, 3.823621236224991*^9}, 
   3.823683731047742*^9, {3.823683821869725*^9, 3.823683837685401*^9}, {
   3.8236838994022436`*^9, 3.8236839636722517`*^9}, {3.8236840162101746`*^9, 
   3.823684025545192*^9}, {3.823684080866149*^9, 3.823684092292571*^9}, {
   3.8236841250069947`*^9, 3.823684251108568*^9}, {3.8236843177961097`*^9, 
   3.8236844258958263`*^9}, {3.8236844963851924`*^9, 3.823684496524815*^9}, {
   3.823684743520811*^9, 3.8236847978634157`*^9}, {3.823685128096795*^9, 
   3.8236852601382136`*^9}, {3.823685302202633*^9, 3.823685311621424*^9}, {
   3.823685387432564*^9, 3.8236854372173367`*^9}, {3.823709774877278*^9, 
   3.8237097764271297`*^9}, {3.823768821859717*^9, 3.8237689761099386`*^9}, {
   3.823769038465071*^9, 3.82376911904244*^9}, {3.8237818766686993`*^9, 
   3.823781933476678*^9}, 3.823781981389471*^9, {3.823782876266079*^9, 
   3.823782886654278*^9}, {3.823783239322508*^9, 3.8237832436798167`*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[39]:=",ExpressionUUID->"76af9fe4-5054-4a8c-93d4-2cff23f70cee"]
}, Closed]],

Cell[CellGroupData[{

Cell["idTrajectory", "Subsection",
 CellChangeTimes->{{3.7667548871084976`*^9, 3.76675490671941*^9}, 
   3.7667549708182*^9, {3.8236216396783247`*^9, 3.8236216401909523`*^9}, 
   3.8236218549183283`*^9},ExpressionUUID->"e8adc80d-796a-484b-8006-\
7984daf3715e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idTrajectory", "::", "usage"}], " ", "=", " ", 
    "\"\<idTrajectory[device, energy, r0, smax, rkstep]: Calculates the \
particle trajectory using the Runge-Kutta algorithm. The particle energy must \
be in GeV, r0 is the initial position and normalized momentum vector {x0, y0, \
z0, dx0ds, dy0ds, dz0ds}, smax and rkstep are the final longitudinal position \
and the Runge-Kutta step. All positions are in millimeters.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idTrajectory", "[", 
    RowBox[{
    "device_", ",", " ", "energy_", ",", "r0_", ",", "smax_", ",", "rkstep_", 
     ",", " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<silent\>\"", "\[Rule]", " ", "False"}], ",", " ", 
        RowBox[{"\"\<dz\>\"", "\[Rule]", " ", "0"}]}], " ", "}"}], "]"}]}], 
    "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "trajectory", ",", " ", "electronRestEnergy", ",", " ", "lightSpeed", 
       ",", " ", "beta", ",", " ", "brho", ",", " ", "a", ",", " ", "b", ",", 
       " ", "b1", ",", " ", "b2", ",", " ", "b3", ",", " ", "r", ",", " ", 
       "r1", ",", " ", "r2", ",", " ", "r3", ",", " ", "drds1", ",", " ", 
       "drds2", ",", " ", "drds3", ",", " ", "drds4", ",", " ", "i", ",", " ",
        "sm", ",", " ", "step", ",", " ", "t0", ",", " ", "t1", ",", " ", 
       "silent", ",", " ", "dz"}], "}"}], ",", "\n", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"silent", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<silent\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dz", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<dz\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"electronRestEnergy", "=", "510998.92811"}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"[", "eV", "]"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"lightSpeed", "=", "299792458"}], ";", 
      RowBox[{"(*", 
       RowBox[{"[", 
        RowBox[{"m", "/", "s"}], "]"}], "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"r1", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"r2", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"r3", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
        "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"from", " ", "GeV", " ", "to", " ", "eV"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"beta", "=", 
       RowBox[{"Sqrt", "[", 
        RowBox[{"1.0", "-", 
         RowBox[{"(", 
          RowBox[{"1.0", "/", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"energy", "*", 
               RowBox[{"1000000000", "/", "electronRestEnergy"}]}], ")"}], 
             "^", "2"}], ")"}]}], ")"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"brho", "=", 
       RowBox[{"(", 
        RowBox[{"energy", "*", 
         RowBox[{"1000000000", "/", "lightSpeed"}]}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"a", "=", 
       RowBox[{
        RowBox[{"1.0", "/", "brho"}], "/", "beta"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"r", "=", " ", "r0"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"from", " ", "mm", " ", "to", " ", "m"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"r", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "=", " ", 
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "/", "1000"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"r", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "=", " ", 
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "/", "1000"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"r", "[", 
        RowBox[{"[", "3", "]"}], "]"}], "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"r", "[", 
          RowBox[{"[", "3", "]"}], "]"}], "/", "1000"}], " ", "+", " ", 
        RowBox[{"dz", "/", "1000"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"sm", " ", "=", " ", 
       RowBox[{"smax", "/", "1000"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"step", " ", "=", " ", 
       RowBox[{"rkstep", "/", "1000"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"trajectory", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"trajectory", ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "*", "1000"}], ",", " ", 
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "*", "1000"}], ",", " ", 
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "*", "1000"}], ",", " ", 
          RowBox[{"r", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
          RowBox[{"r", "[", 
           RowBox[{"[", "5", "]"}], "]"}], ",", " ", 
          RowBox[{"r", "[", 
           RowBox[{"[", "6", "]"}], "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"While", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"r", "[", 
          RowBox[{"[", "3", "]"}], "]"}], "<", "sm"}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"b", "=", 
          RowBox[{"radFld", "[", 
           RowBox[{"device", ",", " ", "\"\<BxByBz\>\"", ",", " ", 
            RowBox[{"1000", "*", 
             RowBox[{"r", "[", 
              RowBox[{"[", 
               RowBox[{";;", "3"}], "]"}], "]"}]}]}], "]"}]}], ";", "\n", 
         "\t", 
         RowBox[{"drds1", "=", 
          RowBox[{"idNewtonLorentzEquation", "[", 
           RowBox[{"a", ",", "r", ",", "b"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"r1", "=", 
          RowBox[{"r", "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"step", "/", "2.0"}], ")"}], "*", "drds1"}]}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"b1", "=", 
          RowBox[{"radFld", "[", 
           RowBox[{"device", ",", " ", "\"\<BxByBz\>\"", ",", " ", 
            RowBox[{"1000", "*", 
             RowBox[{"r1", "[", 
              RowBox[{"[", 
               RowBox[{";;", "3"}], "]"}], "]"}]}]}], "]"}]}], ";", "\n", 
         "\t", 
         RowBox[{"drds2", "=", 
          RowBox[{"idNewtonLorentzEquation", "[", 
           RowBox[{"a", ",", "r1", ",", "b1"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"r2", "=", 
          RowBox[{"r", "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"step", "/", "2.0"}], ")"}], "*", "drds2"}]}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"b2", "=", 
          RowBox[{"radFld", "[", 
           RowBox[{"device", ",", " ", "\"\<BxByBz\>\"", ",", " ", 
            RowBox[{"1000", "*", 
             RowBox[{"r2", "[", 
              RowBox[{"[", 
               RowBox[{";;", "3"}], "]"}], "]"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"drds3", "=", 
          RowBox[{"idNewtonLorentzEquation", "[", 
           RowBox[{"a", ",", "r2", ",", "b2"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"r3", "=", 
          RowBox[{"r", "+", 
           RowBox[{"step", "*", "drds3"}]}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"b3", "=", 
          RowBox[{"radFld", "[", 
           RowBox[{"device", ",", " ", "\"\<BxByBz\>\"", ",", " ", 
            RowBox[{"1000", "*", 
             RowBox[{"r3", "[", 
              RowBox[{"[", 
               RowBox[{";;", "3"}], "]"}], "]"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"drds4", "=", 
          RowBox[{"idNewtonLorentzEquation", "[", 
           RowBox[{"a", ",", "r3", ",", "b3"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"r", "=", 
          RowBox[{"r", "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"step", "/", "6.0"}], ")"}], "*", 
            RowBox[{"(", 
             RowBox[{"drds1", "+", 
              RowBox[{"2.0", "*", "drds2"}], "+", 
              RowBox[{"2.0", "*", "drds3"}], "+", "drds4"}], ")"}]}]}]}], ";",
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"trajectory", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"r", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "*", "1000"}], ",", " ", 
             RowBox[{
              RowBox[{"r", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "*", "1000"}], ",", " ", 
             RowBox[{
              RowBox[{"r", "[", 
               RowBox[{"[", "3", "]"}], "]"}], "*", "1000"}], ",", " ", 
             RowBox[{"r", "[", 
              RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
             RowBox[{"r", "[", 
              RowBox[{"[", "5", "]"}], "]"}], ",", " ", 
             RowBox[{"r", "[", 
              RowBox[{"[", "6", "]"}], "]"}]}], "}"}]}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", " ", "silent"}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<idRungeKuttaTrajectory: elapsed time = \>\"", ",", 
           RowBox[{"(", 
            RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "trajectory", "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.76744770185725*^9, 3.767447715061404*^9}, {
   3.7674478894725156`*^9, 3.7674478930665445`*^9}, {3.782655720566373*^9, 
   3.782655720941368*^9}, 3.821198370332193*^9, {3.8211989209357195`*^9, 
   3.821198946853913*^9}, {3.8211990277470274`*^9, 3.8211991616885953`*^9}, {
   3.8218660850976667`*^9, 3.8218660880108*^9}, {3.8236216414625845`*^9, 
   3.8236218102767887`*^9}, {3.8236218485244355`*^9, 3.823621858927596*^9}, {
   3.8236223172919817`*^9, 3.8236223301954517`*^9}, {3.824661242454751*^9, 
   3.8246612528290195`*^9}, {3.824661324252883*^9, 3.824661337468526*^9}, {
   3.8246613711443753`*^9, 3.824661372436942*^9}, {3.8246614124727793`*^9, 
   3.824661413764323*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[41]:=",ExpressionUUID->"7c2fc852-574b-4502-90b4-115c723af23a"]
}, Closed]],

Cell[CellGroupData[{

Cell["idNewtonLorentzEquation", "Subsection",
 CellChangeTimes->{
  3.7667546801064196`*^9, 3.7667549456130934`*^9, 3.766755008805561*^9, {
   3.823622293237357*^9, 
   3.8236222934049067`*^9}},ExpressionUUID->"6f80b6cd-6c2c-49b4-a441-\
81df72cf3aea"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idNewtonLorentzEquation", "::", "usage"}], " ", "=", " ", 
    "\"\<idNewtonLorentzEquation[a, r, b]: Particle equations of \
motion.\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idNewtonLorentzEquation", "[", 
    RowBox[{"a_", ",", "r_", ",", "b_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", "drds", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"drds", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"drds", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "=", 
       RowBox[{"r", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"drds", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "=", 
       RowBox[{"r", "[", 
        RowBox[{"[", "5", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"drds", "[", 
        RowBox[{"[", "3", "]"}], "]"}], "=", 
       RowBox[{"r", "[", 
        RowBox[{"[", "6", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"drds", "[", 
        RowBox[{"[", "4", "]"}], "]"}], "=", 
       RowBox[{
        RowBox[{"-", "a"}], "*", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "5", "]"}], "]"}], "*", 
           RowBox[{"b", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], "-", 
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "6", "]"}], "]"}], "*", 
           RowBox[{"b", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"drds", "[", 
        RowBox[{"[", "5", "]"}], "]"}], "=", 
       RowBox[{
        RowBox[{"-", "a"}], "*", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "6", "]"}], "]"}], "*", 
           RowBox[{"b", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "-", 
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "4", "]"}], "]"}], "*", 
           RowBox[{"b", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"drds", "[", 
        RowBox[{"[", "6", "]"}], "]"}], "=", 
       RowBox[{
        RowBox[{"-", "a"}], "*", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "4", "]"}], "]"}], "*", 
           RowBox[{"b", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "-", 
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "5", "]"}], "]"}], "*", 
           RowBox[{"b", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "drds", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.821200065599141*^9, 3.821200065728931*^9}, {
  3.823622296206407*^9, 3.823622299814752*^9}, {3.8236223485054555`*^9, 
  3.8236224651623087`*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[43]:=",ExpressionUUID->"c50c7707-81f5-4284-b42b-281ac863c5f6"]
}, Closed]],

Cell[CellGroupData[{

Cell["idPlotTrajectory", "Subsection",
 CellChangeTimes->{{3.7667548871084976`*^9, 3.76675490671941*^9}, 
   3.7667549708182*^9, {3.766755041776903*^9, 3.7667550428863707`*^9}, {
   3.823621841582015*^9, 
   3.8236218688021746`*^9}},ExpressionUUID->"4ab749ee-2e72-4893-87e7-\
38a8d2c70c37"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idPlotTrajectory", "::", "usage"}], " ", "=", " ", 
    "\"\<idPlotTrajectory[trajectory, positionComponent_]: Plot the electron \
trajectory.\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idPlotTrajectory", "[", 
    RowBox[{"trajectory_", ",", " ", "positionComponent_"}], "]"}], " ", ":=",
    " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "pStr", ",", " ", "plots", ",", " ", "x", ",", " ", "y", ",", " ", "z", 
       ",", " ", "t0", ",", " ", "t1"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pStr", " ", "=", 
       RowBox[{"ToLowerCase", "[", "positionComponent", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"plots", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x", "=", " ", 
       RowBox[{"trajectory", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", " ", "1"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"y", " ", "=", " ", 
       RowBox[{"trajectory", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", " ", "2"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"z", " ", "=", " ", 
       RowBox[{"trajectory", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", " ", "3"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Which", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pStr", " ", "\[Equal]", " ", "\"\<x\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"AppendTo", "[", 
          RowBox[{"plots", ",", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"Transpose", "@", 
              RowBox[{"{", 
               RowBox[{"x", ",", " ", 
                RowBox[{"y", "*", "1000"}]}], "}"}]}], ",", " ", 
             RowBox[{"PlotRange", "\[Rule]", " ", 
              RowBox[{"{", 
               RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", 
             RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", " ", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", 
             RowBox[{"FrameLabel", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"\"\<x [mm]\>\"", ",", "\"\<y [\[Mu]m]\>\""}], 
               "}"}]}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"plots", ",", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"Transpose", "@", 
              RowBox[{"{", 
               RowBox[{"x", ",", " ", 
                RowBox[{"z", "*", "1000"}]}], "}"}]}], ",", " ", 
             RowBox[{"PlotRange", "\[Rule]", " ", 
              RowBox[{"{", 
               RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", 
             RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", " ", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", 
             RowBox[{"FrameLabel", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"\"\<x [mm]\>\"", ",", "\"\<z [\[Mu]m]\>\""}], 
               "}"}]}]}], "]"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"pStr", " ", "\[Equal]", " ", "\"\<y\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"AppendTo", "[", 
          RowBox[{"plots", ",", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"Transpose", "@", 
              RowBox[{"{", 
               RowBox[{"y", ",", " ", 
                RowBox[{"x", "*", "1000"}]}], "}"}]}], ",", " ", 
             RowBox[{"PlotRange", "\[Rule]", " ", 
              RowBox[{"{", 
               RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", 
             RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", " ", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", 
             RowBox[{"FrameLabel", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"\"\<y [mm]\>\"", ",", "\"\<x [\[Mu]m]\>\""}], 
               "}"}]}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"plots", ",", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"Transpose", "@", 
              RowBox[{"{", 
               RowBox[{"y", ",", " ", 
                RowBox[{"z", "*", "1000"}]}], "}"}]}], ",", " ", 
             RowBox[{"PlotRange", "\[Rule]", " ", 
              RowBox[{"{", 
               RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", 
             RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", " ", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", 
             RowBox[{"FrameLabel", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"\"\<y [mm]\>\"", ",", "\"\<z [\[Mu]m]\>\""}], 
               "}"}]}]}], "]"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"pStr", " ", "\[Equal]", " ", "\"\<z\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"AppendTo", "[", 
          RowBox[{"plots", ",", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"Transpose", "@", 
              RowBox[{"{", 
               RowBox[{"z", ",", " ", 
                RowBox[{"x", "*", "1000"}]}], "}"}]}], ",", " ", 
             RowBox[{"PlotRange", "\[Rule]", " ", 
              RowBox[{"{", 
               RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", 
             RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", " ", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", 
             RowBox[{"FrameLabel", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"\"\<z [mm]\>\"", ",", "\"\<x [\[Mu]m]\>\""}], 
               "}"}]}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"plots", ",", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"Transpose", "@", 
              RowBox[{"{", 
               RowBox[{"z", ",", " ", 
                RowBox[{"y", "*", "1000"}]}], "}"}]}], ",", " ", 
             RowBox[{"PlotRange", "\[Rule]", " ", 
              RowBox[{"{", 
               RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", 
             RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", " ", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", 
             RowBox[{"FrameLabel", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"\"\<z [mm]\>\"", ",", "\"\<y [\[Mu]m]\>\""}], 
               "}"}]}]}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "plots", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.767447724265257*^9, 3.7674477376412992`*^9}, {
  3.767447904067401*^9, 3.7674479092240562`*^9}, {3.782655746847508*^9, 
  3.782655747097514*^9}, {3.82362187038693*^9, 3.823621885877512*^9}, {
  3.8236219179366837`*^9, 3.823622082553193*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[45]:=",ExpressionUUID->"1ee58a02-50b6-44bc-8d61-c71a1b25a3c3"]
}, Closed]],

Cell[CellGroupData[{

Cell["idFilename", "Subsection",
 CellChangeTimes->{{3.7667548871084976`*^9, 3.76675490671941*^9}, 
   3.767449882481743*^9, 3.7826556381260996`*^9, {3.820132820008762*^9, 
   3.820132822768936*^9}, {3.823702066561797*^9, 3.8237021087299905`*^9}, {
   3.823702260428996*^9, 3.823702263856839*^9}, {3.8237070745910463`*^9, 
   3.823707079194727*^9}, {3.8237076324706697`*^9, 
   3.8237076352890887`*^9}},ExpressionUUID->"7617277d-6c2c-4b31-9634-\
b68c542eb68c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idFilename", "::", "usage"}], " ", "=", " ", 
    "\"\<idFilename[deviceName, polarizationName, xrange, yrange, zrange, hk, \
kv, \\\"fileExtension\\\"\[Rule] \\\".fld\\\", \
\\\"displacementName\\\"\[Rule]\\\"\\\"]: Return the fieldmap default \
filename.\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idFilename", "[", 
    RowBox[{
    "date_", ",", " ", "deviceName_", ",", " ", "polarizationName_", ",", 
     "  ", "xrange_", ",", " ", "yrange_", ",", " ", "zrange_", ",", " ", " ",
      "kh_", ",", " ", "kv_", ",", "  ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<fileExtension\>\"", "\[Rule]", " ", "\"\<.fld\>\""}], 
        ",", " ", 
        RowBox[{"\"\<displacementName\>\"", "\[Rule]", "\"\<\>\""}]}], "}"}], 
      "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "filename", ",", " ", "fileExtension", ",", "  ", "displacementName", 
       ",", "  ", "khRound", ",", " ", "kvRound"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"fileExtension", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<fileExtension\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"displacementName", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<displacementName\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"khRound", " ", "=", " ", 
       RowBox[{"Round", "[", 
        RowBox[{"kh", ",", " ", "0.01"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kvRound", "=", " ", 
       RowBox[{"Round", "[", 
        RowBox[{"kv", ",", " ", "0.01"}], "]"}]}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"filename", " ", "=", 
       RowBox[{
        RowBox[{
        "StringTemplate", "[", "\"\<`1`_`2`_`3`_Kh=`4`_Kv=`5`\>\"", "]"}], 
        "[", 
        RowBox[{
        "date", ",", " ", "deviceName", ",", " ", "polarizationName", ",", 
         "  ", "khRound", ",", " ", "kvRound"}], "]"}]}], " ", ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"StringLength", "[", "displacementName", "]"}], " ", 
         "\[NotEqual]", " ", "0"}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"filename", "=", " ", 
          RowBox[{
          "filename", "<>", " ", "\"\<_\>\"", " ", "<>", " ", 
           "displacementName"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";",
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"xrange", "[", 
          RowBox[{"[", "1", "]"}], "]"}], " ", "\[NotEqual]", " ", 
         RowBox[{"xrange", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"filename", " ", "=", " ", 
          RowBox[{
           RowBox[{"StringTemplate", "[", "\"\<`1`_X=`2`_`3`mm\>\"", "]"}], 
           "[", 
           RowBox[{"filename", ",", " ", 
            RowBox[{"xrange", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
            RowBox[{"xrange", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], " ", ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"yrange", "[", 
          RowBox[{"[", "1", "]"}], "]"}], " ", "\[NotEqual]", " ", 
         RowBox[{"yrange", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"filename", " ", "=", " ", 
          RowBox[{
           RowBox[{"StringTemplate", "[", "\"\<`1`_Y=`2`_`3`mm\>\"", "]"}], 
           "[", 
           RowBox[{"filename", ",", " ", 
            RowBox[{"yrange", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
            RowBox[{"yrange", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], " ", ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"zrange", "[", 
          RowBox[{"[", "1", "]"}], "]"}], " ", "\[NotEqual]", " ", 
         RowBox[{"zrange", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"filename", " ", "=", " ", 
          RowBox[{
           RowBox[{"StringTemplate", "[", "\"\<`1`_Z=`2`_`3`mm\>\"", "]"}], 
           "[", 
           RowBox[{"filename", ",", " ", 
            RowBox[{"zrange", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
            RowBox[{"zrange", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], " ", ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"filename", "=", " ", 
       RowBox[{"filename", " ", "<>", "  ", "fileExtension"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "filename", "]"}], ";"}]}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.767447676712742*^9, 3.7674476901356754`*^9}, {
   3.767447877752833*^9, 3.7674478819250393`*^9}, {3.7674498877634153`*^9, 
   3.7674499000768747`*^9}, {3.782655619766797*^9, 3.7826556288292556`*^9}, {
   3.7826568647102003`*^9, 3.782656886835105*^9}, 3.784621350331092*^9, {
   3.8201328287093325`*^9, 3.8201328301894054`*^9}, {3.8201475833268857`*^9, 
   3.82014772475784*^9}, {3.820147903479143*^9, 3.8201479195002623`*^9}, {
   3.8201479575827456`*^9, 3.8201480152565284`*^9}, {3.820148073780411*^9, 
   3.820148094041765*^9}, {3.8201481578859253`*^9, 3.8201484002139997`*^9}, {
   3.820148442706847*^9, 3.8201489300314655`*^9}, {3.8201489649837694`*^9, 
   3.820148998295968*^9}, {3.8201490518994956`*^9, 3.82014945269989*^9}, {
   3.820149575878006*^9, 3.8201496158606415`*^9}, {3.8201496684041023`*^9, 
   3.8201497274780054`*^9}, {3.8201497623102913`*^9, 
   3.8201497783813515`*^9}, {3.8201499985877542`*^9, 3.820150017769049*^9}, {
   3.820150256796426*^9, 3.820150324490906*^9}, {3.82015038955519*^9, 
   3.820150396285636*^9}, {3.820150623392577*^9, 3.8201506453240223`*^9}, {
   3.8201507623230314`*^9, 3.8201507878947144`*^9}, 3.820151721795121*^9, {
   3.820152623918645*^9, 3.82015263157914*^9}, 3.8201528026126175`*^9, {
   3.8201537926163034`*^9, 3.8201537940663977`*^9}, {3.8201569443179674`*^9, 
   3.8201569486982536`*^9}, {3.8202203671869135`*^9, 3.820220375416733*^9}, {
   3.8203186866073475`*^9, 3.820318926733198*^9}, {3.8205729537402887`*^9, 
   3.8205729550203905`*^9}, 3.8237020897686944`*^9, {3.8237021221251307`*^9, 
   3.8237028642676344`*^9}, {3.823702918355866*^9, 3.8237029480723715`*^9}, {
   3.8237070921380897`*^9, 3.823707619906253*^9}, {3.823707665002596*^9, 
   3.8237077585402575`*^9}, {3.8237078214269695`*^9, 3.823707866720759*^9}, {
   3.8237079043560705`*^9, 3.82370798376158*^9}, {3.823708399136977*^9, 
   3.8237084165962553`*^9}, {3.823708482260558*^9, 3.8237085247807455`*^9}, {
   3.823761046976612*^9, 3.8237611434344735`*^9}, {3.823772164573716*^9, 
   3.8237722558614254`*^9}, {3.824648906420723*^9, 3.8246489342751846`*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[47]:=",ExpressionUUID->"5f7fcb1c-a615-4289-9835-be5f2533c5f1"]
}, Closed]],

Cell[CellGroupData[{

Cell["idHeader", "Subsection",
 CellChangeTimes->{{3.7667548871084976`*^9, 3.76675490671941*^9}, 
   3.767449882481743*^9, 3.7826556381260996`*^9, {3.820132820008762*^9, 
   3.820132822768936*^9}, {3.823702066561797*^9, 3.8237021087299905`*^9}, {
   3.823702260428996*^9, 3.823702263856839*^9}, {3.8237070848187017`*^9, 
   3.823707085486913*^9}, 
   3.82370903461427*^9},ExpressionUUID->"00b3c40c-77e4-41cd-9bb5-\
97b3372f737a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idHeader", "::", "usage"}], " ", "=", " ", 
    "\"\<idHeader[date, deviceName, polarizationName,  xrange, yrange, \
zrange,  kh, kv, gap, periodLength, magnetLength, fieldPhase, \
\\\"displacementName\\\"\[Rule]\\\"\\\", \\\"dP\\\"\[Rule] 0, \\\"dCP\\\"\
\[Rule] 0, \\\"dGV\\\"\[Rule] 0, \\\"dGH\\\"\[Rule] 0}]]: Writes the fieldmap \
to file.\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idHeader", "[", 
    RowBox[{
    "date_", ",", " ", "deviceName_", ",", " ", "polarizationName_", ",", 
     "  ", "xrange_", ",", " ", "yrange_", ",", " ", "zrange_", ",", " ", " ",
      "kh_", ",", " ", "kv_", ",", " ", "gap_", ",", " ", "periodLength_", 
     ",", " ", "magnetLength_", ",", " ", "fieldPhase_", ",", " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<displacementName\>\"", "\[Rule]", "\"\<\>\""}], ",", " ", 
        RowBox[{"\"\<dP\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<dCP\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<dGV\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<dGH\>\"", "\[Rule]", " ", "0"}]}], "}"}], "]"}]}], "]"}],
    " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "header", ",", "  ", "timestamp", ",", " ", "line", ",", "  ", "dP", 
       ",", "dCP", ",", " ", "dGV", ",", " ", "dGH", ",", " ", "k", ",", " ", 
       "khRound", ",", " ", "kvRound", ",", " ", "kRound", ",", " ", 
       "fieldPhaseRound", ",", " ", "posCSD", ",", " ", "posCSE", ",", " ", 
       "posCID", ",", " ", "posCIE"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dP", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<dP\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dCP", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<dCP\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dGV", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<dGV\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dGH", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<dGH\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"header", " ", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"timestamp", " ", "=", " ", 
       RowBox[{"date", " ", "<>", "\"\<_\>\"", "<>", " ", 
        RowBox[{"DateString", "[", 
         RowBox[{"{", 
          RowBox[{
          "\"\<Hour24\>\"", ",", "\"\<-\>\"", ",", "\"\<Minute\>\"", ",", 
           "\"\<-\>\"", ",", " ", "\"\<Second\>\""}], "}"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"posCSD", " ", "=", "dGV"}], ";", "\[IndentingNewLine]", 
      RowBox[{"posCSE", " ", "=", " ", 
       RowBox[{"dGV", "+", " ", "dGH", "+", " ", "dP", "+", "dCP"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"posCIE", " ", "=", "dGH"}], ";", "\[IndentingNewLine]", 
      RowBox[{"posCID", " ", "=", 
       RowBox[{"dP", "-", "dCP"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"k", " ", "=", " ", 
       RowBox[{"Sqrt", "[", 
        RowBox[{
         RowBox[{"kh", "^", "2"}], " ", "+", " ", 
         RowBox[{"kv", "^", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"khRound", " ", "=", " ", 
       RowBox[{"Round", "[", 
        RowBox[{"kh", ",", " ", "0.01"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kvRound", "=", " ", 
       RowBox[{"Round", "[", 
        RowBox[{"kv", ",", " ", "0.01"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kRound", "=", " ", 
       RowBox[{"Round", "[", 
        RowBox[{"k", ",", " ", "0.01"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"fieldPhaseRound", " ", "=", " ", 
       RowBox[{"Round", "[", 
        RowBox[{"fieldPhase", ",", " ", "1"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", 
       RowBox[{
        RowBox[{"StringTemplate", "[", "\"\<timestamp:\\t`1`\\n\>\"", "]"}], 
        "[", "timestamp", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"header", ",", " ", "line"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", 
       RowBox[{
        RowBox[{"StringTemplate", "[", "\"\<magnet_name:\\t`1`\\n\>\"", "]"}],
         "[", "deviceName", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"header", ",", " ", "line"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", 
       RowBox[{
        RowBox[{"StringTemplate", "[", "\"\<gap[mm]:\\t`1`\\n\>\"", "]"}], 
        "[", "gap", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"header", ",", " ", "line"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", 
       RowBox[{
        RowBox[{
        "StringTemplate", "[", "\"\<period_length[mm]:\\t`1`\\n\>\"", "]"}], 
        "[", "periodLength", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"header", ",", " ", "line"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", 
       RowBox[{
        RowBox[{
        "StringTemplate", "[", "\"\<magnet_length[mm]:\\t`1`\\n\>\"", "]"}], 
        "[", "magnetLength", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"header", ",", " ", "line"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", 
       RowBox[{
        RowBox[{"StringTemplate", "[", "\"\<dP[mm]:\\t\\t`1`\\n\>\"", "]"}], 
        "[", "dP", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"header", ",", " ", "line"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", 
       RowBox[{
        RowBox[{"StringTemplate", "[", "\"\<dCP[mm]:\\t`1`\\n\>\"", "]"}], 
        "[", "dCP", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"header", ",", " ", "line"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", 
       RowBox[{
        RowBox[{"StringTemplate", "[", "\"\<dGV[mm]:\\t`1`\\n\>\"", "]"}], 
        "[", "dGV", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"header", ",", " ", "line"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", 
       RowBox[{
        RowBox[{"StringTemplate", "[", "\"\<dGH[mm]:\\t`1`\\n\>\"", "]"}], 
        "[", "dGH", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"header", ",", " ", "line"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", 
       RowBox[{
        RowBox[{"StringTemplate", "[", "\"\<posCSD[mm]:\\t`1`\\n\>\"", "]"}], 
        "[", "posCSD", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"header", ",", " ", "line"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", 
       RowBox[{
        RowBox[{"StringTemplate", "[", "\"\<posCSE[mm]:\\t`1`\\n\>\"", "]"}], 
        "[", "posCSE", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"header", ",", " ", "line"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", 
       RowBox[{
        RowBox[{"StringTemplate", "[", "\"\<posCID[mm]:\\t`1`\\n\>\"", "]"}], 
        "[", "posCID", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"header", ",", " ", "line"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", 
       RowBox[{
        RowBox[{"StringTemplate", "[", "\"\<posCIE[mm]:\\t`1`\\n\>\"", "]"}], 
        "[", "posCIE", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"header", ",", " ", "line"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", 
       RowBox[{
        RowBox[{
        "StringTemplate", "[", "\"\<polarization:\\t`1`\\n\>\"", "]"}], "[", 
        "polarizationName", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"header", ",", " ", "line"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", 
       RowBox[{
        RowBox[{
        "StringTemplate", "[", "\"\<field_phase[deg]:\\t`1`\\n\>\"", "]"}], 
        "[", "fieldPhaseRound", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"header", ",", " ", "line"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", 
       RowBox[{
        RowBox[{
        "StringTemplate", "[", "\"\<K_Horizontal:\\t`1`\\n\>\"", "]"}], "[", 
        "khRound", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"header", ",", " ", "line"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", 
       RowBox[{
        RowBox[{"StringTemplate", "[", "\"\<K_Vertical:\\t`1`\\n\>\"", "]"}], 
        "[", "kvRound", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"header", ",", " ", "line"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", 
       RowBox[{
        RowBox[{"StringTemplate", "[", "\"\<K:\\t\\t`1`\\n\>\"", "]"}], "[", 
        "kRound", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"header", ",", " ", "line"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"header", ",", "\"\<\\n\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "header", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.767447676712742*^9, 3.7674476901356754`*^9}, {
   3.767447877752833*^9, 3.7674478819250393`*^9}, {3.7674498877634153`*^9, 
   3.7674499000768747`*^9}, {3.782655619766797*^9, 3.7826556288292556`*^9}, {
   3.7826568647102003`*^9, 3.782656886835105*^9}, 3.784621350331092*^9, {
   3.8201328287093325`*^9, 3.8201328301894054`*^9}, {3.8201475833268857`*^9, 
   3.82014772475784*^9}, {3.820147903479143*^9, 3.8201479195002623`*^9}, {
   3.8201479575827456`*^9, 3.8201480152565284`*^9}, {3.820148073780411*^9, 
   3.820148094041765*^9}, {3.8201481578859253`*^9, 3.8201484002139997`*^9}, {
   3.820148442706847*^9, 3.8201489300314655`*^9}, {3.8201489649837694`*^9, 
   3.820148998295968*^9}, {3.8201490518994956`*^9, 3.82014945269989*^9}, {
   3.820149575878006*^9, 3.8201496158606415`*^9}, {3.8201496684041023`*^9, 
   3.8201497274780054`*^9}, {3.8201497623102913`*^9, 
   3.8201497783813515`*^9}, {3.8201499985877542`*^9, 3.820150017769049*^9}, {
   3.820150256796426*^9, 3.820150324490906*^9}, {3.82015038955519*^9, 
   3.820150396285636*^9}, {3.820150623392577*^9, 3.8201506453240223`*^9}, {
   3.8201507623230314`*^9, 3.8201507878947144`*^9}, 3.820151721795121*^9, {
   3.820152623918645*^9, 3.82015263157914*^9}, 3.8201528026126175`*^9, {
   3.8201537926163034`*^9, 3.8201537940663977`*^9}, {3.8201569443179674`*^9, 
   3.8201569486982536`*^9}, {3.8202203671869135`*^9, 3.820220375416733*^9}, {
   3.8203186866073475`*^9, 3.820318926733198*^9}, {3.8205729537402887`*^9, 
   3.8205729550203905`*^9}, 3.8237020897686944`*^9, {3.8237021221251307`*^9, 
   3.8237028642676344`*^9}, {3.823702918355866*^9, 3.8237029480723715`*^9}, {
   3.8237081351245193`*^9, 3.8237081381155195`*^9}, {3.823708239230898*^9, 
   3.8237083489383373`*^9}, {3.8237084330432415`*^9, 
   3.8237084671729097`*^9}, {3.8237085371915345`*^9, 
   3.8237089117360935`*^9}, {3.823708986139993*^9, 3.823709095242025*^9}, {
   3.823710469265715*^9, 3.8237104767377167`*^9}, {3.8237112799595165`*^9, 
   3.8237112873517346`*^9}, {3.824649563704856*^9, 3.8246495648208313`*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[49]:=",ExpressionUUID->"8dafe5be-c29f-4386-8872-1f9e28618821"]
}, Closed]],

Cell[CellGroupData[{

Cell["idFieldmap", "Subsection",
 CellChangeTimes->{{3.7667548871084976`*^9, 3.76675490671941*^9}, 
   3.767449882481743*^9, 3.7826556381260996`*^9, {3.8236212711156225`*^9, 
   3.823621272530834*^9}, {3.8236220989373164`*^9, 
   3.823622099104869*^9}},ExpressionUUID->"0495e470-6a7e-40cd-8ed6-\
af5a74116f80"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idFieldmap", "::", "usage"}], " ", "=", " ", 
    "\"\<idFieldmap[filename, device, xrange, yrange, zrange, nx, ny, nz, \
\\\"silent\\\"\[Rule] False, \\\"header\\\"\[Rule] {}]: Writes the fieldmap \
to file.\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idFieldmap", "[", 
    RowBox[{
    "filename_", ",", " ", "device_", ",", "xrange_", ",", " ", "yrange_", 
     ",", " ", "zrange_", ",", " ", "nx_", ",", " ", "ny_", ",", " ", "nz_", 
     ",", " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<silent\>\"", "\[Rule]", " ", "False"}], ",", " ", 
        RowBox[{"\"\<header\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}]}], "}"}], "]"}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "header", ",", " ", "idx", ",", " ", "fieldmap", ",", " ", "xmin", ",", 
       " ", "xmax", ",", " ", "ymin", ",", " ", "ymax", ",", " ", "zmin", ",",
        " ", "zmax", ",", " ", "xstep", ",", " ", "ystep", ",", " ", "zstep", 
       ",", " ", "x", ",", " ", "y", ",", " ", "z", ",", "  ", "i", ",", " ", 
       "j", ",", " ", "k", ",", "field", ",", " ", "line", ",", " ", "t0", 
       ",", " ", "t1", ",", " ", "silent", ",", " ", "res", ",", " ", "xList",
        ",", " ", "bxList", ",", " ", "byList", ",", " ", "bzList", ",", " ", 
       "bList"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"silent", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<silent\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"header", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<header\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"fieldmap", "=", 
       RowBox[{"OpenWrite", "[", "filename", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"WriteString", "[", 
         RowBox[{"fieldmap", ",", " ", "#"}], "]"}], " ", "&"}], "/@", " ", 
       "header"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"xmin", " ", "=", 
       RowBox[{"xrange", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"xmax", " ", "=", 
       RowBox[{"xrange", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"ymin", " ", "=", 
       RowBox[{"yrange", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ymax", " ", "=", 
       RowBox[{"yrange", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"zmin", " ", "=", 
       RowBox[{"zrange", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"zmax", " ", "=", 
       RowBox[{"zrange", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"xmin", " ", "\[NotEqual]", " ", "xmax"}], ")"}], ",", 
        RowBox[{"xstep", " ", "=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"xmax", "-", "xmin"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"nx", "-", "1"}], ")"}]}]}], ",", " ", 
        RowBox[{"xstep", "=", "0"}]}], " ", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"ymin", " ", "\[NotEqual]", " ", "ymax"}], ")"}], ",", 
        RowBox[{"ystep", " ", "=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"ymax", "-", "ymin"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"ny", "-", "1"}], ")"}]}]}], ",", " ", 
        RowBox[{"ystep", "=", "0"}]}], " ", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"zmin", " ", "\[NotEqual]", " ", "zmax"}], ")"}], ",", 
        RowBox[{"zstep", " ", "=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"zmax", "-", "zmin"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"nz", "-", "1"}], ")"}]}]}], ",", " ", 
        RowBox[{"zstep", "=", "0"}]}], " ", "]"}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"idFieldmapCount", " ", "=", " ", "0"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", " ", "silent"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Fieldmap: \>\"", ",", " ", 
           RowBox[{"ProgressIndicator", "[", 
            RowBox[{
             RowBox[{"Dynamic", "[", "idFieldmapCount", "]"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"0", ",", " ", 
               RowBox[{"nx", "*", "ny", "*", "nz"}]}], "}"}]}], "]"}]}], 
          "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{"fieldmap", ",", " ", 
        RowBox[{
        "\"\<X[mm]\>\"", "<>", " ", "\"\<\\t\>\"", "<>", " ", "\"\<Y[mm]\>\"",
          "<>", " ", "\"\<\\t\>\"", "<>", " ", "\"\<Z[mm]\>\"", "<>", " ", 
         "\"\<\\t\>\"", "<>", " ", "\"\<Bx[T]\>\"", "<>", " ", "\"\<\\t\>\"", 
         "<>", " ", "\"\<By[T]\>\"", "<>", " ", "\"\<\\t\>\"", "<>", " ", 
         "\"\<Bz[T]\>\"", "<>", "\"\<\\n\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{
       "fieldmap", ",", 
        "\"\<-----------------------------------------------------------------\
------------------------------------------------------------------------------\
-------------------\\n\>\""}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"k", "=", "1"}], ",", 
        RowBox[{"k", "\[LessEqual]", "nz"}], ",", 
        RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"z", " ", "=", " ", 
          RowBox[{"zmin", "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"k", "-", "1"}], ")"}], "*", "zstep"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"j", "=", "1"}], ",", 
           RowBox[{"j", "\[LessEqual]", "ny"}], ",", 
           RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"y", " ", "=", " ", 
             RowBox[{"ymin", "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"j", "-", "1"}], ")"}], "*", "ystep"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"xList", ",", " ", "bList"}], " ", "}"}], " ", "=", " ", 
             RowBox[{"Transpose", "[", 
              RowBox[{"radFldLst", "[", 
               RowBox[{"device", ",", "\"\<b\>\"", ",", 
                RowBox[{"{", 
                 RowBox[{"xmin", ",", "y", ",", "z"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"xmax", ",", "y", ",", "z"}], "}"}], ",", "nx", ",", 
                "\"\<arg\>\"", ",", "xmin"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"xList", " ", "=", " ", 
             RowBox[{"Chop", "[", 
              RowBox[{"xList", ",", " ", 
               RowBox[{"10", "^", 
                RowBox[{"-", "6"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"bxList", ",", " ", "byList", ",", " ", "bzList"}], 
              "}"}], "=", " ", 
             RowBox[{"Transpose", "[", "bList", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"For", "[", 
             RowBox[{
              RowBox[{"i", "=", "1"}], ",", 
              RowBox[{"i", "\[LessEqual]", "nx"}], ",", 
              RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"line", " ", "=", 
                RowBox[{
                 RowBox[{"idNumberToString", "[", 
                  RowBox[{"xList", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "]"}], "<>", " ", 
                 "\"\<\\t\>\"", " ", "<>", " ", 
                 RowBox[{"idNumberToString", "[", "y", "]"}], " ", "<>", " ", 
                 "\"\<\\t\>\"", " ", "<>", " ", 
                 RowBox[{"idNumberToString", "[", "z", "]"}], " ", "<>", 
                 "\"\<\\t\>\"", " ", "<>", " ", 
                 RowBox[{"idNumberToString", "[", 
                  RowBox[{"bxList", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "]"}], " ", "<>", " ", 
                 "\"\<\\t\>\"", " ", "<>", "  ", 
                 RowBox[{"idNumberToString", "[", 
                  RowBox[{"byList", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "]"}], "<>", " ", 
                 "\"\<\\t\>\"", " ", "<>", "  ", 
                 RowBox[{"idNumberToString", "[", 
                  RowBox[{"bzList", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "]"}], "<>", 
                 "\"\<\\n\>\""}]}], "  ", ";", " ", "\[IndentingNewLine]", 
               RowBox[{"WriteString", "[", 
                RowBox[{"fieldmap", ",", "line"}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"idFieldmapCount", " ", "+=", " ", "1"}], ";"}]}], 
             "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
          "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Close", "[", "fieldmap", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", " ", "silent"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Fieldmap saved in file: \>\"", ",", " ", "filename"}], 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<idFieldmap: elapsed time = \>\"", ",", 
           RowBox[{"(", 
            RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.767447676712742*^9, 3.7674476901356754`*^9}, {
   3.767447877752833*^9, 3.7674478819250393`*^9}, {3.7674498877634153`*^9, 
   3.7674499000768747`*^9}, {3.782655619766797*^9, 3.7826556288292556`*^9}, {
   3.7826568647102003`*^9, 3.782656886835105*^9}, 3.784621350331092*^9, {
   3.8226496943762016`*^9, 3.8226496960376472`*^9}, {3.82362127373162*^9, 
   3.8236215484454675`*^9}, {3.8236216160216284`*^9, 
   3.8236216272485847`*^9}, {3.8236222520565567`*^9, 3.823622276543029*^9}, {
   3.823709180809042*^9, 3.8237093477881966`*^9}, {3.823710874088629*^9, 
   3.82371088224181*^9}, {3.8237634733943095`*^9, 3.8237634867934537`*^9}, {
   3.8237636035390315`*^9, 3.823763604482473*^9}, {3.8245675435439973`*^9, 
   3.8245675436427355`*^9}, {3.82457116355964*^9, 3.824571167780308*^9}, {
   3.8245712187828245`*^9, 3.8245712536705003`*^9}, {3.824572352018528*^9, 
   3.8245723585889463`*^9}, {3.8246695616154943`*^9, 3.824669590961957*^9}, {
   3.8246696837780747`*^9, 3.8246699528301105`*^9}, {3.82467031395471*^9, 
   3.8246703176079335`*^9}, {3.8246703786964836`*^9, 
   3.8246703924925404`*^9}, {3.8246709986594577`*^9, 
   3.8246710275351863`*^9}, {3.824671187651679*^9, 3.824671199811141*^9}, {
   3.824673308075383*^9, 3.8246733196673927`*^9}, {3.8246739597728467`*^9, 
   3.8246739772171745`*^9}, {3.82467413204139*^9, 3.8246741361474023`*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"0425f402-9b65-4b47-9428-8006222969f7"]
}, Closed]],

Cell[CellGroupData[{

Cell["idKickmap", "Subsection",
 CellChangeTimes->{
  3.7667546801064196`*^9, 3.7667549456130934`*^9, {3.823622172265085*^9, 
   3.8236221741171293`*^9}, {3.824567239465717*^9, 
   3.8245672404450607`*^9}},ExpressionUUID->"7f836bd3-84c3-4549-81b5-\
35d629be865b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"idKickmap", "[", 
    RowBox[{
    "filename_", ",", " ", "device_", ",", "energy_", ",", " ", "xrange_", 
     ",", " ", "yrange_", ",", " ", "zrange_", ",", " ", "nx_", ",", " ", 
     "ny_", ",", " ", "zstep_", ",", " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{"\"\<silent\>\"", "\[Rule]", " ", "False"}], "}"}], "]"}]}], 
    "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "lightSpeed", ",", " ", "brho", ",", " ", "idx", ",", " ", "kickmap", 
       ",", " ", "xmin", ",", " ", "xmax", ",", " ", "ymin", ",", " ", "ymax",
        ",", " ", "zmin", ",", " ", "zmax", ",", " ", "xstep", ",", " ", 
       "ystep", ",", "  ", "i", ",", " ", "j", ",", "line", ",", " ", "t0", 
       ",", " ", "t1", ",", " ", "silent", ",", " ", "kx", ",", " ", "ky", 
       ",", " ", "kickx", ",", "kicky", ",", " ", "kickxList", ",", " ", 
       "kickyList", ",", "\[IndentingNewLine]", "kickxMap", ",", " ", 
       "kickyMap", ",", " ", "px", ",", " ", "py", ",", " ", "pxList", ",", 
       " ", "pyList", ",", " ", "pxStr", ",", " ", "xl", ",", " ", "yl", ",", 
       " ", "zl", ",", " ", "traj", ",", " ", "finalxMap", ",", " ", 
       "finalyMap", ",", " ", "finalxList", ",", " ", "finalyList", ",", " ", 
       "x", ",", " ", "y", ",", " ", "posxStr"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"silent", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<silent\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"lightSpeed", "=", "299792458"}], ";", "\[IndentingNewLine]", 
      RowBox[{"brho", "=", 
       RowBox[{"(", 
        RowBox[{"energy", "*", 
         RowBox[{"1000000000", "/", "lightSpeed"}]}], ")"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"xmin", " ", "=", 
       RowBox[{"xrange", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"xmax", " ", "=", 
       RowBox[{"xrange", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"ymin", " ", "=", 
       RowBox[{"yrange", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ymax", " ", "=", 
       RowBox[{"yrange", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"zmin", " ", "=", 
       RowBox[{"zrange", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"zmax", " ", "=", 
       RowBox[{"zrange", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"xmin", " ", "\[NotEqual]", " ", "xmax"}], ")"}], ",", 
        RowBox[{"xstep", " ", "=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"xmax", "-", "xmin"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"nx", "-", "1"}], ")"}]}]}], ",", " ", 
        RowBox[{"xstep", "=", "0"}]}], " ", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"ymin", " ", "\[NotEqual]", " ", "ymax"}], ")"}], ",", 
        RowBox[{"ystep", " ", "=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"ymax", "-", "ymin"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"ny", "-", "1"}], ")"}]}]}], ",", " ", 
        RowBox[{"ystep", "=", "0"}]}], " ", "]"}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"idKickmapCount", " ", "=", " ", "0"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", " ", "silent"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Kickmap: \>\"", ",", " ", 
           RowBox[{"ProgressIndicator", "[", 
            RowBox[{
             RowBox[{"Dynamic", "[", "idKickmapCount", "]"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"0", ",", " ", 
               RowBox[{"nx", "*", "ny"}]}], "}"}]}], "]"}]}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"pxList", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "\[LessEqual]", "nx"}], ",", " ", 
        RowBox[{"i", "++"}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"AppendTo", "[", 
          RowBox[{"pxList", ",", " ", 
           RowBox[{"xmin", " ", "+", " ", 
            RowBox[{"xstep", "*", 
             RowBox[{"(", 
              RowBox[{"i", "-", "1"}], ")"}]}]}]}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"pyList", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", " ", 
        RowBox[{"j", "\[LessEqual]", " ", "ny"}], ",", " ", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"AppendTo", "[", 
          RowBox[{"pyList", ",", " ", 
           RowBox[{"ymin", " ", "+", " ", 
            RowBox[{"ystep", "*", 
             RowBox[{"(", 
              RowBox[{"j", "-", "1"}], ")"}]}]}]}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"kickxMap", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kickyMap", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"finalxMap", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"finalyMap", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", " ", 
        RowBox[{"j", "\[LessEqual]", "ny"}], ",", " ", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"kickxList", " ", "=", 
          RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"kickyList", " ", "=", 
          RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"finalxList", " ", "=", 
          RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"finalyList", " ", "=", 
          RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"py", " ", "=", " ", 
          RowBox[{"pyList", "[", 
           RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"i", "=", "1"}], ",", 
           RowBox[{"i", "\[LessEqual]", " ", "nx"}], ",", " ", 
           RowBox[{"i", "++"}], ",", " ", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"px", " ", "=", 
             RowBox[{"pxList", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"traj", " ", "=", " ", 
             RowBox[{"idTrajectory", "[", 
              RowBox[{"device", ",", " ", "energy", ",", 
               RowBox[{"{", 
                RowBox[{
                "px", ",", " ", "py", ",", " ", "zmin", ",", " ", "0", ",", 
                 " ", "0", ",", " ", "1"}], "}"}], ",", "zmax", ",", "zstep", 
               ",", " ", 
               RowBox[{"\"\<silent\>\"", "\[Rule]", " ", "True"}]}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"x", " ", "=", " ", 
             RowBox[{"traj", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"-", "1"}], ",", " ", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"y", " ", "=", " ", 
             RowBox[{"traj", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"-", "1"}], ",", " ", "2"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"xl", "=", 
             RowBox[{"traj", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"-", "1"}], ",", "4"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"yl", "=", 
             RowBox[{"traj", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"-", "1"}], ",", "5"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"zl", "=", 
             RowBox[{"traj", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"-", "1"}], ",", "6"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"kickx", " ", "=", " ", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"xl", "/", "zl"}], ")"}], "*", 
              RowBox[{"brho", "^", "2"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"kicky", "=", " ", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"yl", "/", "zl"}], ")"}], "*", 
              RowBox[{"brho", "^", "2"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"kickxList", ",", " ", "kickx"}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"kickyList", ",", " ", "kicky"}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"finalxList", ",", " ", 
              RowBox[{"x", "/", "1000"}]}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"finalyList", ",", " ", 
              RowBox[{"y", "/", "1000"}]}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"idKickmapCount", " ", "+=", " ", "1"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"kickxMap", ",", " ", "kickxList"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"kickyMap", ",", " ", "kickyList"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"finalxMap", ",", " ", "finalxList"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"finalyMap", ",", " ", "finalyList"}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"kickmap", "=", 
       RowBox[{"OpenWrite", "[", "filename", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
      "line", " ", "=", " ", "\"\<# Author:Radia User CNPEM\\n#\\n\>\""}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{"kickmap", ",", "line"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", " ", 
       RowBox[{
        RowBox[{
        "StringTemplate", "[", 
         "\"\<# Total Length of Longitudinal Interval [m]\\n`1`\\n\>\"", 
         "]"}], "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"zmax", " ", "-", " ", "zmin"}], ")"}], "/", "1000"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{"kickmap", ",", "line"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", " ", 
       RowBox[{
        RowBox[{
        "StringTemplate", "[", 
         "\"\<# Number of Horizontal Points\\n`1`\\n\>\"", "]"}], "[", "nx", 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{"kickmap", ",", "line"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", " ", 
       RowBox[{
        RowBox[{
        "StringTemplate", "[", "\"\<# Number of Vertical Points\\n`1`\\n\>\"",
          "]"}], "[", "ny", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{"kickmap", ",", "line"}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"posxStr", " ", "=", " ", 
       RowBox[{"\"\<\\t\\t\>\"", "<>", 
        RowBox[{"StringRiffle", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"idNumberToString", "[", 
             RowBox[{"#", "/", "1000"}], "]"}], " ", "&"}], "/@", " ", 
           "pxList"}], ",", " ", "\"\<\\t\>\""}], "]"}], "<>", 
        "\"\<\\n\>\""}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
      "line", " ", "=", " ", 
       "\"\<# Total Horizontal 2nd Order Kick [T2m2]\\nSTART\\n\>\""}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{"kickmap", ",", "line"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", " ", "posxStr"}], ";", "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{"kickmap", ",", "line"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", " ", 
        RowBox[{"j", "\[LessEqual]", "ny"}], ",", " ", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"line", " ", "=", " ", 
          RowBox[{
           RowBox[{"idNumberToString", "[", 
            RowBox[{
             RowBox[{"pyList", "[", 
              RowBox[{"[", "j", "]"}], "]"}], "/", "1000"}], "]"}], "<>", 
           "\"\<\\t\>\"", "<>", 
           RowBox[{"StringRiffle", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"idNumberToString", "[", "#", "]"}], " ", "&"}], "/@", 
              " ", 
              RowBox[{"kickxMap", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], ",", " ", "\"\<\\t\>\""}], 
            "]"}], "<>", "\"\<\\n\>\""}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"WriteString", "[", 
          RowBox[{"kickmap", ",", "line"}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
      "line", " ", "=", " ", 
       "\"\<# Total Vertical 2nd Order Kick [T2m2]\\nSTART\\n\>\""}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{"kickmap", ",", "line"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", " ", "posxStr"}], ";", "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{"kickmap", ",", "line"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", " ", 
        RowBox[{"j", "\[LessEqual]", "ny"}], ",", " ", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"line", " ", "=", " ", 
          RowBox[{
           RowBox[{"idNumberToString", "[", 
            RowBox[{
             RowBox[{"pyList", "[", 
              RowBox[{"[", "j", "]"}], "]"}], "/", "1000"}], "]"}], "<>", 
           "\"\<\\t\>\"", "<>", 
           RowBox[{"StringRiffle", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"idNumberToString", "[", "#", "]"}], " ", "&"}], "/@", 
              " ", 
              RowBox[{"kickyMap", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], ",", " ", "\"\<\\t\>\""}], 
            "]"}], "<>", "\"\<\\n\>\""}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"WriteString", "[", 
          RowBox[{"kickmap", ",", "line"}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
      "line", " ", "=", " ", 
       "\"\<# Horizontal Final Position [m]\\nSTART\\n\>\""}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{"kickmap", ",", "line"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", " ", "posxStr"}], ";", "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{"kickmap", ",", "line"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", " ", 
        RowBox[{"j", "\[LessEqual]", "ny"}], ",", " ", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"line", " ", "=", " ", 
          RowBox[{
           RowBox[{"idNumberToString", "[", 
            RowBox[{
             RowBox[{"pyList", "[", 
              RowBox[{"[", "j", "]"}], "]"}], "/", "1000"}], "]"}], "<>", 
           "\"\<\\t\>\"", "<>", 
           RowBox[{"StringRiffle", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"idNumberToString", "[", "#", "]"}], " ", "&"}], "/@", 
              " ", 
              RowBox[{"finalxMap", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], ",", " ", "\"\<\\t\>\""}], 
            "]"}], "<>", "\"\<\\n\>\""}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"WriteString", "[", 
          RowBox[{"kickmap", ",", "line"}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
      "line", " ", "=", " ", 
       "\"\<# Vertical Final Position [m]\\nSTART\\n\>\""}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{"kickmap", ",", "line"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"line", " ", "=", " ", "posxStr"}], ";", "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{"kickmap", ",", "line"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", " ", 
        RowBox[{"j", "\[LessEqual]", "ny"}], ",", " ", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"line", " ", "=", " ", 
          RowBox[{
           RowBox[{"idNumberToString", "[", 
            RowBox[{
             RowBox[{"pyList", "[", 
              RowBox[{"[", "j", "]"}], "]"}], "/", "1000"}], "]"}], "<>", 
           "\"\<\\t\>\"", "<>", 
           RowBox[{"StringRiffle", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"idNumberToString", "[", "#", "]"}], " ", "&"}], "/@", 
              " ", 
              RowBox[{"finalyMap", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], ",", " ", "\"\<\\t\>\""}], 
            "]"}], "<>", "\"\<\\n\>\""}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"WriteString", "[", 
          RowBox[{"kickmap", ",", "line"}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Close", "[", "kickmap", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", " ", "silent"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<kickmap saved in file: \>\"", ",", " ", "filename"}], 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<idKickmap: elapsed time = \>\"", ",", 
           RowBox[{"(", 
            RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"kickxMap", ",", " ", "kickyMap"}], "}"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8245652556783466`*^9, 3.8245652638345203`*^9}, {
   3.8245653388019066`*^9, 3.824565989431532*^9}, {3.8245662481013207`*^9, 
   3.824566259605546*^9}, {3.8245671987207527`*^9, 3.824567206024171*^9}, {
   3.8245672580799036`*^9, 3.824567538826623*^9}, {3.8245675950900526`*^9, 
   3.824567625731078*^9}, {3.824568321829807*^9, 3.824568601532316*^9}, {
   3.8245686333192225`*^9, 3.8245687356165047`*^9}, {3.8245687846602325`*^9, 
   3.8245689416720657`*^9}, {3.824568971948078*^9, 3.8245690673567677`*^9}, {
   3.8245691630556707`*^9, 3.824569492446697*^9}, {3.824569616723056*^9, 
   3.824569620570724*^9}, {3.824569654471006*^9, 3.824569714705817*^9}, {
   3.8245701189189243`*^9, 3.8245701291974173`*^9}, {3.824570162430489*^9, 
   3.8245701966499147`*^9}, {3.8245703212305303`*^9, 
   3.8245703396422653`*^9}, {3.8245703783716197`*^9, 
   3.8245703999050064`*^9}, {3.8245704389684305`*^9, 3.824570441677189*^9}, {
   3.8245705207310524`*^9, 3.824570535942318*^9}, {3.8245710798366833`*^9, 
   3.8245711367324286`*^9}, 3.824571235579911*^9, {3.824572364482175*^9, 
   3.824572371680911*^9}, {3.824650995326893*^9, 3.824651008101713*^9}, {
   3.824657758042097*^9, 3.8246577730010695`*^9}, {3.824657833581919*^9, 
   3.8246579240249224`*^9}, {3.824657962033211*^9, 3.824658116293379*^9}, {
   3.824660911279009*^9, 3.8246609662997756`*^9}, {3.8246610040347676`*^9, 
   3.824661045878792*^9}, {3.824661139165181*^9, 3.8246612290416794`*^9}, {
   3.824661457368636*^9, 3.8246614946817956`*^9}, {3.824661578908395*^9, 
   3.824661686401739*^9}, {3.8246617297736764`*^9, 3.824661866177657*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[53]:=",ExpressionUUID->"e59c03cd-f3b3-40b5-a086-99db23009df5"]
}, Closed]],

Cell[CellGroupData[{

Cell["idTrajectoryFile", "Subsection",
 CellChangeTimes->{{3.7667548871084976`*^9, 3.76675490671941*^9}, 
   3.767449882481743*^9, 3.7826556381260996`*^9, {3.820132820008762*^9, 
   3.820132822768936*^9}, {3.820151688212949*^9, 3.820151693903324*^9}, {
   3.823763554203025*^9, 
   3.8237635547874985`*^9}},ExpressionUUID->"22cad2de-4649-45c5-8838-\
069890e9bf4b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idTrajectoryFile", "::", "usage"}], " ", "=", " ", 
    "\"\<idTrajectoryFile[filename, traj, \\\"silent\\\"\[Rule] False, \
\\\"header\\\"\[Rule] {}]: Writes the trajectory to file.\>\""}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idTrajectoryFile", "[", " ", 
    RowBox[{"filename_", ",", "traj_", ",", "  ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<silent\>\"", "\[Rule]", " ", "False"}], ",", " ", 
        RowBox[{"\"\<header\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}]}], "}"}], "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "silent", ",", " ", "header", ",", "  ", "trajFile", ",", "  ", "line", 
       ",", " ", "t0", ",", " ", "t1", ",", "  ", "i"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"silent", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<silent\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"header", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<header\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"trajFile", "=", 
       RowBox[{"OpenWrite", "[", "filename", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"WriteString", "[", 
         RowBox[{"trajFile", ",", " ", "#"}], "]"}], " ", "&"}], "/@", " ", 
       "header"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{"trajFile", ",", " ", 
        RowBox[{
        "\"\<x[mm]\>\"", "<>", " ", "\"\<\\t\>\"", "<>", " ", "\"\<y[mm]\>\"",
          "<>", " ", "\"\<\\t\>\"", "<>", " ", "\"\<z[mm]\>\"", "<>", " ", 
         "\"\<\\t\>\"", "<>", " ", "\"\<dxds\>\"", "<>", " ", "\"\<\\t\>\"", "<>",
          " ", "\"\<dyds\>\"", "<>", " ", "\"\<\\t\>\"", "<>", " ", 
         "\"\<dzds\>\"", "<>", "\"\<\\n\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{
       "trajFile", ",", 
        "\"\<-----------------------------------------------------------------\
------------------------------------------------------------------------------\
-------------------\\n\>\""}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "\[LessEqual]", 
         RowBox[{"Length", "[", "traj", "]"}]}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"line", " ", "=", 
          RowBox[{
           RowBox[{"idNumberToString", "[", 
            RowBox[{"traj", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", " ", "1"}], "]"}], "]"}], "]"}], "<>", " ", 
           "\"\<\\t\>\"", " ", "<>", " ", 
           RowBox[{"idNumberToString", "[", 
            RowBox[{"traj", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", " ", "2"}], "]"}], "]"}], "]"}], " ", "<>", 
           " ", "\"\<\\t\>\"", " ", "<>", " ", 
           RowBox[{"idNumberToString", "[", 
            RowBox[{"traj", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", " ", "3"}], "]"}], "]"}], "]"}], " ", "<>", 
           "\"\<\\t\>\"", " ", "<>", " ", 
           RowBox[{"idNumberToString", "[", 
            RowBox[{"traj", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", " ", "4"}], "]"}], "]"}], "]"}], " ", "<>", 
           " ", "\"\<\\t\>\"", " ", "<>", "  ", 
           RowBox[{"idNumberToString", "[", 
            RowBox[{"traj", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", " ", "5"}], "]"}], "]"}], "]"}], "<>", " ", 
           "\"\<\\t\>\"", " ", "<>", "  ", 
           RowBox[{"idNumberToString", "[", 
            RowBox[{"traj", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", " ", "6"}], "]"}], "]"}], "]"}], "<>", 
           "\"\<\\n\>\""}]}], "  ", ";", " ", "\[IndentingNewLine]", 
         RowBox[{"WriteString", "[", 
          RowBox[{"trajFile", ",", "line"}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Close", "[", "trajFile", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", " ", "silent"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<Trajectory saved in file: \>\"", ",", " ", "filename"}], "]"}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<IdTrajectoryFile: elapsed time = \>\"", ",", 
           RowBox[{"(", 
            RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.767447676712742*^9, 3.7674476901356754`*^9}, {
   3.767447877752833*^9, 3.7674478819250393`*^9}, {3.7674498877634153`*^9, 
   3.7674499000768747`*^9}, {3.782655619766797*^9, 3.7826556288292556`*^9}, {
   3.7826568647102003`*^9, 3.782656886835105*^9}, 3.784621350331092*^9, {
   3.8201328287093325`*^9, 3.8201328301894054`*^9}, {3.8201475833268857`*^9, 
   3.82014772475784*^9}, {3.820147903479143*^9, 3.8201479195002623`*^9}, {
   3.8201479575827456`*^9, 3.8201480152565284`*^9}, {3.820148073780411*^9, 
   3.820148094041765*^9}, {3.8201481578859253`*^9, 3.8201484002139997`*^9}, {
   3.820148442706847*^9, 3.8201489300314655`*^9}, {3.8201489649837694`*^9, 
   3.820148998295968*^9}, {3.8201490518994956`*^9, 3.82014945269989*^9}, {
   3.820149575878006*^9, 3.8201496158606415`*^9}, {3.8201496684041023`*^9, 
   3.8201497274780054`*^9}, {3.8201497623102913`*^9, 
   3.8201497783813515`*^9}, {3.8201499985877542`*^9, 3.820150017769049*^9}, {
   3.820150256796426*^9, 3.820150324490906*^9}, {3.82015038955519*^9, 
   3.820150396285636*^9}, {3.820150623392577*^9, 3.8201506453240223`*^9}, {
   3.8201507623230314`*^9, 3.8201507878947144`*^9}, {3.8201517335859165`*^9, 
   3.820151799450259*^9}, {3.8201518480434513`*^9, 3.820152145583065*^9}, {
   3.8201522712813473`*^9, 3.82015233346713*^9}, {3.8201523901208687`*^9, 
   3.820152605577426*^9}, {3.820152645900069*^9, 3.8201527467889404`*^9}, 
   3.8201527920919256`*^9, 3.820152834384712*^9, 3.820152919720341*^9, {
   3.820154318037429*^9, 3.8201543256479316`*^9}, {3.820154709585966*^9, 
   3.8201547108860326`*^9}, {3.820155081922237*^9, 3.8201551083140097`*^9}, {
   3.8201569614891415`*^9, 3.820156965759404*^9}, {3.820220398988186*^9, 
   3.820220405875295*^9}, {3.8237632010541115`*^9, 3.8237634641610184`*^9}, {
   3.823763499261093*^9, 3.823763639987459*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[54]:=",ExpressionUUID->"1ef0806f-8487-4eab-8d2d-d61d4bbac6eb"]
}, Closed]],

Cell[CellGroupData[{

Cell["idNumberToString", "Subsection",
 CellChangeTimes->{
  3.7667546801064196`*^9, 3.7667549456130934`*^9, {3.823622172265085*^9, 
   3.8236221741171293`*^9}},ExpressionUUID->"984532a4-c5f8-49cf-8d50-\
bc203b7c6435"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idNumberToString", "::", "usage"}], " ", "=", " ", 
    "\"\<idNumberToString[num]: Convert number to string (fieldmap format).\>\
\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idNumberToString", "[", "num_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", "sf", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sf", " ", "=", " ", 
       RowBox[{"ScientificForm", "[", 
        RowBox[{
         RowBox[{"N", "[", "num", "]"}], ",", 
         RowBox[{"NumberFormat", "\[Rule]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Row", "[", 
             RowBox[{"{", 
              RowBox[{"#1", ",", "\"\<e\>\"", ",", "#3"}], "}"}], "]"}], 
            "&"}], ")"}]}], ",", " ", 
         RowBox[{"ExponentFunction", "->", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"-", "5"}], "<", "#", "<", "5"}], ",", "Null", ",", 
              "#"}], "]"}], "&"}], ")"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"StringEndsQ", "[", 
         RowBox[{
          RowBox[{"ToString", "[", "sf", "]"}], ",", " ", "\"\<e\>\""}], 
         "]"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"ToString", "[", 
          RowBox[{"N", "[", "num", "]"}], "]"}], "]"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"ToString", "[", "sf", "]"}], "]"}]}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.823622177007429*^9, 3.823622242394414*^9}, {
  3.823622281905713*^9, 3.8236222827175074`*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[56]:=",ExpressionUUID->"f6047883-0a51-4d77-998d-5a1e374a91b5"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["End Design", "Section",
 CellChangeTimes->{{3.76639811614032*^9, 3.7663981237176037`*^9}, {
   3.8117926979894156`*^9, 3.811792703856547*^9}, {3.8118552160849347`*^9, 
   3.811855218607912*^9}, {3.811859976564584*^9, 3.8118600132665443`*^9}, {
   3.813666661803134*^9, 3.8136666711755733`*^9}, {3.8157515555609293`*^9, 
   3.8157515565375404`*^9}, {3.8159210679048615`*^9, 
   3.8159210685769944`*^9}, {3.8159224850222626`*^9, 3.815922488481221*^9}, {
   3.8159226302717714`*^9, 3.8159226306632223`*^9}, {3.8159231792081647`*^9, 
   3.8159231811301236`*^9}, {3.8159232189971013`*^9, 
   3.8159232383939466`*^9}, {3.8160830139364767`*^9, 3.816083014108356*^9}, {
   3.8161775373453956`*^9, 3.8161775439703765`*^9}, {3.816613501858136*^9, 
   3.8166135065567675`*^9}, {3.8166161415460854`*^9, 3.816616144029846*^9}, {
   3.81661674084603*^9, 3.8166167438130093`*^9}, {3.816628479058016*^9, 
   3.816628481273299*^9}, {3.8166311418144455`*^9, 3.816631145051276*^9}, {
   3.8166341610073614`*^9, 3.8166341681760054`*^9}, 3.816635981014527*^9, {
   3.8167000256123075`*^9, 3.8167000276967854`*^9}, {3.816880017440881*^9, 
   3.816880021459143*^9}, {3.8168831973920145`*^9, 3.8168831997754245`*^9}, {
   3.8168878327078247`*^9, 3.8168878345759387`*^9}, {3.8168879832579412`*^9, 
   3.8168879838829193`*^9}, {3.8246667742749844`*^9, 
   3.824666788782163*^9}},ExpressionUUID->"3e9cd6c9-234d-43bd-8578-\
f8648c0d50d4"],

Cell[CellGroupData[{

Cell["saRandomChange", "Subsection",
 CellChangeTimes->{
  3.7667546801064196`*^9, 3.7667549456130934`*^9, {3.8168801002137437`*^9, 
   3.816880103889874*^9}, {3.8168807078872795`*^9, 3.8168807391768827`*^9}, {
   3.8168816939602575`*^9, 3.816881694122342*^9}, {3.823671634270898*^9, 
   3.8236716379111557`*^9}, {3.8236719329625235`*^9, 3.823671935858776*^9}, {
   3.8236752081414948`*^9, 
   3.8236752083389683`*^9}},ExpressionUUID->"e0e81ba2-3df0-4059-ae9c-\
113518ef41ba"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"saRandomChange", "[", 
    RowBox[{
    "terminationStart_", ",", " ", "terminationEnd_", ",", " ", 
     "deviceParams_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "i", ",", " ", "periodLength", ",", " ", "blockDistance", ",", " ", 
       "blockRegularSize", ",", " ", "blockSizeList", ",", " ", 
       "startLengthList", ",", " ", "startDistanceList", ",", " ", 
       "endLengthList", ",", " ", "endDistanceList", ",", " ", "distanceInc", 
       ",", "\[IndentingNewLine]", "newStartLengthList", ",", " ", 
       "newStartDistanceList", ",", " ", "newEndLengthList", ",", " ", 
       "newEndDistanceList", ",", " ", "newTerminationStart", ",", " ", 
       "newTerminationEnd", ","}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"startLengthList", " ", "=", " ", 
       RowBox[{"terminationStart", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"startDistanceList", " ", "=", " ", 
       RowBox[{"terminationStart", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"endLengthList", " ", "=", " ", 
       RowBox[{"terminationEnd", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"endDistanceList", " ", "=", " ", 
       RowBox[{"terminationEnd", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"periodLength", "=", 
       RowBox[{"deviceParams", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"blockDistance", " ", "=", " ", 
       RowBox[{"deviceParams", "[", 
        RowBox[{"[", "10", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"blockRegularSize", " ", "=", " ", 
       RowBox[{
        RowBox[{"periodLength", "/", "4"}], " ", "-", " ", 
        "blockDistance"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"blockSizeList", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", " ", 
         RowBox[{"blockRegularSize", "/", "4"}], ",", " ", 
         RowBox[{"2", "*", 
          RowBox[{"blockRegularSize", "/", "4"}]}], ",", " ", 
         RowBox[{"3", "*", 
          RowBox[{"blockRegularSize", "/", "4"}]}], ",", " ", 
         "blockRegularSize"}], "}"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"newStartLengthList", " ", "=", " ", "startLengthList"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "\[LessEqual]", " ", 
         RowBox[{
          RowBox[{"Length", "[", "startLengthList", "]"}], "-", "1"}]}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"newStartLengthList", "[", 
           RowBox[{"[", "i", "]"}], "]"}], " ", "=", 
          RowBox[{"RandomChoice", "[", "blockSizeList", "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"distanceInc", " ", "=", " ", "3"}], ";", "\[IndentingNewLine]", 
      RowBox[{"newStartDistanceList", " ", "=", " ", "startDistanceList"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "\[LessEqual]", " ", 
         RowBox[{
          RowBox[{"Length", "[", "startDistanceList", "]"}], "-", "1"}]}], 
        ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"newStartDistanceList", "[", 
           RowBox[{"[", "i", "]"}], "]"}], " ", "+=", "  ", 
          RowBox[{"RandomReal", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "distanceInc"}], ",", " ", "distanceInc"}], "}"}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"newStartDistanceList", "[", 
             RowBox[{"[", "i", "]"}], "]"}], " ", "<", " ", "0"}], ",", " ", 
           RowBox[{
            RowBox[{"newStartDistanceList", "[", 
             RowBox[{"[", "i", "]"}], "]"}], " ", "=", "0"}]}], "]"}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"newTerminationStart", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"newStartLengthList", ",", " ", "newStartDistanceList"}], 
        "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"newEndLengthList", " ", "=", " ", 
       RowBox[{"Reverse", "[", 
        RowBox[{"newStartLengthList", " ", "[", 
         RowBox[{"[", 
          RowBox[{"1", ";;", 
           RowBox[{"-", "2"}]}], "]"}], "]"}], "]"}]}], " ", ";", 
      "\[IndentingNewLine]", 
      RowBox[{"newEndDistanceList", " ", "=", " ", 
       RowBox[{"Reverse", "[", 
        RowBox[{"newStartDistanceList", " ", "[", 
         RowBox[{"[", 
          RowBox[{"1", ";;", 
           RowBox[{"-", "2"}]}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"newTerminationEnd", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"newEndLengthList", ",", " ", "newEndDistanceList"}], "}"}]}],
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"newTerminationStart", ",", " ", "newTerminationEnd"}], "}"}],
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.816880107783351*^9, 3.816880230276433*^9}, {
   3.816880262681966*^9, 3.816880444610259*^9}, {3.816880487593523*^9, 
   3.8168806993535757`*^9}, {3.8168807520222044`*^9, 
   3.8168808763489294`*^9}, {3.816880910977556*^9, 3.816881014908182*^9}, {
   3.8168816963755984`*^9, 3.8168816965383296`*^9}, {3.816884797871211*^9, 
   3.8168847991707783`*^9}, {3.8168851252916994`*^9, 3.816885185161517*^9}, {
   3.8168896858037443`*^9, 3.816889711553609*^9}, {3.816889796084552*^9, 
   3.816889807365776*^9}, {3.816890065976515*^9, 3.816890098054453*^9}, {
   3.816951773115039*^9, 3.8169517761775002`*^9}, {3.8169519394129343`*^9, 
   3.8169519789908895`*^9}, 3.8169521459360523`*^9, {3.816954929467355*^9, 
   3.816954959746269*^9}, {3.816957077008545*^9, 3.816957107160711*^9}, {
   3.816959923015259*^9, 3.816959987982334*^9}, {3.8170251364760456`*^9, 
   3.817025144979414*^9}, {3.8170279075615788`*^9, 3.817027923721131*^9}, {
   3.8170384818442717`*^9, 3.817038492388945*^9}, {3.8170401027210937`*^9, 
   3.817040116177408*^9}, {3.8170408101454997`*^9, 3.8170408115669584`*^9}, {
   3.817041018771804*^9, 3.817041020535239*^9}, {3.817041237217739*^9, 
   3.8170412541895037`*^9}, {3.81704137042377*^9, 3.8170413841332407`*^9}, {
   3.817045361809617*^9, 3.817045430206806*^9}, {3.8170473185672617`*^9, 
   3.817047334847479*^9}, {3.817066158788814*^9, 3.8170661721234865`*^9}, {
   3.8172826711510115`*^9, 3.8172827184549*^9}, {3.8187632160820103`*^9, 
   3.8187632581975546`*^9}, {3.8187632994145203`*^9, 3.818763433958295*^9}, {
   3.8187634796339474`*^9, 3.8187634932568684`*^9}, {3.8187635296908865`*^9, 
   3.8187635774690676`*^9}, {3.8187641280614843`*^9, 
   3.8187642247433743`*^9}, {3.818768960350992*^9, 3.8187690025535803`*^9}, {
   3.818769389880071*^9, 3.8187695184100885`*^9}, {3.8187771422090373`*^9, 
   3.818777143319106*^9}, {3.818841499416845*^9, 3.8188415463214445`*^9}, {
   3.8189266386251793`*^9, 3.8189268284187756`*^9}, {3.8189301459238324`*^9, 
   3.818930146154288*^9}, {3.8226499415358906`*^9, 3.822649953608739*^9}, {
   3.8226501328455324`*^9, 3.82265014686572*^9}, {3.822650202641619*^9, 
   3.822650262405223*^9}, {3.822650394285805*^9, 3.822650395366372*^9}, {
   3.8236716199103336`*^9, 3.823671907297199*^9}, {3.8236719376799016`*^9, 
   3.823672089838683*^9}, {3.8236721275228853`*^9, 3.8236723248268356`*^9}, {
   3.823672368865983*^9, 3.8236723968062134`*^9}, {3.823672791113058*^9, 
   3.8236727916416245`*^9}, {3.823673159428974*^9, 3.823673210000655*^9}, {
   3.823673542840905*^9, 3.823673641904804*^9}, {3.823675209324314*^9, 
   3.82367521069166*^9}, {3.823675842803084*^9, 3.823676074933876*^9}, {
   3.8236971901232185`*^9, 3.823697220090025*^9}, {3.823697265079629*^9, 
   3.823697267271762*^9}, {3.8236973417474923`*^9, 3.823697364250242*^9}, {
   3.823699064559168*^9, 3.8236990666136713`*^9}, {3.8236996596137943`*^9, 
   3.823699703372691*^9}, {3.823699784696066*^9, 3.8236998354642057`*^9}, {
   3.8237995566809244`*^9, 3.823799556810943*^9}, {3.823851625971363*^9, 
   3.8238516655016155`*^9}, {3.823887216718272*^9, 3.8238872350183935`*^9}, {
   3.823930774056116*^9, 3.823930775616194*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[58]:=",ExpressionUUID->"d0f905fc-7f5a-43e7-afb2-9cd18b5a6fd4"]
}, Open  ]],

Cell[CellGroupData[{

Cell["saGetFitness", "Subsection",
 CellChangeTimes->{
  3.7667546801064196`*^9, 3.7667549456130934`*^9, {3.8168801002137437`*^9, 
   3.816880103889874*^9}, {3.816880731286317*^9, 3.816880731591871*^9}, {
   3.816881699790557*^9, 3.8168816999551487`*^9}, {3.823673672494974*^9, 
   3.8236736726665163`*^9}, {3.8236752161311026`*^9, 
   3.8236752163275757`*^9}},ExpressionUUID->"26ecead4-7517-47ce-8f2b-\
1a33c230b8f3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"saGetFitness", "::", "phaseErr"}], " ", "=", 
    "\"\<Inconsistent length between phase parameters dP, dCP, dGV and dGH: \
`1`, `2`, `3` and `4`\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"saGetFitness", "[", 
    RowBox[{
    "terminationStart_", ",", " ", "terminationEnd_", ",", " ", 
     "fitnessWeights_", ",", "deviceParams_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
      "i", ",", " ", "wiBx", ",", " ", "wiBy", ",", " ", "wiiBx", ",", " ", 
       "wiiBy", ",", "\[IndentingNewLine]", " ", "nrPeriods", ",", " ", 
       "periodLength", ",", " ", "mr", ",", " ", "gap", ",", "  ", "dP", " ", 
       ",", " ", "dCP", ",", " ", "dGV", ",", " ", "dGH", ",", "blockShape", 
       ",", " ", "blockDistance", ",", " ", "blockSubdivision", ",", " ", 
       "rectangularShape", ",", " ", "prec", ",", " ", "maxIter", ",", " ", 
       "zi", ",", " ", "zf", ",", " ", "znpts", ",", "\[IndentingNewLine]", 
       "nrPhases", ",", " ", "device", ",", " ", "mat", ",", " ", "iBxList", 
       ",", " ", "iByList", ",", " ", "iiBxList", ",", " ", "iiByList", ",", 
       "iBx", ",", " ", "iBy", ",", " ", "iiBx", ",", " ", "iiBy", ",", " ", 
       "zpos", ",", " ", "ft", ",", " ", "fitness", ",", "fieldIntegrals", 
       ",", " ", "fitnessList", ",", "fieldIntegralsList"}], " ", 
      "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wiBx", " ", "=", " ", 
       RowBox[{"fitnessWeights", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wiBy", " ", "=", "  ", 
       RowBox[{"fitnessWeights", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wiiBx", " ", "=", "  ", 
       RowBox[{"fitnessWeights", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wiiBy", " ", "=", "  ", 
       RowBox[{"fitnessWeights", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"nrPeriods", " ", "=", 
       RowBox[{"deviceParams", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], " ", ";", "\[IndentingNewLine]", 
      RowBox[{"periodLength", "=", 
       RowBox[{"deviceParams", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mr", "=", " ", 
       RowBox[{"deviceParams", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"gap", " ", "=", 
       RowBox[{"deviceParams", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dP", " ", "=", " ", 
       RowBox[{"deviceParams", "[", 
        RowBox[{"[", "5", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dCP", " ", "=", " ", 
       RowBox[{"deviceParams", "[", 
        RowBox[{"[", "6", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dGV", "=", " ", 
       RowBox[{"deviceParams", "[", 
        RowBox[{"[", "7", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dGH", " ", "=", " ", 
       RowBox[{"deviceParams", "[", 
        RowBox[{"[", "8", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"blockShape", " ", "=", " ", 
       RowBox[{"deviceParams", "[", 
        RowBox[{"[", "9", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"blockDistance", " ", "=", " ", 
       RowBox[{"deviceParams", "[", 
        RowBox[{"[", "10", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"blockSubdivision", " ", "=", " ", 
       RowBox[{"deviceParams", "[", 
        RowBox[{"[", "11", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"rectangularShape", " ", "=", 
       RowBox[{"deviceParams", "[", 
        RowBox[{"[", "12", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"prec", " ", "=", " ", 
       RowBox[{"deviceParams", "[", 
        RowBox[{"[", "13", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"maxIter", " ", "=", " ", 
       RowBox[{"deviceParams", "[", 
        RowBox[{"[", "14", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"zi", " ", "=", " ", 
       RowBox[{"deviceParams", "[", 
        RowBox[{"[", "15", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"zf", " ", "=", " ", 
       RowBox[{"deviceParams", "[", 
        RowBox[{"[", "16", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"znpts", " ", "=", " ", 
       RowBox[{"deviceParams", "[", 
        RowBox[{"[", "17", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Depth", "[", "dP", "]"}], "\[Equal]", "1"}], ",", " ", 
        RowBox[{"dP", " ", "=", " ", 
         RowBox[{"{", "dP", "}"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Depth", "[", "dCP", "]"}], "\[Equal]", "1"}], ",", " ", 
        RowBox[{"dCP", " ", "=", " ", 
         RowBox[{"{", "dCP", "}"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Depth", "[", "dGV", "]"}], "\[Equal]", "1"}], ",", " ", 
        RowBox[{"dGV", " ", "=", " ", 
         RowBox[{"{", "dGV", "}"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Depth", "[", "dGH", "]"}], "\[Equal]", "1"}], ",", " ", 
        RowBox[{"dGH", " ", "=", " ", 
         RowBox[{"{", "dGH", "}"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", " ", 
         RowBox[{
          RowBox[{"Length", "[", "dP", "]"}], "\[Equal]", " ", 
          RowBox[{"Length", "[", "dCP", "]"}], " ", "\[Equal]", " ", 
          RowBox[{"Length", "[", "dGV", "]"}], "\[Equal]", " ", 
          RowBox[{"Length", "[", "dGH", "]"}]}]}], ",", "  ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"saGetFitness", "::", "phaseErr"}], ",", 
           RowBox[{"Length", "[", "dP", "]"}], ",", 
           RowBox[{"Length", "[", "dCP", "]"}], ",", " ", 
           RowBox[{"Length", "[", "dGV", "]"}], ",", " ", 
           RowBox[{"Length", "[", "dGH", "]"}]}], "]"}], ";", 
         RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"nrPhases", " ", "=", " ", 
       RowBox[{"Length", "[", "dP", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"fieldIntegralsList", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"fitnessList", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", " ", 
        RowBox[{"i", "\[LessEqual]", " ", "nrPhases"}], ",", " ", 
        RowBox[{"i", "++"}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"device", " ", "=", " ", 
          RowBox[{"idDelta", "[", 
           RowBox[{
           "nrPeriods", ",", " ", "periodLength", ",", " ", "mr", ",", " ", 
            "gap", ",", " ", 
            RowBox[{"\"\<dP\>\"", "\[Rule]", " ", 
             RowBox[{"dP", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ",", " ", 
            RowBox[{"\"\<dCP\>\"", "\[Rule]", " ", 
             RowBox[{"dCP", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ",", " ", 
            RowBox[{"\"\<dGV\>\"", "\[Rule]", " ", 
             RowBox[{"dGV", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ",", " ", 
            RowBox[{"\"\<dGH\>\"", "\[Rule]", " ", 
             RowBox[{"dGH", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ",", " ", 
            RowBox[{"\"\<blockShape\>\"", "\[Rule]", " ", "blockShape"}], ",",
             "  ", 
            RowBox[{
            "\"\<blockDistance\>\"", "\[Rule]", " ", "blockDistance"}], ",", 
            RowBox[{
            "\"\<blockSubdivision\>\"", "\[Rule]", " ", "blockSubdivision"}], 
            ",", " ", 
            RowBox[{
            "\"\<rectangularShape\>\"", "\[Rule]", " ", "rectangularShape"}], 
            ",", "  ", 
            RowBox[{
            "\"\<terminationStart\>\"", "\[Rule]", " ", "terminationStart"}], 
            ",", " ", 
            RowBox[{
            "\"\<terminationEnd\>\"", "\[Rule]", " ", "terminationEnd"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"mat", "=", " ", 
          RowBox[{"RadMatNdFeB", "[", "mr", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"device", "=", " ", 
          RowBox[{"radMatApl", "[", 
           RowBox[{"device", ",", " ", "mat"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"idSolve", "[", 
          RowBox[{"device", ",", " ", "prec", ",", " ", "maxIter", ",", " ", 
           RowBox[{"\"\<silent\>\"", "\[Rule]", " ", "True"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"zpos", ",", " ", "iBxList", ",", " ", "iiBxList"}], "}"}],
           " ", "=", 
          RowBox[{"idFieldIntegralsList", "[", 
           RowBox[{
           "device", ",", " ", "\"\<bx\>\"", ",", " ", "\"\<z\>\"", ",", " ", 
            RowBox[{"{", 
             RowBox[{"zi", ",", " ", "zf"}], "}"}], ",", " ", "znpts", " ", 
            ",", 
            RowBox[{"\"\<silent\>\"", "\[Rule]", " ", "True"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"zpos", ",", " ", "iByList", ",", " ", "iiByList"}], "}"}],
           " ", "=", 
          RowBox[{"idFieldIntegralsList", "[", 
           RowBox[{
           "device", ",", " ", "\"\<by\>\"", ",", " ", "\"\<z\>\"", ",", " ", 
            RowBox[{"{", 
             RowBox[{"zi", ",", " ", "zf"}], "}"}], ",", " ", "znpts", " ", 
            ",", 
            RowBox[{"\"\<silent\>\"", "\[Rule]", " ", "True"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"iBx", " ", "=", " ", 
          RowBox[{"iBxList", "[", 
           RowBox[{"[", 
            RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"iBy", " ", "=", " ", 
          RowBox[{"iByList", "[", 
           RowBox[{"[", 
            RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"iiBx", " ", "=", " ", 
          RowBox[{"iiBxList", "[", 
           RowBox[{"[", 
            RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"iiBy", " ", "=", " ", 
          RowBox[{"iiByList", "[", 
           RowBox[{"[", 
            RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"ft", " ", "=", 
          RowBox[{"Sqrt", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"wiBx", "*", "iBx"}], ")"}], "^", "2"}], " ", "+", 
              " ", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"wiBy", "*", "iBy"}], ")"}], "^", "2"}], "+", " ", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"wiiBx", "*", "iiBx"}], ")"}], "^", "2"}], "+", " ", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"wiiBy", "*", "iiBy"}], ")"}], "^", "2"}]}], ")"}], 
            "/", "4"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"fieldIntegralsList", ",", " ", 
           RowBox[{"{", 
            RowBox[{
            "iBx", ",", " ", "iBy", ",", " ", "iiBx", ",", " ", "iiBy"}], 
            "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"fitnessList", ",", " ", "ft"}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"fieldIntegrals", " ", "=", " ", 
       RowBox[{"Flatten", "[", "fieldIntegralsList", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fitness", " ", "=", 
       RowBox[{"Sqrt", "[", 
        RowBox[{
         RowBox[{"Total", "[", 
          RowBox[{"(", 
           RowBox[{"fitnessList", "^", "2"}], ")"}], "]"}], "/", 
         RowBox[{"Length", "[", "fitnessList", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"fieldIntegrals", ",", "  ", "fitness"}], "}"}], "]"}], 
      ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJwdz1tIU3EAx/FhVg8azJMJGWzpZikKXpgTNzc9KihCMQKX62GGc5Ko83YI
ak1ILGUoOi+BGsxU9iAOTJ0nSWPCFHWIU1HUwgg9L3kUSUR68PL/nYcfH36P
36iS6mfmIJFIFEMGlWFvLiQ1PG3fXgyVEkfWN8VQ29z1GMov/yXABl1FHgxO
6a6FK+X+DphicE1ATd2a4Cv9sg9KNAHBrHbG85B4ZYqZhZkunzaKeODmquDx
WdooDNCcYMK0g4omWtXjgpGjX5wyYmj8zyEo9ShYODcp+QaVxYVDcuKEIWQa
Nm7e3YGTpqNdaLEWdeWjx327B+6eF66biU3vfuzBiDtfFWXEpfc6Jbynk/+u
Ib6IHTiCiZzY2UZM2mGHof4Tk+olGi/r0iGfkXExj15Z780FomJmwD1Vz9Mz
OdkspBzqYxaucYKfW5+rZola58ds6Bd/eHmL4en6PY8Jev8cVEBj1f9KqHsd
aaHwzRuCTx80MHBQabHBxKlW3+lbnt4q6F+GY9H5ceE2nvZp1MVw3GEshUkq
tge6JGl9gqsGP5TdyA1AijnZhwvp8X+h/pHqEHLfgyxSYrLVWAsX7d4W+Ov+
qh2m2k4dsIV60gmvAQ5dH5Y=
  "],
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[59]:=",ExpressionUUID->"3059ee64-61b3-4801-b133-c8e419215243"]
}, Closed]],

Cell[CellGroupData[{

Cell["saGenerateNew", "Subsection",
 CellChangeTimes->{
  3.7667546801064196`*^9, 3.7667549456130934`*^9, {3.8168801002137437`*^9, 
   3.816880103889874*^9}, {3.8168807078872795`*^9, 3.8168807391768827`*^9}, {
   3.816881403783141*^9, 3.816881434611103*^9}, {3.816881651291838*^9, 
   3.816881689722683*^9}, {3.816882163006714*^9, 3.8168821794266195`*^9}, {
   3.8168822280888453`*^9, 3.816882229636052*^9}, {3.823675198863311*^9, 
   3.82367519902285*^9}, {3.8236752341748314`*^9, 
   3.823675235515231*^9}},ExpressionUUID->"bea7f828-99d1-4ac3-8e63-\
cc281a529401"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"saGenerateNew", "[", 
    RowBox[{
    "terminationStart_", ",", " ", "terminationEnd_", ",", " ", 
     "fitnessWeights_", ",", "deviceParams_", ",", "  ", "initialFitness_", 
     ",", " ", "saFilename_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
      "newTerminationStart", ",", " ", "newTerminationEnd", ",", "  ", 
       "fieldIntegrals", ",", " ", "fitness", ",", " ", "solution", ",", " ", 
       "noNew", ",", " ", "saFile"}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"newTerminationStart", ",", " ", "newTerminationEnd"}], "}"}],
        " ", "=", " ", 
       RowBox[{"saRandomChange", "[", 
        RowBox[{
        "terminationStart", ",", " ", "terminationEnd", ",", " ", 
         "deviceParams"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"fieldIntegrals", ",", " ", "fitness"}], "}"}], " ", "=", 
       RowBox[{"saGetFitness", "[", 
        RowBox[{
        "newTerminationStart", ",", " ", "newTerminationEnd", ",", 
         "fitnessWeights", ",", " ", "deviceParams"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"solution", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", 
         RowBox[{
         "newTerminationStart", ",", " ", "newTerminationEnd", ",", " ", 
          "fieldIntegrals", ",", " ", "fitness"}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"saFile", "=", 
       RowBox[{"OpenAppend", "[", "saFilename", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{"saFile", ",", 
        RowBox[{"ExportString", "[", 
         RowBox[{
          RowBox[{"{", "solution", "}"}], ",", "\"\<CSV\>\""}], "]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Close", "[", "saFile", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"fitness", " ", "\[LessEqual]", "  ", "initialFitness"}], ",",
         "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"noNew", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Return", "[", 
          RowBox[{"{", 
           RowBox[{
           "newTerminationStart", ",", " ", "newTerminationEnd", ",", "  ", 
            "fitness", ",", " ", "noNew"}], "}"}], "]"}]}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"noNew", " ", "=", " ", "1"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Return", "[", 
          RowBox[{"{", 
           RowBox[{
           "terminationStart", ",", " ", "terminationEnd", ",", 
            "initialFitness", ",", "noNew"}], "}"}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->CompressedData["
1:eJwd0F1I02EUBvARGwXa1JiGFzmnf0pL0VV+XKiwqXNRLJNdJFjSShtEq9lM
/EgHTSYKOh3GhCkr5hhThML9Iac1S6KNChouzAgpRpmMID9qtE19n/fi8IPn
wOHhiFR36poOcDicHDKwOKU9nnE3LOlfeZsoJLoCwWRYYTSfgMzuZh7srr1V
A3+4OQqoOTlwhe7la9fgctJXDbR6z9qhota5AFWOmVcwvZ8JwETH4U+QNaT+
gWLj8h5sERw9mEl0hPwJsG/jC3VWPyeAi/PeY5ARxl3woVg9BWXpT7zQckaz
BL3nWkKQtep+0VwciEH5qj8Oj7O9XBF6RKZ58PrNbD4cqV6hvnit7YSFI5WP
YPBSZBx2SC9OQGWHahZGxspZ2NDV6oGft/Ln4aZychEyhn/Uqua+D/Re6P9H
yNdGk7KIl3k9KXBYaVdDn2bnNnw3UKCDyT9HqZ2xBTMsHkuwwO9Nehss/DZE
fT/q8sBTxg2qSfcsJxv/3C7JhaWu4CS8kGt2wq6iejfkuktYGG2ssTHEwbW6
x3DV57/P3gtL0nyn2+Dfnbwbz4lHTC+bof28aF3wICy5usdQpfVDYWhVew6l
EnnR6LiQ+KZgyQYnpmM9mcTfjU/1UCZ1GqA+o6wX7gMe6TVA
  "],
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[61]:=",ExpressionUUID->"78dbbb42-3216-42e7-a5b0-efbf93a97f33"]
}, Closed]],

Cell[CellGroupData[{

Cell["saOptimize", "Subsection",
 CellChangeTimes->{
  3.7667546801064196`*^9, 3.7667549456130934`*^9, {3.8168801002137437`*^9, 
   3.816880103889874*^9}, {3.8168807078872795`*^9, 3.8168807391768827`*^9}, {
   3.816881403783141*^9, 3.816881434611103*^9}, {3.816881651291838*^9, 
   3.816881689722683*^9}, {3.8168820714261265`*^9, 3.8168820838712406`*^9}, {
   3.823675472646649*^9, 
   3.8236754731223736`*^9}},ExpressionUUID->"5a879d5a-930c-42c7-84d3-\
df7399a83db6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"saOptimize", "[", 
    RowBox[{
    "initialTerminationStart_", ",", " ", "initialTerminationEnd_", ",", 
     "fitnessWeights_", ",", "  ", "deviceParams_", ",", " ", "saFilename_", 
     ",", " ", "saMaxIter_", ",", " ", "saMaxNoNew_", ",", " ", 
     "saFitnessTol_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
      "initialFitness", ",", "initialSolution", ",", " ", 
       "initialFieldIntegrals", ",", " ", "i", ",", " ", "noNew", ",", " ", 
       "noNewCount", ",", "  ", "t0", ",", " ", "t1", ",", " ", 
       "newTerminationStart", ",", " ", "newTerminationEnd", ",", " ", 
       "newFitness", ",", " ", "terminationStart", ",", " ", "terminationEnd",
        ",", " ", "fitness"}], " ", "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"initialFieldIntegrals", ",", " ", "initialFitness"}], "}"}], 
       " ", "=", 
       RowBox[{"saGetFitness", "[", 
        RowBox[{
        "initialTerminationStart", ",", " ", "initialTerminationEnd", ",", 
         " ", "fitnessWeights", ",", " ", "deviceParams"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"initialSolution", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", 
         RowBox[{
         "initialTerminationStart", ",", " ", "initialTerminationEnd", ",", 
          " ", "initialFieldIntegrals", ",", " ", "initialFitness"}], "}"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Export", "[", 
       RowBox[{"saFilename", ",", 
        RowBox[{"{", "initialSolution", "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"terminationStart", ",", " ", "terminationEnd"}], "}"}], " ", 
       "=", " ", 
       RowBox[{"{", 
        RowBox[{
        "initialTerminationStart", ",", " ", "initialTerminationEnd"}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"fitness", " ", "=", " ", "initialFitness"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"noNewCount", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<0: \>\"", ",", " ", "fitness"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", " ", 
        RowBox[{"i", "<", " ", "saMaxIter"}], ",", " ", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "newTerminationStart", ",", " ", "newTerminationEnd", ",", " ", 
            "newFitness", ",", " ", "noNew"}], "}"}], " ", "=", " ", 
          RowBox[{"saGenerateNew", "[", 
           RowBox[{
           "terminationStart", ",", " ", "terminationEnd", ",", " ", 
            "fitnessWeights", ",", "  ", "deviceParams", ",", " ", "fitness", 
            ",", " ", "saFilename"}], "]"}]}], " ", ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"terminationStart", ",", " ", "terminationEnd"}], "}"}], 
          " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{"newTerminationStart", ",", " ", "newTerminationEnd"}], 
           "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"fitness", "=", "  ", "newFitness"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"noNew", " ", "\[Equal]", "0"}], ",", " ", 
           RowBox[{"Print", "[", 
            RowBox[{"i", ",", " ", "\"\<: \>\"", ",", " ", "fitness"}], 
            "]"}]}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"noNewCount", " ", "+=", " ", "noNew"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"noNewCount", " ", "\[GreaterEqual]", " ", "saMaxNoNew"}], 
           ",", " ", 
           RowBox[{"Break", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"fitness", " ", "\[LessEqual]", " ", "saFitnessTol"}], ",",
            " ", 
           RowBox[{"Break", "[", "]"}]}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<SAOptimize elapsed time = \>\"", ",", 
        RowBox[{"N", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"t1", "-", "t0"}], ")"}], "/", "60"}], "]"}], ",", 
        "\"\< min\>\""}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{
        "terminationStart", ",", " ", "terminationEnd", ",", " ", "fitness"}],
         "}"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.816880107783351*^9, 3.816880230276433*^9}, {
   3.816880262681966*^9, 3.816880444610259*^9}, {3.816880487593523*^9, 
   3.8168806993535757`*^9}, {3.8168807520222044`*^9, 
   3.8168808763489294`*^9}, {3.816880910977556*^9, 3.816881014908182*^9}, {
   3.816881441648512*^9, 3.816881645259803*^9}, {3.8168816854578104`*^9, 
   3.8168818091418576`*^9}, {3.8168818404265194`*^9, 3.81688205667245*^9}, {
   3.8168821036443305`*^9, 3.8168821494205537`*^9}, {3.816882249999645*^9, 
   3.816882307513317*^9}, {3.816882422987484*^9, 3.8168825585374675`*^9}, {
   3.816882590294593*^9, 3.8168827622653522`*^9}, {3.8168827980126514`*^9, 
   3.8168830577411184`*^9}, {3.8168830929382935`*^9, 
   3.8168830959296007`*^9}, {3.816883126736448*^9, 3.8168831312055893`*^9}, 
   3.816883184527899*^9, {3.816883497491046*^9, 3.8168835349889727`*^9}, {
   3.816883754426834*^9, 3.8168837867754793`*^9}, {3.816884055427255*^9, 
   3.81688409250557*^9}, {3.8168841466450133`*^9, 3.8168841560454545`*^9}, {
   3.8168842987987185`*^9, 3.8168843148459263`*^9}, {3.8168844683873625`*^9, 
   3.8168845839244947`*^9}, {3.8168846140719347`*^9, 
   3.8168847074362354`*^9}, {3.816885808230753*^9, 3.8168858186186028`*^9}, {
   3.816885974842887*^9, 3.816885975427087*^9}, {3.816886061239793*^9, 
   3.8168862956885004`*^9}, {3.8168863538426294`*^9, 
   3.8168863651594114`*^9}, {3.816887064256966*^9, 3.816887089887624*^9}, {
   3.8168872414551935`*^9, 3.8168872418234406`*^9}, {3.8168872730217514`*^9, 
   3.8168873082173867`*^9}, {3.816887346706809*^9, 3.816887349491025*^9}, {
   3.8168874280159655`*^9, 3.816887428514983*^9}, {3.816888140102994*^9, 
   3.816888211901439*^9}, {3.8168895795210648`*^9, 3.816889583489811*^9}, {
   3.8168901194606705`*^9, 3.816890196366603*^9}, {3.816890277510249*^9, 
   3.8168902822602005`*^9}, {3.81689162824619*^9, 3.816891643511755*^9}, {
   3.816959283211017*^9, 3.816959300101131*^9}, {3.8236754743201714`*^9, 
   3.8236758250874586`*^9}, {3.823697069855064*^9, 3.8236971115425053`*^9}, {
   3.8236973202789125`*^9, 3.823697330097637*^9}, {3.8236989918367834`*^9, 
   3.82369899228561*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[62]:=",ExpressionUUID->"97f2534e-952d-48db-a255-85ad00fb7051"]
}, Closed]]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Delta Sabia", "Chapter",
 CellChangeTimes->{{3.681300194179221*^9, 3.6813002033832407`*^9}, {
   3.681305983976405*^9, 3.6813059853359213`*^9}, {3.6813176225703306`*^9, 
   3.6813176235079107`*^9}, {3.6813177175941257`*^9, 3.68131771915676*^9}, {
   3.708272177122472*^9, 3.708272189394394*^9}, {3.708272239370994*^9, 
   3.708272253185425*^9}, {3.7247626663439655`*^9, 3.724762668594143*^9}, 
   3.724763762181196*^9, {3.725974849294973*^9, 3.725974857279992*^9}, {
   3.7316800228814087`*^9, 3.7316800249126425`*^9}, {3.731761928333893*^9, 
   3.731761928740137*^9}, {3.7377345647344294`*^9, 3.7377345664687967`*^9}, {
   3.737994165253688*^9, 3.7379941653786864`*^9}, {3.7489625392900763`*^9, 
   3.7489625531505637`*^9}, {3.749318816981333*^9, 3.749318817559469*^9}, {
   3.7656382216793394`*^9, 3.7656382261328287`*^9}, {3.7662401432029853`*^9, 
   3.766240154985159*^9}, {3.7663282678653297`*^9, 3.766328270484855*^9}, {
   3.766331146283388*^9, 3.7663311568355923`*^9}, {3.7663982782306576`*^9, 
   3.7663982795028768`*^9}, {3.7664037488989267`*^9, 
   3.7664037535714073`*^9}, {3.76675425955847*^9, 3.766754260902328*^9}, {
   3.767446029232342*^9, 3.7674460297011285`*^9}, {3.7675176217294626`*^9, 
   3.767517621841589*^9}, {3.7685471006341314`*^9, 3.7685471031625986`*^9}, {
   3.782651674525923*^9, 3.7826516762290554`*^9}, {3.7827472341594315`*^9, 
   3.7827472344406757`*^9}, {3.7845390971377993`*^9, 
   3.7845390993098416`*^9}, {3.7846213628789454`*^9, 
   3.7846213635508842`*^9}, {3.784971285415371*^9, 3.784971285852929*^9}, {
   3.80003815573755*^9, 3.8000381597687845`*^9}, {3.8049514458306084`*^9, 
   3.804951448440013*^9}, {3.8062446719465714`*^9, 3.8062446751540537`*^9}, {
   3.811791929593967*^9, 3.8117919321569138`*^9}, {3.8117920042649097`*^9, 
   3.811792032147236*^9}, {3.8118212232455654`*^9, 3.8118212243258395`*^9}, {
   3.811855173078432*^9, 3.8118551748205085`*^9}, {3.813666226120046*^9, 
   3.8136662293236427`*^9}, {3.8157445404480095`*^9, 3.815744553217987*^9}, {
   3.8236766868638616`*^9, 3.8236766879639177`*^9}, {3.8236767823672867`*^9, 
   3.82367678570735*^9}, 3.823676830070672*^9, {3.823695649204563*^9, 
   3.823695657909268*^9}, {3.8237840685239453`*^9, 3.8237840686885047`*^9}, {
   3.824485032548038*^9, 3.8244850334955025`*^9}, {3.824486448552109*^9, 
   3.8244864493928585`*^9}, {3.8246668208623343`*^9, 
   3.824666822310465*^9}},ExpressionUUID->"535ffeac-0472-42b3-ab68-\
8ca72601b680"],

Cell[CellGroupData[{

Cell["Parameters", "Section",
 CellChangeTimes->{{3.76639811614032*^9, 3.7663981237176037`*^9}, {
  3.8117926979894156`*^9, 3.811792703856547*^9}, {3.8118552160849347`*^9, 
  3.811855218607912*^9}, {3.82430750963361*^9, 
  3.824307512713369*^9}},ExpressionUUID->"a2cb0b07-751a-4c9f-9600-\
66fff12d225d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"ID", " ", "main", " ", "parameters"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"nrPeriods", " ", "=", " ", "21"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"periodLength", " ", "=", " ", "52.5"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"gap", " ", "=", " ", "13.6"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"blockDistance", " ", "=", " ", "0.125"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"blockSize", " ", "=", " ", 
     RowBox[{
      RowBox[{"periodLength", "/", "4"}], " ", "-", " ", "blockDistance"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"PM", " ", "material", " ", "parameters"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mr", " ", "=", " ", "1.37"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Block", " ", "shape"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"blockShapeA", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "5.25"}], ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "22.5"}], ",", 
         RowBox[{"-", "19.3"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "22.5"}], ",", " ", 
         RowBox[{"-", "29.2"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "17.8"}], ",", " ", 
         RowBox[{"-", "33.2"}]}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"17.8", ",", " ", 
         RowBox[{"-", "33.2"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"22.5", ",", 
         RowBox[{"-", "29.2"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"22.5", ",", 
         RowBox[{"-", "19.3"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"5.25", ",", "0"}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"blockShapeB", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "17.8"}], ",", " ", 
         RowBox[{"-", "33.2"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "17.8"}], ",", 
         RowBox[{"-", "38.4"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"17.8", ",", " ", 
         RowBox[{"-", "38.4"}]}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"17.8", ",", " ", 
         RowBox[{"-", "33.2"}]}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"blockShapeC", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "17.8"}], ",", 
         RowBox[{"-", "38.4"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "22.5"}], ",", 
         RowBox[{"-", "42.4"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "22.5"}], ",", 
         RowBox[{"-", "49"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "21.5"}], ",", 
         RowBox[{"-", "50"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"21.5", ",", 
         RowBox[{"-", "50"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"22.5", ",", 
         RowBox[{"-", "49"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"22.5", ",", 
         RowBox[{"-", "42.4"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"17.8", ",", 
         RowBox[{"-", "38.4"}]}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"blockShape", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"blockShapeA", ",", " ", "blockShapeB", ",", "blockShapeC"}], 
      "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"rectangularShape", " ", "=", " ", "False"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"blockSubdivisionA", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"3", ",", " ", "3", ",", " ", "2"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"blockSubdivisionB", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"1", ",", " ", "1", ",", " ", "2"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"blockSubdivisionC", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"1", ",", " ", "1", ",", "2"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"blockSubdivision", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
      "blockSubdivisionA", ",", " ", "blockSubdivisionB", ",", " ", 
       "blockSubdivisionC"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Longitudinal", " ", 
     RowBox[{"range", " ", "[", "mm", "]"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"zstep", " ", "=", " ", "2"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"zsteptraj", " ", "=", " ", 
     RowBox[{"\[Pi]", "/", "2"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"zi", " ", "=", " ", 
     RowBox[{"-", "1000"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"zf", " ", "=", " ", "1000"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"znpts", " ", "=", 
     RowBox[{
      RowBox[{"Round", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"zf", " ", "-", " ", "zi"}], ")"}], "/", "zstep"}], " ", 
       "]"}], "+", " ", "1"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Horizontal", " ", 
     RowBox[{"range", " ", "[", "mm", "]"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"xstep", " ", "=", "0.5"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"xi", " ", "=", " ", 
     RowBox[{"-", "7"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"xf", " ", "=", " ", "7"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"xnpts", " ", "=", " ", 
     RowBox[{
      RowBox[{"Round", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"xf", " ", "-", "xi"}], ")"}], "/", "xstep"}], " ", "]"}], 
      "+", " ", "1"}]}], ";"}], " ", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Vertical", " ", 
     RowBox[{"range", " ", "[", "mm", "]"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ystep", " ", "=", "0.5"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"yi", " ", "=", " ", 
     RowBox[{"-", "4"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"yf", " ", "=", " ", "4"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ynpts", " ", "=", " ", 
     RowBox[{
      RowBox[{"Round", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"yf", " ", "-", " ", "yi"}], ")"}], "/", "ystep"}], " ", 
       "]"}], "+", " ", "1"}]}], ";"}], " ", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Particle", " ", 
     RowBox[{"energy", " ", "[", "GeV", "]"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"energy", " ", "=", " ", "3"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Radia", " ", "randomization", " ", "magnitudes"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"radFldLenTol", "[", 
     RowBox[{
      RowBox[{"10", "^", 
       RowBox[{"-", "12"}]}], ",", 
      RowBox[{"10", "^", 
       RowBox[{"-", "12"}]}]}], " ", "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Solver", " ", "options"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"prec", " ", "=", " ", "0.00001"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"maxIter", " ", "=", " ", "1000"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Silent", " ", "flag"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"silent", " ", "=", " ", "True"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Insertion", " ", "device"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"deviceName", " ", "=", " ", "\"\<DeltaSabia\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"End", " ", "design"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"startLengthList", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"blockSize", "/", "4"}], ",", " ", 
       RowBox[{"blockSize", "/", "4"}], ",", " ", 
       RowBox[{"3", "*", 
        RowBox[{"blockSize", "/", "4"}]}], ",", " ", 
       RowBox[{"3", "*", 
        RowBox[{"blockSize", "/", "4"}]}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"startDistanceList", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"8.7", ",", " ", "2", ",", " ", "3.3", ",", " ", "1"}], "}"}]}],
     ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"AppendTo", "[", 
     RowBox[{"startLengthList", ",", " ", "blockSize"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"AppendTo", "[", 
     RowBox[{"startDistanceList", ",", " ", "blockDistance"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"terminationStart", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"startLengthList", ",", " ", "startDistanceList"}], "}"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"endLengthList", " ", "=", " ", 
     RowBox[{"Reverse", "[", 
      RowBox[{"startLengthList", " ", "[", 
       RowBox[{"[", 
        RowBox[{"1", ";;", 
         RowBox[{"-", "2"}]}], "]"}], "]"}], "]"}]}], " ", ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"endDistanceList", " ", "=", " ", 
     RowBox[{"Reverse", "[", 
      RowBox[{"startDistanceList", " ", "[", 
       RowBox[{"[", 
        RowBox[{"1", ";;", 
         RowBox[{"-", "2"}]}], "]"}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"terminationEnd", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"endLengthList", ",", " ", "endDistanceList"}], "}"}]}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{
  3.811855207172743*^9, {3.8118552376751156`*^9, 3.811855275314695*^9}, {
   3.811855308364966*^9, 3.811855346532337*^9}, {3.8118557027938423`*^9, 
   3.811855702925171*^9}, {3.8118558092389507`*^9, 3.8118558093790627`*^9}, {
   3.811855908058054*^9, 3.811855908459084*^9}, {3.811856081254526*^9, 
   3.8118561692498074`*^9}, {3.811856273232277*^9, 3.81185627338993*^9}, {
   3.81185722712294*^9, 3.8118572605837917`*^9}, {3.811858735804346*^9, 
   3.811858779588729*^9}, {3.8118589053674154`*^9, 3.8118589062479534`*^9}, {
   3.8118595391736546`*^9, 3.811859547778454*^9}, {3.8118596833788958`*^9, 
   3.811859685326743*^9}, {3.8118597441516953`*^9, 3.8118597495638866`*^9}, {
   3.811859784644433*^9, 3.811859794582543*^9}, {3.811859829052552*^9, 
   3.811859871760453*^9}, {3.8118600609322777`*^9, 3.8118601507438817`*^9}, {
   3.811860581708088*^9, 3.811860582338484*^9}, {3.811861410043792*^9, 
   3.8118614169696198`*^9}, {3.811862208244576*^9, 3.8118622113284826`*^9}, {
   3.8118641025775394`*^9, 3.8118641610648546`*^9}, {3.8118643600561056`*^9, 
   3.8118643828865585`*^9}, {3.811864443079011*^9, 3.811864512881933*^9}, {
   3.811993905187863*^9, 3.811993923288112*^9}, {3.8119946982651463`*^9, 
   3.811994816826828*^9}, {3.8119949571054792`*^9, 3.8119949806237135`*^9}, {
   3.8119954359278374`*^9, 3.811995465916664*^9}, {3.8119958892166176`*^9, 
   3.811995889626624*^9}, {3.811996963630056*^9, 3.8119969651118603`*^9}, {
   3.812096164248562*^9, 3.8120961661986866`*^9}, {3.8124426592342777`*^9, 
   3.812442745989946*^9}, {3.8124428389174237`*^9, 3.8124428391074553`*^9}, {
   3.812527230138237*^9, 3.812527230458268*^9}, {3.81252799770525*^9, 
   3.8125280007054453`*^9}, {3.812535550024563*^9, 3.812535643410362*^9}, {
   3.812542457566344*^9, 3.8125425541923804`*^9}, {3.81254258608436*^9, 
   3.8125425973350773`*^9}, {3.812542911852826*^9, 3.8125429231335464`*^9}, {
   3.812606154017066*^9, 3.812606155067148*^9}, {3.813666249289554*^9, 
   3.8136663337349753`*^9}, {3.813666404159743*^9, 3.813666406213176*^9}, {
   3.813666864813153*^9, 3.813666873654956*^9}, {3.815744558107267*^9, 
   3.8157445876424084`*^9}, {3.8157451165219603`*^9, 3.815745128888291*^9}, {
   3.815745541424957*^9, 3.815745542130571*^9}, {3.8157504810312405`*^9, 
   3.815750486790907*^9}, {3.815750925612025*^9, 3.8157509331318073`*^9}, {
   3.815751189024087*^9, 3.815751189254117*^9}, {3.8157512493682775`*^9, 
   3.8157512494783783`*^9}, {3.8157514619795437`*^9, 
   3.8157514626808777`*^9}, {3.815752239682006*^9, 3.815752241191635*^9}, {
   3.8157526903683243`*^9, 3.815752691711067*^9}, {3.8157532348434033`*^9, 
   3.815753246959155*^9}, {3.815913804285653*^9, 3.8159138070900755`*^9}, {
   3.815914182298482*^9, 3.815914183480729*^9}, {3.8159154784810677`*^9, 
   3.8159154895651927`*^9}, {3.8160826167214503`*^9, 3.816082685268034*^9}, 
   3.8160829737316103`*^9, {3.816083195405877*^9, 3.816083196780873*^9}, {
   3.8160848672625313`*^9, 3.816084887231207*^9}, {3.8161799487633095`*^9, 
   3.816179968028837*^9}, {3.816180472249189*^9, 3.8161804748898354`*^9}, {
   3.8161806475453415`*^9, 3.816180647701652*^9}, {3.8161807052326756`*^9, 
   3.816180705779517*^9}, {3.816181147277858*^9, 3.8161811530590982`*^9}, {
   3.8161895617390995`*^9, 3.8161895742859335`*^9}, {3.8166134361251383`*^9, 
   3.8166134427239065`*^9}, {3.8166136799002304`*^9, 
   3.8166137121822486`*^9}, {3.8166306364786444`*^9, 3.816630637331376*^9}, {
   3.8168857523176584`*^9, 3.8168857582357388`*^9}, {3.816888759688429*^9, 
   3.8168887601415772`*^9}, {3.816889323456911*^9, 3.816889328441248*^9}, {
   3.8170522610742545`*^9, 3.8170522682555227`*^9}, {3.817072726354745*^9, 
   3.817072733472889*^9}, {3.8187660745340295`*^9, 3.81876607486409*^9}, {
   3.8187685262503304`*^9, 3.818768531890706*^9}, {3.818773918503582*^9, 
   3.818773919763671*^9}, {3.81877698759726*^9, 3.8187769963178053`*^9}, {
   3.818842228899935*^9, 3.8188422339376554`*^9}, 3.8189269780774603`*^9, {
   3.8189273043443546`*^9, 3.8189273045746384`*^9}, {3.81892790363011*^9, 
   3.8189279037372627`*^9}, {3.818936369734997*^9, 3.8189363701456203`*^9}, {
   3.822558225226124*^9, 3.8225582254557886`*^9}, {3.82367683502138*^9, 
   3.8236768788082037`*^9}, {3.8236769419442472`*^9, 
   3.8236769994404106`*^9}, {3.8236774649197288`*^9, 3.823677495534802*^9}, {
   3.823680772328678*^9, 3.8236807744549904`*^9}, {3.823681193903244*^9, 
   3.823681194017932*^9}, {3.823681882090225*^9, 3.823681889228123*^9}, {
   3.8236822522770624`*^9, 3.8236823008879766`*^9}, {3.823684525925112*^9, 
   3.823684534463292*^9}, {3.82368457599515*^9, 3.8236845791267595`*^9}, {
   3.82369569327363*^9, 3.8236956962686167`*^9}, {3.8236958821581793`*^9, 
   3.8236958854982414`*^9}, {3.823696111684951*^9, 3.8236961178325005`*^9}, {
   3.823698366696628*^9, 3.823698372643714*^9}, {3.8236990239787636`*^9, 
   3.823699024496413*^9}, {3.8237105524122076`*^9, 3.8237105689828663`*^9}, {
   3.8237581487258215`*^9, 3.8237581490280128`*^9}, {3.8237600019452324`*^9, 
   3.8237600021676383`*^9}, {3.823760219148488*^9, 3.8237602198356476`*^9}, {
   3.8237624207204266`*^9, 3.823762426458327*^9}, {3.823762805166047*^9, 
   3.8237628440569725`*^9}, {3.8237637471247807`*^9, 
   3.8237637472315044`*^9}, {3.823764268562667*^9, 3.823764268837949*^9}, 
   3.823764315109872*^9, {3.823767552652255*^9, 3.823767556439108*^9}, {
   3.8237700007236176`*^9, 3.8237700026933556`*^9}, 3.8237711564890385`*^9, {
   3.823776686779951*^9, 3.823776687079151*^9}, {3.823776720090808*^9, 
   3.8237767221981716`*^9}, {3.8237768156351237`*^9, 3.823776816077956*^9}, {
   3.8237775750890894`*^9, 3.8237775753334265`*^9}, {3.82377940913361*^9, 
   3.82377940922038*^9}, {3.8237820824787693`*^9, 3.8237820827121434`*^9}, {
   3.8237832014129615`*^9, 3.823783201591486*^9}, {3.823783654103536*^9, 
   3.82378365495826*^9}, {3.823783707846577*^9, 3.823783736198718*^9}, {
   3.8237840824327245`*^9, 3.8237840989854283`*^9}, {3.823784141143609*^9, 
   3.8237841415724626`*^9}, {3.8237844965329533`*^9, 
   3.8237844971443167`*^9}, {3.8237847190504827`*^9, 3.823784719623947*^9}, {
   3.823793630365896*^9, 3.823793630575903*^9}, {3.824209529502087*^9, 
   3.824209557380163*^9}, {3.824221909300223*^9, 3.8242219126302853`*^9}, {
   3.8243042939609685`*^9, 3.8243042994672394`*^9}, {3.8243044408380737`*^9, 
   3.8243044411462793`*^9}, {3.8243065402010193`*^9, 3.824306540532134*^9}, {
   3.8243894175387287`*^9, 3.8243894352812676`*^9}, {3.824389956152605*^9, 
   3.8243899661299157`*^9}, {3.824393721478353*^9, 3.824393722857663*^9}, {
   3.8243941553328447`*^9, 3.824394156616412*^9}, {3.824394274242762*^9, 
   3.8243942798447776`*^9}, {3.8243944131342287`*^9, 
   3.8243944180560894`*^9}, {3.8243948662379613`*^9, 
   3.8243948697316165`*^9}, {3.82439644656364*^9, 3.824396448274062*^9}, {
   3.824396572583537*^9, 3.8243965767344027`*^9}, {3.8243971398630395`*^9, 
   3.8243971409611025`*^9}, {3.8243976482959137`*^9, 
   3.8243976573895874`*^9}, {3.824486436434535*^9, 3.8244864389438505`*^9}, {
   3.824486536321275*^9, 3.8244865479601*^9}, {3.824487174684738*^9, 
   3.8244871858524113`*^9}, {3.824559823406048*^9, 3.824559823989525*^9}, {
   3.82456301286836*^9, 3.824563013607382*^9}, {3.824563270344349*^9, 
   3.8245632710674143`*^9}, 3.824563331192518*^9, 3.8245640135832148`*^9, {
   3.824564049833211*^9, 3.8245640527893*^9}, {3.824567663418213*^9, 
   3.824567665065796*^9}, {3.824647008612229*^9, 3.8246470251300273`*^9}, {
   3.824647175110712*^9, 3.824647194334268*^9}, {3.8246486816232862`*^9, 
   3.82464869394337*^9}, {3.8246494703695855`*^9, 3.8246494862451334`*^9}, {
   3.82465753978914*^9, 3.824657540659808*^9}, {3.8246581659554806`*^9, 
   3.824658189137477*^9}, {3.824658286255556*^9, 3.8246583017580953`*^9}, {
   3.8246619092593994`*^9, 3.8246619220820556`*^9}, {3.8246655510404243`*^9, 
   3.8246655546736794`*^9}, {3.8246662339997654`*^9, 3.824666236016368*^9}, {
   3.82466631426*^9, 3.824666332978883*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"2bbf7119-20d7-43e5-bc76-37c2958c21df"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Fieldmap and Kickmap Function", "Section",
 CellChangeTimes->{{3.76639811614032*^9, 3.7663981237176037`*^9}, {
   3.8117926979894156`*^9, 3.811792703856547*^9}, {3.8118552160849347`*^9, 
   3.811855218607912*^9}, {3.811859976564584*^9, 3.8118600132665443`*^9}, {
   3.813666661803134*^9, 3.8136666711755733`*^9}, {3.8157515555609293`*^9, 
   3.8157515565375404`*^9}, {3.8159210679048615`*^9, 
   3.8159210685769944`*^9}, {3.8159224850222626`*^9, 3.815922488481221*^9}, {
   3.8159226302717714`*^9, 3.8159226306632223`*^9}, {3.8159231792081647`*^9, 
   3.8159231811301236`*^9}, {3.8159232189971013`*^9, 
   3.8159232383939466`*^9}, {3.8160830139364767`*^9, 3.816083014108356*^9}, {
   3.8161775373453956`*^9, 3.8161775439703765`*^9}, {3.816613501858136*^9, 
   3.8166135065567675`*^9}, {3.8166161415460854`*^9, 3.816616144029846*^9}, {
   3.81661674084603*^9, 3.8166167438130093`*^9}, {3.8166281021759367`*^9, 
   3.8166281047061005`*^9}, {3.8166318711315536`*^9, 3.816631873408121*^9}, {
   3.8166346475879755`*^9, 3.816634648188053*^9}, {3.816635915546548*^9, 
   3.8166359174295936`*^9}, {3.816883209102043*^9, 3.816883224245637*^9}, 
   3.816887824762886*^9, {3.8168894767870975`*^9, 3.8168894842714396`*^9}, {
   3.816890039664094*^9, 3.816890039742222*^9}, {3.816957053788333*^9, 
   3.8169570542040377`*^9}, {3.8170452981007433`*^9, 
   3.8170453083992147`*^9}, {3.823761231205571*^9, 3.8237612368285484`*^9}, {
   3.823764740744796*^9, 3.823764747632363*^9}, {3.8237648150240183`*^9, 
   3.8237648159365788`*^9}, {3.823767935665269*^9, 3.823767939793188*^9}, {
   3.8246472553729033`*^9, 
   3.824647319582095*^9}},ExpressionUUID->"4080ba1f-9241-4118-9b19-\
b7848e8f21b7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"idFieldmapKickmap", "[", 
    RowBox[{"dP_", ",", " ", "dCP_", ",", " ", "dGV_", ",", " ", "dGH_"}], 
    "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"t0", ",", " ", "t1"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", " ", "=", " ", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Create", " ", "ID", " ", "model"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"device", "=", " ", 
       RowBox[{"idDelta", "[", 
        RowBox[{
        "nrPeriods", ",", " ", "periodLength", ",", " ", "mr", ",", " ", 
         "gap", ",", "  ", 
         RowBox[{"\"\<dP\>\"", "\[Rule]", " ", "dP"}], ",", 
         RowBox[{"\"\<dCP\>\"", "\[Rule]", " ", "dCP"}], ",", " ", 
         RowBox[{"\"\<dGV\>\"", "\[Rule]", " ", "dGV"}], ",", " ", 
         RowBox[{"\"\<dGH\>\"", "\[Rule]", " ", "dGH"}], ",", "  ", 
         RowBox[{"\"\<blockShape\>\"", " ", "\[Rule]", " ", "blockShape"}], 
         " ", ",", " ", 
         RowBox[{
         "\"\<blockDistance\>\"", " ", "\[Rule]", " ", "blockDistance"}], " ",
          ",", 
         RowBox[{
         "\"\<blockSubdivision\>\"", "\[Rule]", " ", "blockSubdivision"}], 
         ",", " ", 
         RowBox[{
         "\"\<rectangularShape\>\"", "\[Rule]", " ", "rectangularShape"}], 
         ",", 
         RowBox[{
         "\"\<terminationStart\>\"", "\[Rule]", " ", "terminationStart"}], 
         ",", " ", 
         RowBox[{
         "\"\<terminationEnd\>\"", "\[Rule]", " ", "terminationEnd"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Apply", " ", "material", " ", "and", " ", "solve"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"mat", "=", " ", 
       RowBox[{"RadMatNdFeB", "[", "mr", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"device", "=", " ", 
       RowBox[{"radMatApl", "[", 
        RowBox[{"device", ",", " ", "mat"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"idSolve", "[", 
       RowBox[{"device", ",", " ", "prec", ",", " ", "maxIter", ",", " ", 
        RowBox[{"\"\<silent\>\"", "\[Rule]", " ", "silent"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Get", " ", "K", " ", "parameter", " ", "value"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "bx", ",", " ", "by", ",", " ", "bz", ",", " ", "kh", ",", " ", 
         "kv"}], "}"}], "=", " ", 
       RowBox[{"idInfo", "[", 
        RowBox[{"device", ",", " ", "periodLength", ",", " ", 
         RowBox[{"\"\<silent\>\"", "\[Rule]", " ", "True"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Get", " ", "phase", " ", "between", " ", "Bx", " ", "and", " ", 
        "By"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"fieldPhase", " ", "=", " ", 
       RowBox[{"idFieldPhase", "[", 
        RowBox[{
        "device", ",", " ", "periodLength", ",", " ", "\"\<z\>\"", ",", " ", 
         RowBox[{"{", 
          RowBox[{"zi", ",", " ", "zf"}], "}"}], ",", " ", "znpts", ",", " ", 
         RowBox[{"\"\<silent\>\"", "\[Rule]", " ", "silent"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"fieldPhase", " ", "=", " ", 
       RowBox[{"Round", "[", 
        RowBox[{"fieldPhase", ",", " ", "1"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fieldPhase", " ", "=", " ", 
       RowBox[{"180", " ", "-", " ", 
        RowBox[{"Mod", "[", 
         RowBox[{
          RowBox[{"180", "-", "fieldPhase"}], ",", " ", "360"}], "]"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"fieldPhase", " ", "=", 
       RowBox[{"Abs", "[", "fieldPhase", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"tolFieldPhase", " ", "=", " ", "1"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Set", " ", "polarization", " ", "name"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Mod", "[", 
          RowBox[{"fieldPhase", ",", " ", "180"}], "]"}], " ", "\[LessEqual]",
          " ", "tolFieldPhase"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
         "polarizationName", " ", "=", " ", "\"\<LinearPolarization\>\""}], 
         ";"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
         "polarizationName", " ", "=", " ", 
          "\"\<EllipticalPolarization\>\""}], ";"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Set", " ", "displacement", " ", "name"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"displacementName", " ", "=", " ", "\"\<\>\""}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Which", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"dGV", " ", "\[NotEqual]", " ", "0"}], ",", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"dGV", " ", ">", " ", "0"}], ",", "  ", 
           RowBox[{"displacementName", " ", "=", " ", "\"\<+dGV\>\""}], ",", 
           " ", 
           RowBox[{"displacementName", " ", "=", " ", "\"\<-dGV\>\""}]}], 
          "]"}], ";"}], ",", "\[IndentingNewLine]", 
        RowBox[{"dGH", " ", "\[NotEqual]", " ", "0"}], ",", " ", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"dGH", " ", ">", " ", "0"}], ",", "  ", 
           RowBox[{"displacementName", " ", "=", " ", "\"\<+dGH\>\""}], ",", 
           " ", 
           RowBox[{"displacementName", " ", "=", " ", "\"\<-dGH\>\""}]}], 
          "]"}], ";"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"dGH", " ", "\[Equal]", "dGV", "\[Equal]", "0"}], " ", "&&", 
         " ", 
         RowBox[{"dCP", " ", "\[NotEqual]", "0"}]}], " ", ",", " ", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"dCP", " ", ">", " ", "0"}], ",", "  ", 
           RowBox[{"displacementName", " ", "=", " ", "\"\<+dCP\>\""}], ",", 
           " ", 
           RowBox[{"displacementName", " ", "=", " ", "\"\<-dCP\>\""}]}], 
          "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Set", " ", "date", " ", "string"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"date", " ", "=", " ", 
       RowBox[{"DateString", "[", 
        RowBox[{"{", 
         RowBox[{
         "\"\<Year\>\"", ",", "\"\<-\>\"", ",", "\"\<Month\>\"", ",", 
          "\"\<-\>\"", ",", "\"\<Day\>\""}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Get", " ", "fieldmap", " ", "and", " ", "kickmap", " ", "filenames"}],
        "*)"}], "\[IndentingNewLine]", 
      RowBox[{"xrange", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"xi", ",", " ", "xf"}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"yrange", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"yi", ",", " ", "yf"}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"zrange", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"zi", ",", " ", "zf"}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"fieldmapName", " ", "=", " ", 
       RowBox[{"idFilename", "[", 
        RowBox[{
        "date", ",", " ", "deviceName", ",", " ", "polarizationName", ",", 
         "  ", "xrange", ",", " ", "yrange", ",", " ", "zrange", ",", "  ", 
         "kh", ",", " ", "kv", ",", " ", 
         RowBox[{"\"\<fileExtension\>\"", "\[Rule]", " ", "\"\<.fld\>\""}], 
         ",", " ", 
         RowBox[{
         "\"\<displacementName\>\"", "\[Rule]", "displacementName"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kickmapName", " ", "=", " ", 
       RowBox[{"idFilename", "[", 
        RowBox[{
        "date", ",", " ", "deviceName", ",", " ", "polarizationName", ",", 
         "  ", "xrange", ",", " ", "yrange", ",", " ", "zrange", ",", "  ", 
         "kh", ",", " ", "kv", ",", " ", 
         RowBox[{"\"\<fileExtension\>\"", "\[Rule]", " ", "\"\<.kck\>\""}], 
         ",", " ", 
         RowBox[{
         "\"\<displacementName\>\"", "\[Rule]", "displacementName"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Get", " ", "fieldmap", " ", "header"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"magnetLength", " ", "=", " ", 
       RowBox[{
        RowBox[{"nrPeriods", "*", "periodLength"}], "  ", "+", " ", 
        RowBox[{"Total", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", "terminationStart", "}"}], "]"}], "]"}], "+", " ", 
        RowBox[{"Total", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", "terminationEnd", "}"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"header", " ", "=", " ", 
       RowBox[{"idHeader", "[", 
        RowBox[{
        "date", ",", " ", "deviceName", ",", " ", "polarizationName", ",", 
         "  ", "xrange", ",", " ", "yrange", ",", " ", "zrange", ",", "  ", 
         "kh", ",", " ", "kv", ",", " ", "gap", ",", " ", "periodLength", ",",
          " ", "magnetLength", ",", " ", "fieldPhase", ",", " ", 
         RowBox[{"\"\<displacementName\>\"", "\[Rule]", "displacementName"}], 
         ",", " ", 
         RowBox[{"\"\<dP\>\"", "\[Rule]", " ", "dP"}], ",", " ", 
         RowBox[{"\"\<dCP\>\"", "\[Rule]", " ", "dCP"}], ",", " ", 
         RowBox[{"\"\<dGV\>\"", "\[Rule]", "dGV"}], ",", " ", 
         RowBox[{"\"\<dGH\>\"", "\[Rule]", " ", "dGH"}]}], "]"}]}], " ", ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Generate", " ", "fieldmap"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"idFieldmap", "[", 
       RowBox[{
       "fieldmapName", ",", " ", "device", ",", " ", "xrange", ",", " ", 
        "yrange", ",", " ", "zrange", ",", " ", "xnpts", ",", " ", "ynpts", 
        ",", " ", "znpts", ",", " ", 
        RowBox[{"\"\<header\>\"", "\[Rule]", " ", "header"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Generate", " ", "kickmap"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"idKickmap", "[", 
       RowBox[{
       "kickmapName", ",", " ", "device", ",", "energy", ",", " ", "xrange", 
        ",", " ", "yrange", ",", " ", "zrange", ",", " ", "xnpts", ",", " ", 
        "ynpts", ",", " ", "zsteptraj"}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"t1", " ", "=", " ", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Total evaluation time: \>\"", ",", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"t1", "-", "t0"}], ")"}], "/", "60"}], ",", " ", 
        "\"\< min\>\""}], "]"}], ";"}]}], "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.816880107783351*^9, 3.816880230276433*^9}, {
   3.816880262681966*^9, 3.816880444610259*^9}, {3.816880487593523*^9, 
   3.8168806993535757`*^9}, {3.8168807520222044`*^9, 
   3.8168808763489294`*^9}, {3.816880910977556*^9, 3.816881014908182*^9}, {
   3.816881441648512*^9, 3.816881645259803*^9}, {3.8168816854578104`*^9, 
   3.8168818091418576`*^9}, {3.8168818404265194`*^9, 3.81688205667245*^9}, {
   3.8168821036443305`*^9, 3.8168821494205537`*^9}, {3.816882249999645*^9, 
   3.816882307513317*^9}, {3.816882422987484*^9, 3.8168825585374675`*^9}, {
   3.816882590294593*^9, 3.8168827622653522`*^9}, {3.8168827980126514`*^9, 
   3.8168830577411184`*^9}, {3.8168830929382935`*^9, 
   3.8168830959296007`*^9}, {3.816883126736448*^9, 3.8168831312055893`*^9}, 
   3.816883184527899*^9, {3.816883237249057*^9, 3.816883259341673*^9}, {
   3.816883292437337*^9, 3.8168833983024898`*^9}, {3.816883428342263*^9, 
   3.816883446919776*^9}, 3.8168834805238404`*^9, {3.8168838167848525`*^9, 
   3.816883816985095*^9}, {3.8168838820470643`*^9, 3.816883937467182*^9}, 
   3.816883982917334*^9, {3.8168843759529877`*^9, 3.8168844580344086`*^9}, {
   3.816885554090678*^9, 3.816885557575469*^9}, 3.816885617550913*^9, {
   3.816885780818596*^9, 3.816885781780112*^9}, {3.816886307471447*^9, 
   3.8168863240168605`*^9}, {3.8168864358973246`*^9, 3.81688644039065*^9}, 
   3.8168870450775795`*^9, {3.8168872130887547`*^9, 3.8168872132434025`*^9}, 
   3.8168872656737995`*^9, {3.8168875616789565`*^9, 3.816887566545887*^9}, {
   3.8168877928749423`*^9, 3.81688779963785*^9}, {3.8168885359220448`*^9, 
   3.8168885406573286`*^9}, {3.8168894909432898`*^9, 3.816889494990158*^9}, 
   3.8168898544593525`*^9, {3.8168900435703287`*^9, 3.816890050085945*^9}, {
   3.8168902102259254`*^9, 3.816890265088409*^9}, {3.816891863401534*^9, 
   3.816892066588699*^9}, {3.81689214521517*^9, 3.816892146590181*^9}, {
   3.8168923120499144`*^9, 3.816892319487421*^9}, {3.8168928773784075`*^9, 
   3.816892878425282*^9}, {3.8168930610339403`*^9, 3.8168930613620653`*^9}, {
   3.816893292894269*^9, 3.8168932940973897`*^9}, {3.8168938091928215`*^9, 
   3.816893812364726*^9}, {3.816952432458358*^9, 3.816952437488226*^9}, {
   3.816952887563924*^9, 3.8169528876486835`*^9}, {3.8169570576037025`*^9, 
   3.8169570642561407`*^9}, {3.816959269418141*^9, 3.816959270786971*^9}, {
   3.816959887401658*^9, 3.8169598944480796`*^9}, {3.816960384978834*^9, 
   3.816960388310608*^9}, 3.817026002459528*^9, {3.817033152206505*^9, 
   3.8170331523376637`*^9}, {3.8170343967854395`*^9, 
   3.8170343975006247`*^9}, {3.8170348738028936`*^9, 3.817034875951169*^9}, {
   3.817041736925796*^9, 3.8170417383023567`*^9}, {3.8170425540571613`*^9, 
   3.817042562839853*^9}, {3.81704476797348*^9, 3.8170447689364986`*^9}, {
   3.81704531906533*^9, 3.8170453518380084`*^9}, {3.817045449990939*^9, 
   3.817045450526562*^9}, {3.8170472393918066`*^9, 3.8170472409919653`*^9}, {
   3.817047308600215*^9, 3.8170473105207214`*^9}, {3.8170477397180433`*^9, 
   3.817047781462483*^9}, {3.81705233249939*^9, 3.81705237841214*^9}, 
   3.817052633482874*^9, {3.8170661124180875`*^9, 3.817066116086795*^9}, {
   3.8172103966993275`*^9, 3.817210422664258*^9}, {3.817222241149458*^9, 
   3.8172222848869267`*^9}, {3.8172826421781073`*^9, 3.817282653199188*^9}, {
   3.8187642562205596`*^9, 3.8187643398182063`*^9}, {3.8187658135777836`*^9, 
   3.8187659041734023`*^9}, 3.8187661126463995`*^9, {3.8187672896829243`*^9, 
   3.8187672973634033`*^9}, {3.8187683399669437`*^9, 3.818768340096958*^9}, {
   3.818768815923313*^9, 3.8187688294505653`*^9}, {3.818768941081375*^9, 
   3.8187689439627995`*^9}, {3.8187710728877516`*^9, 3.818771074737897*^9}, {
   3.818777166833126*^9, 3.8187771690232677`*^9}, {3.8188415653993225`*^9, 
   3.818841606817257*^9}, {3.818841647594376*^9, 3.8188416487364616`*^9}, {
   3.818853055157863*^9, 3.818853120051784*^9}, {3.818853181766655*^9, 
   3.818853218084937*^9}, {3.818853989960623*^9, 3.8188540318023744`*^9}, {
   3.818854071220685*^9, 3.8188540769283533`*^9}, 3.818854131148296*^9, {
   3.8188542380690145`*^9, 3.818854242287079*^9}, {3.8188617993780823`*^9, 
   3.818861804074972*^9}, {3.818925651667938*^9, 3.8189257979483213`*^9}, {
   3.8189264295712943`*^9, 3.8189265276006713`*^9}, {3.81892655836339*^9, 
   3.818926601572564*^9}, {3.818927006745433*^9, 3.8189270776417227`*^9}, {
   3.818936511571546*^9, 3.818936529150356*^9}, {3.822669194527028*^9, 
   3.8226692493358707`*^9}, {3.8227400284542*^9, 3.8227400778853917`*^9}, {
   3.823183673325361*^9, 3.823183689481614*^9}, {3.823243652019828*^9, 
   3.823243671054446*^9}, {3.823259005588685*^9, 3.823259012007261*^9}, {
   3.8233290690735426`*^9, 3.823329073870559*^9}, {3.8236958127838297`*^9, 
   3.8236965304263706`*^9}, {3.8236965634021244`*^9, 3.823696597996578*^9}, {
   3.823696676504696*^9, 3.823696723236638*^9}, {3.8236968825164247`*^9, 
   3.823696900835402*^9}, {3.8236973136895456`*^9, 3.8236973166217*^9}, {
   3.8236975033410563`*^9, 3.82369750978179*^9}, {3.823697700705864*^9, 
   3.8236977116426444`*^9}, {3.8236978136665735`*^9, 
   3.8236978239500875`*^9}, {3.8236978798265247`*^9, 3.823697886549534*^9}, {
   3.823698093146666*^9, 3.8236981143808417`*^9}, {3.8236986517453456`*^9, 
   3.8236986561196413`*^9}, {3.823698695624918*^9, 3.823698752479771*^9}, {
   3.8236992936501374`*^9, 3.823699302562256*^9}, {3.8236993632768106`*^9, 
   3.8236994479143157`*^9}, {3.823699510804018*^9, 3.823699553406013*^9}, {
   3.823699773545903*^9, 3.8236997762666216`*^9}, 3.8237000595962725`*^9, {
   3.823709533359593*^9, 3.823709620041626*^9}, {3.8237579160843487`*^9, 
   3.8237579819820395`*^9}, {3.8237600078125305`*^9, 
   3.8237600419970484`*^9}, {3.823762411309579*^9, 3.8237626105139475`*^9}, {
   3.823762860713399*^9, 3.823762979993198*^9}, {3.8237636994732723`*^9, 
   3.823763762976372*^9}, {3.8237638064524326`*^9, 3.8237638777725754`*^9}, {
   3.8237642336959796`*^9, 3.823764243192564*^9}, {3.8237647366507487`*^9, 
   3.8237647761151395`*^9}, {3.8237660125997825`*^9, 
   3.8237660850868025`*^9}, {3.8237663890822897`*^9, 
   3.8237664514982605`*^9}, {3.8237676430612626`*^9, 3.823767669998178*^9}, {
   3.8237678742994537`*^9, 3.823767908885929*^9}, {3.8237679527066307`*^9, 
   3.8237683279594297`*^9}, {3.8237690023527107`*^9, 
   3.8237690108569527`*^9}, {3.8237691754923773`*^9, 
   3.8237692089358854`*^9}, {3.823769423055882*^9, 3.823769531959441*^9}, {
   3.823769715460997*^9, 3.8237697699591727`*^9}, {3.8237704938151693`*^9, 
   3.823770502890845*^9}, {3.8237706370550747`*^9, 3.8237706376783733`*^9}, {
   3.8237709977637606`*^9, 3.8237710296235027`*^9}, {3.823771086171177*^9, 
   3.82377121843124*^9}, {3.823771748509946*^9, 3.823771768282032*^9}, {
   3.823771802423682*^9, 3.823771830069684*^9}, {3.823772462119466*^9, 
   3.823772573764695*^9}, {3.8237726540618167`*^9, 3.823772696527171*^9}, {
   3.8237727344596653`*^9, 3.823772740556348*^9}, {3.8237766563803034`*^9, 
   3.8237766811330724`*^9}, {3.823776749241801*^9, 3.8237767538135605`*^9}, {
   3.8237787951417284`*^9, 3.823778797634058*^9}, {3.8237789142379837`*^9, 
   3.8237789373780594`*^9}, {3.8237793133010645`*^9, 
   3.8237793779849653`*^9}, {3.823779413581706*^9, 3.8237794576447916`*^9}, {
   3.8237798378355036`*^9, 3.823779840744718*^9}, {3.823780108711988*^9, 
   3.8237802784826717`*^9}, {3.8237806571962085`*^9, 
   3.8237806988916287`*^9}, {3.823783174355369*^9, 3.8237831773892493`*^9}, {
   3.8237834789561996`*^9, 3.8237834880877943`*^9}, {3.823783748133762*^9, 
   3.823783761529921*^9}, {3.823791617833246*^9, 3.823791620529146*^9}, {
   3.8246472986840353`*^9, 3.824647378874398*^9}, {3.8246477290334735`*^9, 
   3.8246480762104187`*^9}, {3.8246481890484543`*^9, 3.824648248130356*^9}, {
   3.824648281353444*^9, 3.82464843800924*^9}, {3.824648874692629*^9, 
   3.8246488751284623`*^9}, {3.8246491915796323`*^9, 3.824649194462926*^9}, {
   3.82464937948682*^9, 3.824649393322801*^9}, {3.8246524662371225`*^9, 
   3.8246524780355945`*^9}, {3.824658268104128*^9, 3.824658272550231*^9}, {
   3.824658306135356*^9, 3.824658318719681*^9}, {3.8246619409964776`*^9, 
   3.824661944093154*^9}, {3.8246663525345497`*^9, 3.824666355896577*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"82759d58-e515-44f8-b2e7-b1815486f0fa"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Phases", "Section",
 CellChangeTimes->{{3.681300194179221*^9, 3.6813002033832407`*^9}, {
   3.681305983976405*^9, 3.6813059853359213`*^9}, {3.6813176225703306`*^9, 
   3.6813176235079107`*^9}, {3.6813177175941257`*^9, 3.68131771915676*^9}, {
   3.708272177122472*^9, 3.708272189394394*^9}, {3.708272239370994*^9, 
   3.708272253185425*^9}, {3.7247626663439655`*^9, 3.724762668594143*^9}, 
   3.724763762181196*^9, {3.725974849294973*^9, 3.725974857279992*^9}, {
   3.7316800228814087`*^9, 3.7316800249126425`*^9}, {3.731761928333893*^9, 
   3.731761928740137*^9}, {3.7377345647344294`*^9, 3.7377345664687967`*^9}, {
   3.737994165253688*^9, 3.7379941653786864`*^9}, {3.7489625392900763`*^9, 
   3.7489625531505637`*^9}, {3.749318816981333*^9, 3.749318817559469*^9}, {
   3.7656382216793394`*^9, 3.7656382261328287`*^9}, {3.7662401432029853`*^9, 
   3.766240154985159*^9}, {3.7663282678653297`*^9, 3.766328270484855*^9}, {
   3.766331146283388*^9, 3.7663311568355923`*^9}, {3.7663982782306576`*^9, 
   3.7663982795028768`*^9}, {3.7664037488989267`*^9, 
   3.7664037535714073`*^9}, {3.76675425955847*^9, 3.766754260902328*^9}, {
   3.767446029232342*^9, 3.7674460297011285`*^9}, {3.7675176217294626`*^9, 
   3.767517621841589*^9}, {3.7685471006341314`*^9, 3.7685471031625986`*^9}, {
   3.782651674525923*^9, 3.7826516762290554`*^9}, {3.7827472341594315`*^9, 
   3.7827472344406757`*^9}, {3.7845390971377993`*^9, 
   3.7845390993098416`*^9}, {3.7846213628789454`*^9, 
   3.7846213635508842`*^9}, {3.784971285415371*^9, 3.784971285852929*^9}, {
   3.80003815573755*^9, 3.8000381597687845`*^9}, {3.8049514458306084`*^9, 
   3.804951448440013*^9}, {3.8062446719465714`*^9, 3.8062446751540537`*^9}, {
   3.811791929593967*^9, 3.8117919321569138`*^9}, {3.8117920042649097`*^9, 
   3.811792032147236*^9}, {3.8118212232455654`*^9, 3.8118212243258395`*^9}, {
   3.811855173078432*^9, 3.8118551748205085`*^9}, {3.813666226120046*^9, 
   3.8136662293236427`*^9}, {3.8157445404480095`*^9, 3.815744553217987*^9}, {
   3.8236766868638616`*^9, 3.8236766879639177`*^9}, {3.8236767823672867`*^9, 
   3.82367678570735*^9}, 3.823676830070672*^9, {3.823695649204563*^9, 
   3.823695657909268*^9}, {3.8237840685239453`*^9, 3.8237840686885047`*^9}, {
   3.8237841144729843`*^9, 3.8237841216318254`*^9}, {3.824303928321507*^9, 
   3.8243039418383484`*^9}, {3.824389030845001*^9, 3.824389036517827*^9}, {
   3.8244791592530804`*^9, 3.824479162204151*^9}, {3.824479894471941*^9, 
   3.824479895498193*^9}, {3.824481989038223*^9, 3.8244819970258484`*^9}, {
   3.824485251218871*^9, 3.8244852526280994`*^9}, 3.8244862184325895`*^9, {
   3.8244865087759857`*^9, 3.8244865122995195`*^9}, {3.824559687809925*^9, 
   3.8245596885080385`*^9}, {3.8246470901221066`*^9, 
   3.824647091542306*^9}},ExpressionUUID->"d258c137-6a56-4105-8a4d-\
28a48c1d1013"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dPList", " ", "=", " ", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dCPList", " ", "=", " ", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dGVList", " ", "=", " ", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dGHList", " ", "=", " ", 
    RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Without", " ", "radiation"}], ",", " ", "dGV"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AppendTo", "[", 
   RowBox[{"dPList", ",", " ", "0"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AppendTo", "[", 
   RowBox[{"dCPList", ",", " ", "0"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AppendTo", "[", 
   RowBox[{"dGVList", ",", " ", 
    RowBox[{"periodLength", "/", "2"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AppendTo", "[", 
    RowBox[{"dGHList", ",", " ", "0"}], "]"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Without", " ", "radiation"}], ",", " ", "dGH"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AppendTo", "[", 
   RowBox[{"dPList", ",", " ", "0"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AppendTo", "[", 
   RowBox[{"dCPList", ",", " ", "0"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AppendTo", "[", 
   RowBox[{"dGVList", ",", " ", "0"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AppendTo", "[", 
   RowBox[{"dGHList", ",", " ", 
    RowBox[{"periodLength", "/", "2"}]}], "]"}], ";"}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJwdx0sowwEAx/G/yUGt7OSRSVMzW2xKcTFMayyPxsXB2mERTWberKYVY0lI
a+1A2UNaZjGbR6KsebQWRZINzYEss5ILWvL//Q/fPn1Zyr7WThpBEEwyyJYU
22t0cVGhZ88BdxMGF+SWXFNqFWoPFOX2+2ABy3IE3VLmMWSkavzwl+s6hV3h
/BDcOEnhi0i9o+wy+DV9LoSywH4TrDKtqmAwZtTCDx/dCG2FggXYET1YgpnL
lw5YJOC5oaTt6RAOJXeCcL6EuIKm+rMbqHQF7qHemRKGb3R3FNKa857hwy39
FW47Gih1kcW0WtI5mykd8i56BWLSLfVaBQw470r7Sc3mYRnM6Mkez5mIi9Zj
m3pI0EIGODlmnYFyq/jvk9RvD1IOjE09f5OaNd0J6H0f5PyQWlTV5ZAzyxfC
lcrHOjginmyERCRLBhktyXYYktsV1L9INbCAyR+C/w7q5ac=
  "],
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"b8d6c4b7-f866-46b9-ba38-ffcbfb47bf77"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Calculate Fieldmaps and Kickmaps", "Section",
 CellChangeTimes->{{3.76639811614032*^9, 3.7663981237176037`*^9}, {
   3.8117926979894156`*^9, 3.811792703856547*^9}, {3.8118552160849347`*^9, 
   3.811855218607912*^9}, {3.811859976564584*^9, 3.8118600132665443`*^9}, {
   3.813666661803134*^9, 3.8136666711755733`*^9}, {3.8157515555609293`*^9, 
   3.8157515565375404`*^9}, {3.8159210679048615`*^9, 
   3.8159210685769944`*^9}, {3.8159224850222626`*^9, 3.815922488481221*^9}, {
   3.8159226302717714`*^9, 3.8159226306632223`*^9}, {3.8159231792081647`*^9, 
   3.8159231811301236`*^9}, {3.8159232189971013`*^9, 
   3.8159232383939466`*^9}, {3.8160830139364767`*^9, 3.816083014108356*^9}, {
   3.8161775373453956`*^9, 3.8161775439703765`*^9}, {3.816613501858136*^9, 
   3.8166135065567675`*^9}, {3.8166161415460854`*^9, 3.816616144029846*^9}, {
   3.81661674084603*^9, 3.8166167438130093`*^9}, {3.8166281021759367`*^9, 
   3.8166281047061005`*^9}, {3.8166318711315536`*^9, 3.816631873408121*^9}, {
   3.8166346475879755`*^9, 3.816634648188053*^9}, {3.816635915546548*^9, 
   3.8166359174295936`*^9}, {3.816883209102043*^9, 3.816883224245637*^9}, 
   3.816887824762886*^9, {3.8168894767870975`*^9, 3.8168894842714396`*^9}, {
   3.816890039664094*^9, 3.816890039742222*^9}, {3.816957053788333*^9, 
   3.8169570542040377`*^9}, {3.8170452981007433`*^9, 
   3.8170453083992147`*^9}, {3.823761231205571*^9, 3.8237612368285484`*^9}, {
   3.823764740744796*^9, 3.823764747632363*^9}, {3.8237648150240183`*^9, 
   3.8237648159365788`*^9}, {3.823767935665269*^9, 3.823767939793188*^9}, {
   3.8246472553729033`*^9, 3.824647319582095*^9}, {3.824648720959022*^9, 
   3.824648732510112*^9}},ExpressionUUID->"434f0be4-55de-4187-b9fe-\
6ed30b6d5774"],

Cell[BoxData[
 RowBox[{
  RowBox[{"For", "[", 
   RowBox[{
    RowBox[{"i", "=", "1"}], ",", " ", 
    RowBox[{"i", "\[LessEqual]", " ", 
     RowBox[{"Length", "[", "dPList", "]"}]}], ",", " ", 
    RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"dP", "=", 
      RowBox[{"dPList", "[", 
       RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dCP", "=", 
      RowBox[{"dCPList", "[", 
       RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dGV", "=", 
      RowBox[{"dGVList", "[", 
       RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dGH", "=", 
      RowBox[{"dGHList", "[", 
       RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"idFieldmapKickmap", "[", 
      RowBox[{"dP", ",", " ", "dCP", ",", " ", "dGV", ",", " ", "dGH"}], 
      "]"}], ";"}]}], " ", "\[IndentingNewLine]", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.8237647613835626`*^9, 3.8237647737404966`*^9}, {
   3.8237648361853895`*^9, 3.8237648385680127`*^9}, {3.823764883449033*^9, 
   3.823764907534577*^9}, {3.8237649727540445`*^9, 3.823764976883994*^9}, {
   3.823765011500374*^9, 3.823765037380124*^9}, {3.8237650889954104`*^9, 
   3.823765872054891*^9}, {3.823765913170862*^9, 3.8237659982352233`*^9}, {
   3.823766125773964*^9, 3.823766357018096*^9}, {3.8237664842785387`*^9, 
   3.8237665923972077`*^9}, {3.823766649473466*^9, 3.8237666778086414`*^9}, {
   3.8237668224565535`*^9, 3.8237668973182564`*^9}, {3.8237670069481535`*^9, 
   3.823767125624567*^9}, {3.823767160005561*^9, 3.8237671981963596`*^9}, {
   3.823767246146043*^9, 3.823767248051941*^9}, {3.8237673014390755`*^9, 
   3.8237673049157724`*^9}, {3.823767344401106*^9, 3.823767346363854*^9}, {
   3.823767596526793*^9, 3.823767628644842*^9}, {3.823772027430684*^9, 
   3.8237720931697617`*^9}, {3.8238641987394733`*^9, 3.823864451674632*^9}, {
   3.8242088407630687`*^9, 3.824208901434772*^9}, {3.824208942375244*^9, 
   3.824208957045961*^9}, {3.824648748427552*^9, 3.8246488440666156`*^9}, {
   3.82465230165613*^9, 3.824652307835577*^9}, 3.8246582203429403`*^9, {
   3.8246681622569914`*^9, 3.8246681625232787`*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"9843a179-b70e-490f-b73a-7ddb92657e10"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{973, 905},
WindowMargins->{{Automatic, 237}, {Automatic, 28}},
FrontEndVersion->"12.0 for Microsoft Windows (64-bit) (April 8, 2019)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 4160, 58, 96, "Title",ExpressionUUID->"6afd2076-4493-4f08-b468-fa4711877d85"],
Cell[CellGroupData[{
Cell[4765, 84, 259, 4, 67, "Chapter",ExpressionUUID->"650a07d3-2138-4aeb-96ea-ad9e7ef3f02f"],
Cell[CellGroupData[{
Cell[5049, 92, 206, 4, 67, "Section",ExpressionUUID->"5df1a130-7549-4d16-a255-11ac5a5b4990"],
Cell[CellGroupData[{
Cell[5280, 100, 339, 7, 64, "Input",ExpressionUUID->"5208220a-7433-48a7-a5e9-a136badd2cfb"],
Cell[CellGroupData[{
Cell[5644, 111, 426, 10, 22, "Print",ExpressionUUID->"21943405-ac81-4c33-a7ba-89b40d689e49"],
Cell[6073, 123, 259, 5, 22, "Print",ExpressionUUID->"1add56e4-a765-4a3c-9ad3-f45807dc4703"],
Cell[6335, 130, 277, 6, 22, "Print",ExpressionUUID->"053d51c2-71d0-4720-b9dd-f00490403c99"],
Cell[6615, 138, 267, 5, 22, "Print",ExpressionUUID->"2e068fce-35d0-4e6b-a631-0700dd5fdb47"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[6943, 150, 233, 4, 67, "Section",ExpressionUUID->"e61a2a75-5bec-4ae8-859b-8f0e399b827a"],
Cell[7179, 156, 1694, 25, 48, "Input",ExpressionUUID->"dd7a51b2-f11e-4368-8260-6f3568484196"]
}, Closed]],
Cell[CellGroupData[{
Cell[8910, 186, 449, 7, 53, "Section",ExpressionUUID->"d24c72dd-445c-4525-919e-b0dd35af82a1"],
Cell[CellGroupData[{
Cell[9384, 197, 308, 5, 58, "Subsection",ExpressionUUID->"77ec33ff-b18c-4902-a954-70832d3afce2"],
Cell[9695, 204, 30469, 586, 1906, "Input",ExpressionUUID->"056895f9-0538-4868-975a-a7ed3ddd8de0"]
}, Closed]],
Cell[CellGroupData[{
Cell[40201, 795, 359, 6, 40, "Subsection",ExpressionUUID->"1e497aed-2a04-4536-b071-9089c61c5ede"],
Cell[40563, 803, 13430, 209, 282, "Input",ExpressionUUID->"f7348a1e-5492-42f7-90b4-1afc2974e076"]
}, Closed]],
Cell[CellGroupData[{
Cell[54030, 1017, 308, 5, 40, "Subsection",ExpressionUUID->"0d079493-bdfa-4338-8e2b-f601566cfc9c"],
Cell[54341, 1024, 26286, 469, 1787, "Input",ExpressionUUID->"763036e8-7753-403a-9931-3ea46d04d9d7"]
}, Closed]],
Cell[CellGroupData[{
Cell[80664, 1498, 356, 6, 40, "Subsection",ExpressionUUID->"e3637092-da73-47ec-873f-16b5b813ec57"],
Cell[81023, 1506, 31200, 606, 1431, "Input",ExpressionUUID->"74000170-029d-4a45-be58-1fe9721ca462"]
}, Closed]],
Cell[CellGroupData[{
Cell[112260, 2117, 408, 6, 40, "Subsection",ExpressionUUID->"2428bf3c-641a-4267-85e0-44545ecd0f95"],
Cell[112671, 2125, 26794, 489, 1332, "Input",ExpressionUUID->"569db941-87e0-406b-bfc0-c32a4ddccf45"]
}, Closed]],
Cell[CellGroupData[{
Cell[139502, 2619, 455, 7, 40, "Subsection",ExpressionUUID->"a0a5e4ac-9fa0-405c-83fd-3ce22ce8faeb"],
Cell[139960, 2628, 22716, 391, 995, "Input",ExpressionUUID->"c72fa571-3554-48e3-bd7d-e28f899f46bd"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[162725, 3025, 209, 4, 53, "Section",ExpressionUUID->"f20aa789-107b-4ba9-a8ec-431d9a935df5"],
Cell[CellGroupData[{
Cell[162959, 3033, 239, 5, 59, "Subsection",ExpressionUUID->"26c81835-38a5-4a74-b320-8ad5dbdde227"],
Cell[163201, 3040, 4233, 96, 530, "Input",ExpressionUUID->"fce3d94d-6746-4041-b916-22ab05e4baf7"]
}, Closed]],
Cell[CellGroupData[{
Cell[167471, 3141, 182, 4, 41, "Subsection",ExpressionUUID->"8c6d00d2-3a3f-490e-951b-602c40d52fe4"],
Cell[167656, 3147, 4219, 91, 445, "Input",ExpressionUUID->"413e2a38-7932-4c0a-85df-2ece1567812f"]
}, Closed]],
Cell[CellGroupData[{
Cell[171912, 3243, 188, 4, 41, "Subsection",ExpressionUUID->"52194e79-993f-4f5b-8b53-64c60481d580"],
Cell[172103, 3249, 1632, 38, 247, "Input",ExpressionUUID->"9a15c4ae-d038-4810-bb83-70a92a913471"]
}, Closed]],
Cell[CellGroupData[{
Cell[173772, 3292, 252, 4, 41, "Subsection",ExpressionUUID->"7e58e129-fd65-47a3-884e-66a0e6093894"],
Cell[174027, 3298, 5290, 115, 555, "Input",ExpressionUUID->"0c13718e-6079-43d7-8f81-e5adf5dcc272"]
}, Closed]],
Cell[CellGroupData[{
Cell[179354, 3418, 188, 4, 41, "Subsection",ExpressionUUID->"f45e6654-ff43-4e37-a145-41f0751c9a87"],
Cell[179545, 3424, 16100, 355, 1171, "Input",ExpressionUUID->"fd97ef04-7401-413c-9d27-39469d580204"]
}, Closed]],
Cell[CellGroupData[{
Cell[195682, 3784, 194, 4, 41, "Subsection",ExpressionUUID->"a4995889-2542-4ef1-925d-cedccb9befe2"],
Cell[195879, 3790, 9335, 203, 1017, "Input",ExpressionUUID->"d4c1ff8e-927c-454c-aa8b-16a8cfd83e62"]
}, Closed]],
Cell[CellGroupData[{
Cell[205251, 3998, 404, 7, 41, "Subsection",ExpressionUUID->"6e03ba2e-0258-4376-8d2b-7328a1f290ee"],
Cell[205658, 4007, 8975, 200, 1149, "Input",ExpressionUUID->"f3218b51-b822-48b9-9c9a-ad6433572843"]
}, Closed]],
Cell[CellGroupData[{
Cell[214670, 4212, 242, 5, 41, "Subsection",ExpressionUUID->"05684451-b870-4f65-bfb9-c0fbd964241e"],
Cell[214915, 4219, 12646, 273, 1479, "Input",ExpressionUUID->"76af9fe4-5054-4a8c-93d4-2cff23f70cee"]
}, Closed]],
Cell[CellGroupData[{
Cell[227598, 4497, 260, 4, 41, "Subsection",ExpressionUUID->"e8adc80d-796a-484b-8006-7984daf3715e"],
Cell[227861, 4503, 11557, 270, 1387, "Input",ExpressionUUID->"7c2fc852-574b-4502-90b4-115c723af23a"]
}, Closed]],
Cell[CellGroupData[{
Cell[239455, 4778, 251, 5, 41, "Subsection",ExpressionUUID->"6f80b6cd-6c2c-49b4-a441-81df72cf3aea"],
Cell[239709, 4785, 3406, 94, 354, "Input",ExpressionUUID->"c50c7707-81f5-4284-b42b-281ac863c5f6"]
}, Closed]],
Cell[CellGroupData[{
Cell[243152, 4884, 290, 5, 41, "Subsection",ExpressionUUID->"4ab749ee-2e72-4893-87e7-38a8d2c70c37"],
Cell[243445, 4891, 7375, 163, 643, "Input",ExpressionUUID->"1ee58a02-50b6-44bc-8d61-c71a1b25a3c3"]
}, Closed]],
Cell[CellGroupData[{
Cell[250857, 5059, 460, 7, 41, "Subsection",ExpressionUUID->"7617277d-6c2c-4b31-9634-b68c542eb68c"],
Cell[251320, 5068, 7603, 155, 799, "Input",ExpressionUUID->"5f7fcb1c-a615-4289-9835-be5f2533c5f1"]
}, Closed]],
Cell[CellGroupData[{
Cell[258960, 5228, 429, 7, 41, "Subsection",ExpressionUUID->"00b3c40c-77e4-41cd-9bb5-97b3372f737a"],
Cell[259392, 5237, 12628, 253, 1846, "Input",ExpressionUUID->"8dafe5be-c29f-4386-8872-1f9e28618821"]
}, Closed]],
Cell[CellGroupData[{
Cell[272057, 5495, 310, 5, 41, "Subsection",ExpressionUUID->"0495e470-6a7e-40cd-8ed6-af5a74116f80"],
Cell[272370, 5502, 12212, 257, 1349, "Input",ExpressionUUID->"0425f402-9b65-4b47-9428-8006222969f7"]
}, Closed]],
Cell[CellGroupData[{
Cell[284619, 5764, 263, 5, 41, "Subsection",ExpressionUUID->"7f836bd3-84c3-4549-81b5-35d629be865b"],
Cell[284885, 5771, 21775, 476, 2766, "Input",ExpressionUUID->"e59c03cd-f3b3-40b5-a086-99db23009df5"]
}, Closed]],
Cell[CellGroupData[{
Cell[306697, 6252, 364, 6, 41, "Subsection",ExpressionUUID->"22cad2de-4649-45c5-8838-069890e9bf4b"],
Cell[307064, 6260, 7286, 145, 731, "Input",ExpressionUUID->"1ef0806f-8487-4eab-8d2d-d61d4bbac6eb"]
}, Closed]],
Cell[CellGroupData[{
Cell[314387, 6410, 218, 4, 41, "Subsection",ExpressionUUID->"984532a4-c5f8-49cf-8d50-bc203b7c6435"],
Cell[314608, 6416, 1928, 49, 174, "Input",ExpressionUUID->"f6047883-0a51-4d77-998d-5a1e374a91b5"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[316585, 6471, 1416, 20, 53, "Section",ExpressionUUID->"3e9cd6c9-234d-43bd-8578-f8648c0d50d4"],
Cell[CellGroupData[{
Cell[318026, 6495, 476, 8, 58, "Subsection",ExpressionUUID->"e0e81ba2-3df0-4059-ae9c-113518ef41ba"],
Cell[318505, 6505, 9000, 170, 781, "Input",ExpressionUUID->"d0f905fc-7f5a-43e7-afb2-9cd18b5a6fd4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[327542, 6680, 418, 7, 40, "Subsection",ExpressionUUID->"26ecead4-7517-47ce-8f2b-1a33c230b8f3"],
Cell[327963, 6689, 13609, 295, 1312, "Input",ExpressionUUID->"3059ee64-61b3-4801-b133-c8e419215243"]
}, Closed]],
Cell[CellGroupData[{
Cell[341609, 6989, 566, 9, 40, "Subsection",ExpressionUUID->"bea7f828-99d1-4ac3-8e63-cc281a529401"],
Cell[342178, 7000, 3868, 86, 441, "Input",ExpressionUUID->"78dbbb42-3216-42e7-a5b0-efbf93a97f33"]
}, Closed]],
Cell[CellGroupData[{
Cell[346083, 7091, 468, 8, 40, "Subsection",ExpressionUUID->"5a879d5a-930c-42c7-84d3-df7399a83db6"],
Cell[346554, 7101, 7548, 153, 777, "Input",ExpressionUUID->"97f2534e-952d-48db-a255-85ad00fb7051"]
}, Closed]]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[354163, 7261, 2449, 34, 67, "Chapter",ExpressionUUID->"535ffeac-0472-42b3-ab68-8ca72601b680"],
Cell[CellGroupData[{
Cell[356637, 7299, 303, 5, 67, "Section",ExpressionUUID->"a2cb0b07-751a-4c9f-9600-66fff12d225d"],
Cell[356943, 7306, 18248, 399, 1356, "Input",ExpressionUUID->"2bbf7119-20d7-43e5-bc76-37c2958c21df"]
}, Open  ]],
Cell[CellGroupData[{
Cell[375228, 7710, 1685, 24, 67, "Section",ExpressionUUID->"4080ba1f-9241-4118-9b19-b7848e8f21b7"],
Cell[376916, 7736, 19597, 362, 1318, "Input",ExpressionUUID->"82759d58-e515-44f8-b2e7-b1815486f0fa"]
}, Open  ]],
Cell[CellGroupData[{
Cell[396550, 8103, 2824, 39, 67, "Section",ExpressionUUID->"d258c137-6a56-4105-8a4d-28a48c1d1013"],
Cell[399377, 8144, 2350, 61, 330, "Input",ExpressionUUID->"b8d6c4b7-f866-46b9-ba38-ffcbfb47bf77"]
}, Open  ]],
Cell[CellGroupData[{
Cell[401764, 8210, 1734, 24, 67, "Section",ExpressionUUID->"434f0be4-55de-4187-b9fe-6ed30b6d5774"],
Cell[403501, 8236, 2307, 42, 159, "Input",ExpressionUUID->"9843a179-b70e-490f-b73a-7ddb92657e10"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

